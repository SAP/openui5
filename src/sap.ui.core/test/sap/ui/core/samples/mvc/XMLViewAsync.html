<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />

		<title>MVC Async XMLView - sap.ui.core</title>

		<script id="sap-ui-bootstrap"
				type="text/javascript"
				src="../../../../../../resources/sap-ui-core.js"
				data-sap-ui-theme="sap_bluecrystal">
		</script>

		<script>
			window._setTimeout = window.setTimeout;
		</script>

		<script src="../../../../../../resources/sap/ui/thirdparty/sinon.js"></script>

		<script>
			try{
				sap.ui.getCore().loadLibrary("sap.ui.commons");
			}catch(e){
				alert("This test page requires the library 'sap.ui.commons' which is not available.");
				throw(e);
			}

			// this test page is not below "resources", but "test-resources"
			// usually this redirect is NOT needed - but possible if useful
			jQuery.sap.registerModulePath("sap.ui.core.mvctest", "../../../../../../test-resources/sap/ui/core/samples/mvc/");

			var sXml;
			jQuery.ajax({
				url : "../../../../../../test-resources/sap/ui/core/samples/mvc/views/Async.view.xml",
				success : function(data) {
					sXml = new XMLSerializer().serializeToString(data);
				},
				async : false
			});

			var xhr = sinon.useFakeXMLHttpRequest();
			xhr.useFilters = true;
			xhr.addFilter(function(method, url) {
				return url.indexOf("sap/ui/core/samples/mvc/views/Async.view.xml") == -1;
			});
			xhr.onCreate = function(request) {
				request.onSend = function() {
					var iDelay = sap.ui.getCore().byId("timeout").getValue();
					iDelay = parseInt(iDelay, 10);

					_setTimeout(function() {
						request.respond(200,  { "Content-Type" : "application/xml" }, sXml);
					}, iDelay);
				};
			};

			/*
			 * define ASYNC View and place it onto the page
			 */
			var oInput = new sap.ui.commons.TextField("timeout", {
				value : "1000"
			}).placeAt("asyncInput");
			var oButton = new sap.ui.commons.Button("showButton", {
				text : "Show / rerender View",
				press : function(oEvent) {
					var oView = sap.ui.getCore().byId("asyncView");
					if (oView) {
						oView.destroy();
					}

					sap.ui.xmlview({
						id : "asyncView",
						viewName : "sap.ui.core.mvctest.views.Async",
						async : true
					}).placeAt("contentAsync");
				}
			}).placeAt("asyncButton");

			/*
			 * View and place it onto the page
			 */
			sap.ui.xmlview({
				id : "syncView",
				viewName : "sap.ui.core.mvctest.views.Product"
			}).placeAt("contentSync");


		</script>
	</head>

	<body class="sapUiBody" role="application">
		<h1>Asynchronous XMLView</h1>
		<div id="asyncInput"></div>
		<div id="asyncButton"></div>
		<br/>
		<div id="contentAsync"></div>

		<h1>Synchronous XMLView</h1>
		<div id="contentSync"></div>
	</body>
</html>
