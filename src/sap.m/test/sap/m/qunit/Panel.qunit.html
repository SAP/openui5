<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />

<title>QUnit page for sap.m.Panel</title>
<script id="sap-ui-bootstrap" data-sap-ui-theme="sap_bluecrystal"
	type="text/javascript" data-sap-ui-noConflict="true"
	data-sap-ui-libs="sap.m" src="../../../../resources/sap-ui-core.js">
</script>

<link rel="stylesheet" type="text/css" media="screen"
	href="../../../../resources/sap/ui/thirdparty/qunit.css"/>

<script type="text/javascript" src="../../../../resources/sap/ui/thirdparty/qunit.js"></script>
<script type="text/javascript" src="../../../../resources/sap/ui/thirdparty/sinon.js"></script>
<script type="text/javascript" src="../../../../resources/sap/ui/thirdparty/sinon-qunit.js"></script>
<script type="text/javascript">
	QUnit.module("API", {
		setup: function () {
			this.oPanel = new sap.m.Panel({
				headerText: "Panel Header",
				content: [
					new sap.m.Text({text: "This is a Text control"}),
					new sap.m.Button({text: "Click me"})
				]
			});

			this.oPanel.placeAt("qunit-fixture");
			sap.ui.getCore().applyChanges();
		},
		teardown: function () {
			this.oPanel.destroy();
			this.oPanel = null;
		}
	});

	QUnit.test("Call to setWidth() with string value 100px", function (assert) {
		this.oPanel.setWidth("100px");
		sap.ui.getCore().applyChanges();

		assert.strictEqual(this.oPanel.getWidth(), "100px", "should set the size to 100px");
	});

	QUnit.test("Call to setWidth() with string value 59%", function (assert) {
		this.oPanel.setWidth("59%");
		sap.ui.getCore().applyChanges();

		assert.strictEqual(this.oPanel.getWidth(), "59%", "should set the size to 59%");
	});

	QUnit.test("Call to setWidth() with string value 10em", function (assert) {
		this.oPanel.setWidth("10em");
		sap.ui.getCore().applyChanges();

		assert.strictEqual(this.oPanel.getWidth(), "10em", "should set the size to 10em");
	});

	QUnit.test("Call to setWidth() with string value 10rem", function (assert) {
		this.oPanel.setWidth("10rem");
		sap.ui.getCore().applyChanges();

		assert.strictEqual(this.oPanel.getWidth(), "10rem", "should set the size to 10rem");
	});

	QUnit.test("Call to setWidth() with string value auto", function (assert) {
		this.oPanel.setWidth("auto");
		sap.ui.getCore().applyChanges();

		assert.strictEqual(this.oPanel.getWidth(), "auto", "should set the size to auto");
	});

	QUnit.test("Call to setHeight() with string value 100px", function (assert) {
		this.oPanel.setHeight("100px");
		sap.ui.getCore().applyChanges();

		assert.strictEqual(this.oPanel.getHeight(), "100px", "should set the size to 100px");
	});

	QUnit.test("Call to setHeight() with string value 59%", function (assert) {
		this.oPanel.setHeight("59%");
		sap.ui.getCore().applyChanges();

		assert.strictEqual(this.oPanel.getHeight(), "59%", "should set the size to 59%");
	});

	QUnit.test("Call to setHeight() with string value 10em", function (assert) {
		this.oPanel.setHeight("10em");
		sap.ui.getCore().applyChanges();

		assert.strictEqual(this.oPanel.getHeight(), "10em", "should set the size to 10em");
	});

	QUnit.test("Call to setHeight() with string value 10rem", function (assert) {
		this.oPanel.setHeight("10rem");
		sap.ui.getCore().applyChanges();

		assert.strictEqual(this.oPanel.getHeight(), "10rem", "should set the size to 10rem");
	});

	QUnit.test("Call to setHeight() with string value auto", function (assert) {
		this.oPanel.setHeight("auto");
		sap.ui.getCore().applyChanges();

		assert.strictEqual(this.oPanel.getHeight(), "auto", "should set the size to auto");
	});

	QUnit.test("Call to setExpandable() with boolean value true", function (assert) {
		this.oPanel.setExpandable(true);
		sap.ui.getCore().applyChanges();

		assert.strictEqual(this.oPanel.getExpandable(), true, "should set the expandable property to true");
		assert.notStrictEqual(this.oPanel.oIconCollapsed, undefined, "should create an icon");
	});

	QUnit.test("Default Panel backgroundDesign", function (assert) {
		assert.strictEqual(this.oPanel.getBackgroundDesign(), sap.m.BackgroundDesign.Translucent, "should be sap.m.BackgroundDesign.Translucent");
	});

	QUnit.module("Events", {
		createPanel: function (options) {
			this.oPanel = new sap.m.Panel({
				headerText: "Panel Header",
				content: [
					new sap.m.Text({text: "This is a Text control"}),
					new sap.m.Button({text: "Click me"})
				],
				expandable: true,
				expanded: options.expanded
			});

			this.oPanel.placeAt("qunit-fixture");
			sap.ui.getCore().applyChanges();
		},
		teardown: function () {
			this.oPanel.destroy();
			this.oPanel = null;
		}
	});

	QUnit.test("Changing the expand property from true to false", function(assert) {
		var bPassedArg,
			fnEventSpy = sinon.spy(function (oEvent) {
				bPassedArg = oEvent.getParameter('expand');
			});

		this.createPanel({ expanded: true });
		this.oPanel.attachExpand(fnEventSpy);
		this.oPanel.setExpanded(false);

		assert.strictEqual(fnEventSpy.callCount, 1, "should fire expand event once");
		assert.strictEqual(bPassedArg, false, "should pass false as argument");
	});

	QUnit.test("Changing the expand property from false to true", function(assert) {
		var bPassedArg,
			fnEventSpy = sinon.spy(function (oEvent) {
				bPassedArg = oEvent.getParameter('expand');
			});

		this.createPanel({ expanded: false });
		this.oPanel.attachExpand(fnEventSpy);
		this.oPanel.setExpanded(true);

		assert.strictEqual(fnEventSpy.callCount, 1, "should fire expand event once");
		assert.strictEqual(bPassedArg, true, "should pass true as argument");
	});

	QUnit.module("Rendering", {
		setup: function () {
			this.oPanel = new sap.m.Panel({
				headerText: "Panel Header",
				content: [
					new sap.m.Text({text: "This is a Text control"}),
					new sap.m.Button({text: "Click me"})
				]
			});

			this.oPanel.placeAt("qunit-fixture");
			sap.ui.getCore().applyChanges();
		},
		teardown: function () {
			this.oPanel.destroy();
			this.oPanel = null;
		},
		createToolbar: function () {
			return new sap.m.Toolbar({
				content : [new sap.m.Label({
					text : "Panel header"
				})]
			});
		}
	});

	QUnit.test("Changing the width after the control is rendered", function(assert) {
		var fnRenderingSpy = sinon.spy();

		this.oPanel.addDelegate({ onAfterRendering: fnRenderingSpy });
		this.oPanel.setWidth("200px");
		sap.ui.getCore().applyChanges();

		assert.strictEqual(fnRenderingSpy.callCount, 0, "should not rerender the control");
	});

	QUnit.test("Changing the height after the control is rendered", function(assert) {
		var fnRenderingSpy = sinon.spy();

		this.oPanel.addDelegate({ onAfterRendering: fnRenderingSpy });
		this.oPanel.setHeight("200px");
		sap.ui.getCore().applyChanges();

		assert.strictEqual(fnRenderingSpy.callCount, 0, "should not rerender the control");
	});

	QUnit.test("Header toolbar should override header text", function(assert) {
		this.oPanel.setAggregation("headerToolbar", this.createToolbar());
		sap.ui.getCore().applyChanges();

		var $header = this.oPanel.$().find(".sapMPanelHdr");

		assert.equal($header.length, 0, "Header text should not be rendered.");
	});

	QUnit.module("CSS classes", {
		setup: function () {
			this.oPanel = new sap.m.Panel({
				headerText: "Panel Header",
				content: [
					new sap.m.Text({text: "This is a Text control"}),
					new sap.m.Button({text: "Click me"})
				]
			});

			this.oPanel.placeAt("qunit-fixture");
			sap.ui.getCore().applyChanges();
		},
		teardown: function () {
			this.oPanel.destroy();
			this.oPanel = null;
		},
		createToolbar: function () {
			return new sap.m.Toolbar({
				content: [
					new sap.m.Label({text: "Panel header"})
				],
				height: "50px"
			});
		}
	});

	QUnit.test("Panel with header text and content", function(assert) {
		var $panel = this.oPanel.$();

		assert.ok($panel.hasClass("sapMPanel"), "should have sapMPanel class on root element");
		assert.ok(jQuery("h1:first-of-type", $panel).hasClass("sapMPanelHdr"), "should have sapMPanelHdr class present on first header");
	});

	QUnit.test("Expandable panel with headerText", function(assert) {
		this.oPanel.setExpandable(true);
		sap.ui.getCore().applyChanges();

		var $panel = this.oPanel.$();

		assert.strictEqual($panel.find(".sapMPanelWrappingDiv").length, 1, "should have wrapping div with sapMPanelWrappingDiv class");
		assert.strictEqual($panel.find(".sapMPanelExpandablePart").length, 1, "should have content area with sapMPanelExpandablePart class");
	});

	QUnit.test("Expandable and expanded panel with headerText", function(assert) {
		var panel = new sap.m.Panel({
			headerText: "test",
			expandable: true,
			expanded: true
		}).placeAt("qunit-fixture");
		sap.ui.getCore().applyChanges();

		assert.strictEqual(panel.$().find(".sapMPanelWrappingDiv").length, 1, "should have wrapping div with sapMPanelWrappingDiv class");
		assert.strictEqual(panel.$().find(".sapMPanelWrappingDivExpanded").length, 1, "should have wrapping div with sapMPanelWrappingDivExpanded class");
	});

	QUnit.test("Expandable and expanded panel with headerToolbar", function(assert) {
		var panel = new sap.m.Panel({
			headerToolbar: this.createToolbar(),
			expandable: true,
			expanded: true
		}).placeAt("qunit-fixture");
		sap.ui.getCore().applyChanges();

		assert.strictEqual(panel.$().find(".sapMPanelWrappingDivTb").length, 1, "should have wrapping div with sapMPanelWrappingDivTb class");
		assert.strictEqual(panel.$().find(".sapMPanelWrappingDivTbExpanded").length, 1, "should have wrapping div with sapMPanelWrappingDivTbExpanded class");
	});

	QUnit.test("Expandable panel with headerToolbar and infoToolbar", function(assert) {
		this.oPanel.setExpandable(true);
		this.oPanel.setAggregation("headerToolbar", this.createToolbar());
		this.oPanel.setAggregation("infoToolbar", this.createToolbar());

		sap.ui.getCore().applyChanges();

		var $panel = this.oPanel.$();

		assert.strictEqual($panel.find(".sapMPanelWrappingDivTb").length, 1, "should have wrapping div with sapMPanelWrappingDivTb class");
		assert.strictEqual($panel.find(".sapMPanelExpandablePart").length, 2, "should have infoToolbar and content area with sapMPanelExpandablePart class");
	});

	QUnit.test("Expandable Panel when expanded", function(assert) {
		this.oPanel.setExpandable(true);
		this.oPanel.setExpanded(true);

		sap.ui.getCore().applyChanges();

		var $panel = this.oPanel.$();

		assert.strictEqual($panel.find(".sapMPanelExpandableIcon").length, 1, "should have sapMPanelExpandableIcon class present once");
		assert.strictEqual($panel.find(".sapMPanelExpandableIconExpanded").length, 1, "should have sapMPanelExpandableIconExpanded class present once");
		assert.strictEqual($panel.find(".sapMPanelWrappingDivExpanded").length, 1, "should have sapMPanelWrappingDivExpanded class present once");
	});

	QUnit.test("Expandable Panel when collapsed", function(assert) {
		this.oPanel.setExpandable(true);
		this.oPanel.setExpanded(false);

		sap.ui.getCore().applyChanges();

		var $panel = this.oPanel.$();

		assert.strictEqual($panel.find(".sapMPanelExpandableIcon").length, 1, "should have sapMPanelExpandableIcon class present once");
		assert.strictEqual($panel.find(".sapMPanelExpandableIconExpanded").length, 0, "should NOT have sapMPanelExpandableIconExpanded class present");
		assert.strictEqual($panel.find(".sapMPanelWrappingDivExpanded").length, 0, "should NOT have sapMPanelWrappingDivExpanded class present");
	});

	QUnit.test("Panel with solid backgroundDesign", function(assert) {
		this.oPanel.setBackgroundDesign(sap.m.BackgroundDesign.Solid);
		sap.ui.getCore().applyChanges();

		var $panel = this.oPanel.$();

		assert.strictEqual($panel.find(".sapMPanelBGSolid").length, 1, "should have sapMPanelBGSolid class present once");
	});

	QUnit.test("Panel with transparent backgroundDesign", function(assert) {
		this.oPanel.setBackgroundDesign(sap.m.BackgroundDesign.Transparent);
		sap.ui.getCore().applyChanges();

		var $panel = this.oPanel.$();

		assert.strictEqual($panel.find(".sapMPanelBGTransparent").length, 1, "should have sapMPanelBGTransparent class present once");
	});

	QUnit.test("Panel with translucent backgroundDesign", function(assert) {
		var $panel = this.oPanel.$();

		assert.strictEqual($panel.find(".sapMPanelBGTranslucent").length, 1, "should have sapMPanelBGTranslucent class present once");
	});

	QUnit.module("Computed styles", {
		setup: function () {
			this.oPanel = new sap.m.Panel({
				headerText: "Panel Header",
				content: [
					new sap.m.Text({text: "This is a Text control"}),
					new sap.m.Button({text: "Click me"})
				]
			});

			this.oPanel.placeAt("qunit-fixture");
			sap.ui.getCore().applyChanges();
		},
		teardown: function () {
			this.oPanel.destroy();
			this.oPanel = null;
		},
		createToolbar: function (sHeight) {
			return new sap.m.Toolbar({
				content: [
					new sap.m.Label({text: "Panel header"})
				],
				height: sHeight
			});
		}
	});

	QUnit.test("Sizes should be equal to the ones set through the setters", function(assert) {
		this.oPanel.setWidth("400px");
		this.oPanel.setHeight("300px");

		sap.ui.getCore().applyChanges();

		var $panel = this.oPanel.$();

		assert.strictEqual($panel.width(), 400, "width === 400");
		assert.strictEqual($panel.height(), 300, "Height === 300");
	});

	QUnit.test("Content for panel with 200px height when headerToolbar and infoToolbar are 100px", function(assert) {
		this.oPanel.setHeight("200px");
		this.oPanel.setAggregation("headerToolbar", this.createToolbar("50px"));
		this.oPanel.setAggregation("infoToolbar", this.createToolbar("50px"));

		sap.ui.getCore().applyChanges();

		var $content = this.oPanel.$().find(".sapMPanelContent");

		assert.equal($content.outerHeight(), 100, "should be 100px");
	});

	QUnit.test("Line heigh should equal the height of the header when header toolbar is not present", function(assert) {
		var $header = this.oPanel.$().find(".sapMPanelHdr");

		assert.strictEqual($header.css("height"), $header.css("lineHeight"), "Height and line height should be equal");
	});

	QUnit.test("Content of expandable Panel when expanded", function(assert) {
		this.oPanel.setExpandable(true);
		this.oPanel.setExpanded(true);

		sap.ui.getCore().applyChanges();

		var $panel = this.oPanel.$();

		assert.strictEqual($panel.find(".sapMPanelContent").css("display"), "block", "should have display:block style present");
	});

	QUnit.test("Content of expandable Panel when collapsed", function(assert) {
		this.oPanel.setExpandable(true);
		this.oPanel.setExpanded(false);

		sap.ui.getCore().applyChanges();

		var $panel = this.oPanel.$();

		assert.strictEqual($panel.find(".sapMPanelContent").css("display"), "none", "should have display:none style present");
	});

	QUnit.test("Panel with solid backgroundDesign", function(assert) {
		this.oPanel.setBackgroundDesign(sap.m.BackgroundDesign.Solid);
		sap.ui.getCore().applyChanges();

		var $panel = this.oPanel.$();

		assert.strictEqual($panel.find(".sapMPanelBGSolid").css("background-color"), "rgb(255, 255, 255)",
			"should have background-color:rgb(255, 255, 255) style present");
	});

	QUnit.test("Panel with translucent backgroundDesign", function(assert) {
		var $panel = this.oPanel.$();

		assert.strictEqual($panel.find(".sapMPanelBGTranslucent").css("background-color"), "rgba(255, 255, 255, 0.8)",
			"should have background-color:rgba(255, 255, 255, 0.8) style present");
	});

	QUnit.test("Expandable panel with headerToolbar - toolbar should not have border", function(assert) {
		this.oPanel.setExpandable(true);
		this.oPanel.setAggregation("headerToolbar", this.createToolbar("50px"));
		sap.ui.getCore().applyChanges();

		var $toolbar = this.oPanel.$().find(".sapMTB");

		assert.equal($toolbar.css("border-bottom-width"), "0px", "toolbar border should be 0px");
	});

	QUnit.test("Expandable panel with headerToolbar - toolbar should not have padding-left", function(assert) {
		this.oPanel.setExpandable(true);
		this.oPanel.setAggregation("headerToolbar", this.createToolbar("50px"));
		sap.ui.getCore().applyChanges();

		var $toolbar = this.oPanel.$().find(".sapMTB");

		assert.equal($toolbar.css("padding-left"), "0px", "toolbar padding-left should be 0px");
	});

	QUnit.test("Expandable panel with headerToolbar - toolbar child should have margin-left: 3rem", function(assert) {
		this.oPanel.setExpandable(true);
		this.oPanel.setAggregation("headerToolbar", this.createToolbar("50px"));
		sap.ui.getCore().applyChanges();

		var fontSize = parseInt(jQuery("body").css("font-size"), 10);
		var $toolbar = this.oPanel.$().find(".sapMTB");

		assert.equal(parseInt($toolbar.css("margin-left"), 10), 3 * fontSize, "toolbar margin-left should be " + (3*fontSize) + "px");
	});

	QUnit.test("Expandable panel with headerToolbar - first toolbar child should not have margin-left", function(assert) {
		this.oPanel.setExpandable(true);
		this.oPanel.setAggregation("headerToolbar", this.createToolbar("50px"));
		sap.ui.getCore().applyChanges();

		var $toolbar = this.oPanel.$().find(".sapMTB");
		var $firstToolbarChild = $toolbar.children().eq(0);

		assert.equal($firstToolbarChild.css("margin-left"), "0px", "first toolbar child margin-left should be 0px");
	});

	QUnit.test("Expandable panel with headerText - headerText should not have padding-left", function(assert) {
		this.oPanel.setExpandable(true);
		sap.ui.getCore().applyChanges();

		var $header = this.oPanel.$().find(".sapMPanelHdr");

		assert.equal($header.css("padding-left"), "0px", "headerText padding-left should be 0px");
	});

	QUnit.test("Container Padding Classes", function (assert) {
		// System under Test + Act
		var oContainer = new sap.m.Panel(),
			sContentSelector = ".sapMPanelContent",
			sResponsiveSize = (sap.ui.Device.resize.width <= 599 ? "0px" : (sap.ui.Device.resize.width <= 1023 ? "16px" : "16px 32px")),
			aResponsiveSize = sResponsiveSize.split(" "),
			$container,
			$containerContent;

		// Act
		oContainer.placeAt("qunit-fixture");
		sap.ui.getCore().applyChanges();
		oContainer.addStyleClass("sapUiNoContentPadding");
		$containerContent = oContainer.$().find(sContentSelector);

		// Assert
		assert.strictEqual($containerContent.css("padding-left"), "0px", "The container has no left content padding when class \"sapUiNoContentPadding\" is set");
		assert.strictEqual($containerContent.css("padding-right"), "0px", "The container has no right content padding when class \"sapUiNoContentPadding\" is set");
		assert.strictEqual($containerContent.css("padding-top"), "0px", "The container has no top content padding when class \"sapUiNoContentPadding\" is set");
		assert.strictEqual($containerContent.css("padding-bottom"), "0px", "The container has no bottom content padding when class \"sapUiNoContentPadding\" is set");

		// Act
		oContainer.removeStyleClass("sapUiNoContentPadding");
		oContainer.addStyleClass("sapUiContentPadding");

		// Assert
		assert.strictEqual($containerContent.css("padding-left"), "16px", "The container has 1rem left content padding when class \"sapUiContentPadding\" is set");
		assert.strictEqual($containerContent.css("padding-right"), "16px", "The container has 1rem right content padding when class \"sapUiContentPadding\" is set");
		assert.strictEqual($containerContent.css("padding-top"), "16px", "The container has 1rem top content padding when class \"sapUiContentPadding\" is set");
		assert.strictEqual($containerContent.css("padding-bottom"), "16px", "The container has 1rem bottom content padding when class \"sapUiContentPadding\" is set");

		// Act
		oContainer.removeStyleClass("sapUiContentPadding");
		oContainer.addStyleClass("sapUiResponsiveContentPadding");

		// Assert
		assert.strictEqual($containerContent.css("padding-left"), (aResponsiveSize[1] ? aResponsiveSize[1] : aResponsiveSize[0]), "The container has " + sResponsiveSize + " left content padding when class \"sapUiResponsiveContentPadding\" is set (tested value depends on window size)");
		assert.strictEqual($containerContent.css("padding-right"), (aResponsiveSize[1] ? aResponsiveSize[1] : aResponsiveSize[0]) , "The container has " + sResponsiveSize + " right content padding when class \"sapUiResponsiveContentPadding\" is set (tested value depends on window size)");
		assert.strictEqual($containerContent.css("padding-top"), aResponsiveSize[0], "The container has " + sResponsiveSize + " top content padding when class \"sapUiResponsiveContentPadding\" is set (tested value depends on window size)");
		assert.strictEqual($containerContent.css("padding-bottom"), aResponsiveSize[0], "The container has " + sResponsiveSize + " bottom content padding when class \"sapUiResponsiveContentPadding\" is set (tested value depends on window size)");

		// Cleanup
		oContainer.destroy();
	});
</script>
</head>
<body class="sapUiBody">
	<div id="qunit"></div>
	<div id="qunit-fixture">test markup, will be hidden</div>
</body>
</html>
