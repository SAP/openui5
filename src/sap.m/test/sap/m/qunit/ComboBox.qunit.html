<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<title>Test Page for sap.m.ComboBox</title>
		<script id="sap-ui-bootstrap"
				data-sap-ui-theme="sap_bluecrystal"
				data-sap-ui-noConflict="true"
				data-sap-ui-libs="sap.m"
				src="../../../../resources/sap-ui-core.js">
		</script>
		<script>
			jQuery.sap.require("sap.ui.core.util.MockServer");
		</script>
		<link rel="stylesheet" href="../../../../resources/sap/ui/thirdparty/qunit.css" type="text/css" media="screen" />
		<script src="../../../../resources/sap/ui/thirdparty/qunit.js"></script>
		<script src="../../../../resources/sap/ui/qunit/qunit-junit.js"></script>
		<script src="../../../../resources/sap/ui/qunit/qunit-coverage.js"></script>
		<script src="../../../../resources/sap/ui/qunit/QUnitUtils.js"></script>
		<script src="../../../../resources/sap/ui/thirdparty/sinon-qunit.js"></script>
		<script>
			window._setTimeout = this.setTimeout;
			sinon.config.useFakeTimers = true;

			// make jQuery.now work with Sinon fake timers (since jQuery 2.x, jQuery.now caches the native Date.now)
			jQuery.now = function() {
				return Date.now();
			};

			QUnit.config.autostart = false;
			sap.ui.test.qunit.delayTestStart();

			// helper functions
			var fnGetDomRefs = function(sId) {

				var oComboBox = sap.ui.getCore().byId(sId),
					$ComboBox = oComboBox.$(),
					$Arrow = $ComboBox.children("." + sap.m.ComboBoxBaseRenderer.CSS_CLASS + "Arrow");

				return {
					$ComboBox: $ComboBox,
					$Arrow: $Arrow
				}
			};

			var fnTestControlProperty = function(mOptions) {
				var sProperty = jQuery.sap.charToUpperCase(mOptions.property);

				test("get" + sProperty + "()", function() {
					strictEqual(mOptions.control["get" + sProperty](), mOptions.output, mOptions.description);
				});
			};

			var fnStartMockServer = function(sUri, iAutoRespondAfter) {
				var sMetadataUrl = "data/metadata.xml";
				sUri = sUri || "/service/";

				// configure respond to requests delay
				sap.ui.core.util.MockServer.config({
					autoRespond: true,
					autoRespondAfter: iAutoRespondAfter || 10
				});

				// create mock server
				var oMockServer = new sap.ui.core.util.MockServer({
					rootUri: sUri
				});

				// start and return
				oMockServer.simulate(sMetadataUrl, "data");
				oMockServer.start();
				return oMockServer;
			};

			/* =========================================================== */
			/* API module                                                  */
			/* =========================================================== */

			module("API");

			/* ------------------------------ */
			/* tests for default values       */
			/* ------------------------------ */

			test("default values", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1",
							enabled: false
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// assert
				strictEqual(oComboBox.getName(), "", 'Default name is ""');
				strictEqual(oComboBox.getVisible(), true, "By default the ComboBox control is visible");
				strictEqual(oComboBox.getEnabled(), true, "By default the ComboBox control is enabled");
				strictEqual(oComboBox.getWidth(), "", 'By default the "width" of the ComboBox control is ""');
				strictEqual(oComboBox.getMaxWidth(), "100%", 'By default the "max-width" of the ComboBox control is "100%"');
				ok(oComboBox.getSelectedItem() === null, "By default the selected items of the ComboBox control is null");
				strictEqual(oComboBox.getSelectedItemId(), "", 'By default the selected items id of the ComboBox control is ""');
				strictEqual(oComboBox.getSelectedKey(), "", 'By default the selected key of the ComboBox control is ""');

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* setValue()                     */
			/* ------------------------------ */

			// CSN 0120031469 0000547938 2014
			// do not override the binding for the value property
			test("setValue()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					selectedKey: {
						path: "/selected",
						template: "{selected}"
					},

					items: {
						path: "/items",
						template: new sap.ui.core.Item({
							key: "{value}",
							text: "{text}"
						})
					},

					value: {
						path: "/value",
						template: "{value}"
					}
				});

				// arrange
				var oModel = new sap.ui.model.json.JSONModel();
				var mData = {
					"items": [
						{
							"value": "GER",
							"text": "Germany"
						},

						{
							"value": "CU",
							"text": "Cuba"
						},
					],

					"selected": "GER",
					"value": "other value"
				};

				oModel.setData(mData);
				sap.ui.getCore().setModel(oModel);
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// assert
				strictEqual(oComboBox.getValue(), "other value");

				// cleanup
				oComboBox.destroy();
				oModel.destroy();
			});

			/* ------------------------------ */
			/* getSelectedItem()              */
			/* ------------------------------ */

			test("getSelectedItem()", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						oExpectedItem = new sap.ui.core.Item({
							id: "item-id",
							key: "0",
							text: "item 0"
						})
					],

					selectedItem: oExpectedItem
				});

				// assert
				ok(oComboBox.getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getSelectedItemId(), "item-id");
				strictEqual(oComboBox.getSelectedKey(), "0");
				ok(oComboBox.getList().getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getValue(), "item 0");
				strictEqual(oComboBox.getProperty("value"), "item 0");

				// cleanup
				oComboBox.destroy();
			});

			test("getSelectedItem()", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						oExpectedItem = new sap.ui.core.Item({
							id: "item-id",
							key: "2",
							text: "item 2"
						}),

						new sap.ui.core.Item({
							key: "3",
							text: "item 3"
						})
					],

					selectedItem: "item-id"
				});

				// assert
				ok(oComboBox.getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getSelectedItemId(), "item-id");
				strictEqual(oComboBox.getSelectedKey(), "2");
				strictEqual(oComboBox.getValue(), "item 2");
				strictEqual(oComboBox.getProperty("value"), "item 2");

				// cleanup
				oComboBox.destroy();
			});

			test("getSelectedItem()", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					selectedItem: "item-id",
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						oExpectedItem = new sap.ui.core.Item({
							id: "item-id",
							key: "2",
							text: "item 2"
						}),

						new sap.ui.core.Item({
							key: "3",
							text: "item 3"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// assert
				ok(oComboBox.getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getSelectedItemId(), "item-id");
				strictEqual(oComboBox.getSelectedKey(), "2");
				ok(oComboBox.getList().getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getValue(), "item 2");
				strictEqual(oComboBox.getProperty("value"), "item 2");

				// cleanup
				oComboBox.destroy();
			});

			test("getSelectedItem()", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					selectedKey: "1",

					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						oExpectedItem = new sap.ui.core.Item({
							id: "item-id",
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// assert
				ok(oComboBox.getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getSelectedItemId(), "item-id");
				strictEqual(oComboBox.getSelectedKey(), "1");
				ok(oComboBox.getList().getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getValue(), "item 1");
				strictEqual(oComboBox.getProperty("value"), "item 1");

				// cleanup
				oComboBox.destroy();
			});

			test("getSelectedItem()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: []
				});

				// assert
				ok(oComboBox.getSelectedItem() === null);
				strictEqual(oComboBox.getSelectedItemId(), "");
				strictEqual(oComboBox.getSelectedKey(), "");
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getValue(), "");
				strictEqual(oComboBox.getProperty("value"), "");

				// cleanup
				oComboBox.destroy();
			});

			test("getSelectedItem()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					],

					selectedItem: null
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// assert
				ok(oComboBox.getSelectedItem() === null);
				strictEqual(oComboBox.getSelectedItemId(), "");
				strictEqual(oComboBox.getSelectedKey(), "");
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getValue(), "");
				strictEqual(oComboBox.getProperty("value"), "");

				// cleanup
				oComboBox.destroy();
			});

			test("getSelectedItem()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					],

					selectedKey: ""
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// assert
				ok(oComboBox.getSelectedItem() === null);
				strictEqual(oComboBox.getSelectedItemId(), "");
				strictEqual(oComboBox.getSelectedKey(), "");
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getValue(), "");
				strictEqual(oComboBox.getProperty("value"), "");

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* getSelectedItemId()            */
			/* ------------------------------ */

			test("getSelectedItem()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					],

					selectedItemId: undefined
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// assert
				ok(oComboBox.getSelectedItem() === null);
				strictEqual(oComboBox.getSelectedItemId(), "");
				strictEqual(oComboBox.getSelectedKey(), "");
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getValue(), "");
				strictEqual(oComboBox.getProperty("value"), "");

				// cleanup
				oComboBox.destroy();
			});

			test("getSelectedItemId()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					],

					selectedItemId: ""
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// assert
				ok(oComboBox.getSelectedItem() === null);
				strictEqual(oComboBox.getSelectedItemId(), "");
				strictEqual(oComboBox.getSelectedKey(), "");
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getValue(), "");
				strictEqual(oComboBox.getProperty("value"), "");

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* getSelectedKey()               */
			/* ------------------------------ */

			test("getSelectedKey()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					],

					selectedKey: undefined
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// assert
				ok(oComboBox.getSelectedItem() === null);
				strictEqual(oComboBox.getSelectedItemId(), "");
				strictEqual(oComboBox.getSelectedKey(), "");
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getValue(), "");
				strictEqual(oComboBox.getProperty("value"), "");

				// cleanup
				oComboBox.destroy();
			});

			test("getSelectedKey()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// assert
				ok(oComboBox.getSelectedItem() === null);
				strictEqual(oComboBox.getSelectedItemId(), "");
				strictEqual(oComboBox.getSelectedKey(), "");
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getValue(), "");
				strictEqual(oComboBox.getProperty("value"), "");

				// cleanup
				oComboBox.destroy();
			});

			test("getSelectedKey()", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						oExpectedItem = new sap.ui.core.Item({
							id: "item-id",
							key: "2",
							text: "item 2"
						}),

						new sap.ui.core.Item({
							key: "3",
							text: "item 3"
						})
					],

					selectedItem: "item-id"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// assert
				ok(oComboBox.getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getSelectedItemId(), "item-id");
				strictEqual(oComboBox.getSelectedKey(), "2");
				ok(oComboBox.getList().getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getValue(), "item 2");
				strictEqual(oComboBox.getProperty("value"), "item 2");

				// cleanup
				oComboBox.destroy();
			});

			test("getSelectedKey()", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					selectedItem: "item-id",

					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						}),

						oExpectedItem = new sap.ui.core.Item({
							id: "item-id",
							key: "3",
							text: "item 3"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// assert
				ok(oComboBox.getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getSelectedItemId(), "item-id");
				strictEqual(oComboBox.getSelectedKey(), "3");
				ok(oComboBox.getList().getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getValue(), "item 3");
				strictEqual(oComboBox.getProperty("value"), "item 3");

				// cleanup
				oComboBox.destroy();
			});

			test("getSelectedKey()", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					selectedKey: "1",

					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						oExpectedItem = new sap.ui.core.Item({
							id: "item-id",
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// assert
				ok(oComboBox.getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getSelectedItemId(), "item-id");
				strictEqual(oComboBox.getSelectedKey(), "1");
				ok(oComboBox.getList().getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getValue(), "item 1");
				strictEqual(oComboBox.getProperty("value"), "item 1");

				// cleanup
				oComboBox.destroy();
			});

			test("getSelectedKey()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: []
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// assert
				ok(oComboBox.getSelectedItem() === null);
				strictEqual(oComboBox.getSelectedItemId(), "");
				strictEqual(oComboBox.getSelectedKey(), "");
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getValue(), "");
				strictEqual(oComboBox.getProperty("value"), "");

				// cleanup
				oComboBox.destroy();
			});

			test("getSelectedKey()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					],

					selectedItem: null
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// assert
				ok(oComboBox.getSelectedItem() === null);
				strictEqual(oComboBox.getSelectedItemId(), "");
				strictEqual(oComboBox.getSelectedKey(), "");
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getValue(), "");
				strictEqual(oComboBox.getProperty("value"), "");

				// cleanup
				oComboBox.destroy();
			});

			test("getSelectedKey()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					],

					selectedItemId: undefined
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// assert
				ok(oComboBox.getSelectedItem() === null);
				strictEqual(oComboBox.getSelectedItemId(), "");
				strictEqual(oComboBox.getSelectedKey(), "");
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getValue(), "");
				strictEqual(oComboBox.getProperty("value"), "");

				// cleanup
				oComboBox.destroy();
			});

			test("getSelectedKey()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					],

					selectedItemId: ""
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// assert
				ok(oComboBox.getSelectedItem() === null);
				strictEqual(oComboBox.getSelectedItemId(), "");
				strictEqual(oComboBox.getSelectedKey(), "");
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getValue(), "");
				strictEqual(oComboBox.getProperty("value"), "");

				// cleanup
				oComboBox.destroy();
			});

			test("getSelectedKey()", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						oExpectedItem = new sap.ui.core.Item({
							id: "item-id",
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					],

					selectedKey: "0"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// assert
				ok(oComboBox.getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getSelectedItemId(), "item-id");
				strictEqual(oComboBox.getSelectedKey(), "0");
				ok(oComboBox.getList().getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getValue(), "item 0");
				strictEqual(oComboBox.getProperty("value"), "item 0");

				// cleanup
				oComboBox.destroy();
			});

			// BCP 1570460580
			test("it should synchronize property changes of items to the combo box control", function() {

				// system under test
				var oItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						oItem = new sap.ui.core.Item({
							key: "CU",
							text: "Cuba"
						})
					],
					selectedKey: "CU"
				});

				// act
				oItem.setKey("GER");
				oItem.setText("Germany");

				// assert
				strictEqual(oComboBox.getSelectedKey(), "GER");
				strictEqual(oComboBox.getSelectedItem().getText(), "Germany");
				strictEqual(oComboBox.getValue(), "Germany");

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* getSelectedItemId()            */
			/* ------------------------------ */

			test("getSelectedItemId()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "5",
							text: "item 5"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// assert
				ok(oComboBox.getSelectedItem() === null);
				strictEqual(oComboBox.getSelectedItemId(), "");
				strictEqual(oComboBox.getSelectedKey(), "");
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getValue(), "");
				strictEqual(oComboBox.getProperty("value"), "");

				// cleanup
				oComboBox.destroy();
			});

			test("getSelectedItemId()", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						oExpectedItem = new sap.ui.core.Item({
							id: "item-id",
							key: "2",
							text: "item 2"
						}),

						new sap.ui.core.Item({
							key: "3",
							text: "item 3"
						})
					],

					selectedItem: "item-id"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// assert
				ok(oComboBox.getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getSelectedItemId(), "item-id");
				strictEqual(oComboBox.getSelectedKey(), "2");
				ok(oComboBox.getList().getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getValue(), "item 2");
				strictEqual(oComboBox.getProperty("value"), "item 2");

				// cleanup
				oComboBox.destroy();
			});

			test("getSelectedItemId()", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					selectedItem: "item-id",

					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						}),

						oExpectedItem = new sap.ui.core.Item({
							id: "item-id",
							key: "3",
							text: "item 3"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// assert
				ok(oComboBox.getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getSelectedItemId(), "item-id");
				strictEqual(oComboBox.getSelectedKey(), "3");
				ok(oComboBox.getList().getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getValue(), "item 3");
				strictEqual(oComboBox.getProperty("value"), "item 3");

				// cleanup
				oComboBox.destroy();
			});

			test("getSelectedItemId()", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					selectedKey: "1",

					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						oExpectedItem = new sap.ui.core.Item({
							id: "item-id",
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// assert
				ok(oComboBox.getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getSelectedItemId(), "item-id");
				strictEqual(oComboBox.getSelectedKey(), "1");
				ok(oComboBox.getList().getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getValue(), "item 1");
				strictEqual(oComboBox.getProperty("value"), "item 1");

				// cleanup
				oComboBox.destroy();
			});

			test("getSelectedItemId()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: []
				});

				// assert
				ok(oComboBox.getSelectedItem() === null);
				strictEqual(oComboBox.getSelectedItemId(), "");
				strictEqual(oComboBox.getSelectedKey(), "");
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getValue(), "");
				strictEqual(oComboBox.getProperty("value"), "");

				// cleanup
				oComboBox.destroy();
			});

			test("getSelectedItemId()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					],

					selectedItem: null
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// assert
				ok(oComboBox.getSelectedItem() === null);
				strictEqual(oComboBox.getSelectedItemId(), "");
				strictEqual(oComboBox.getSelectedKey(), "");
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getValue(), "");
				strictEqual(oComboBox.getProperty("value"), "");

				// cleanup
				oComboBox.destroy();
			});

			test("getSelectedItemId()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					],

					selectedItemId: undefined
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// assert
				ok(oComboBox.getSelectedItem() === null);
				strictEqual(oComboBox.getSelectedItemId(), "");
				strictEqual(oComboBox.getSelectedKey(), "");
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getValue(), "");
				strictEqual(oComboBox.getProperty("value"), "");

				// cleanup
				oComboBox.destroy();
			});

			test("getSelectedItemId()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					],

					selectedItemId: ""
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// assert
				ok(oComboBox.getSelectedItem() === null);
				strictEqual(oComboBox.getSelectedItemId(), "");
				strictEqual(oComboBox.getSelectedKey(), "");
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getValue(), "");
				strictEqual(oComboBox.getProperty("value"), "");

				// cleanup
				oComboBox.destroy();
			});

			test("getSelectedItemId()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					],

					selectedKey: undefined
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// assert
				ok(oComboBox.getSelectedItem() === null);
				strictEqual(oComboBox.getSelectedItemId(), "");
				strictEqual(oComboBox.getSelectedKey(), "");
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getValue(), "");
				strictEqual(oComboBox.getProperty("value"), "");

				// cleanup
				oComboBox.destroy();
			});

			test("getSelectedItemId()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					],

					selectedKey: ""
				});

				// assert
				ok(oComboBox.getSelectedItem() === null);
				strictEqual(oComboBox.getSelectedItemId(), "");
				strictEqual(oComboBox.getSelectedKey(), "");
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getValue(), "");
				strictEqual(oComboBox.getProperty("value"), "");

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* addItem                        */
			/* ------------------------------ */

			test("addItem()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox();

				// arrange
				var fnAddItemSpy = this.spy(oComboBox, "addItem");
				var oItem = new sap.ui.core.Item({
					key: "0",
					text: "item 0"
				});

				// act
				oComboBox.addItem(oItem);

				// assert
				ok(oComboBox.getFirstItem() === oItem);
				ok(oComboBox.getList().getFirstItem() === oItem);
				ok(fnAddItemSpy.returned(oComboBox));
				ok(oItem.hasListeners("_change"));
				ok(oComboBox.isItemVisible(oItem));

				// cleanup
				oComboBox.destroy();
			});

			// unit test for CSN 0120031469 0000547938 2014
			test("addItem()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					value: "input field value",
					items: [
						new sap.ui.core.Item({
							text: "item 0"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// assert
				ok(oComboBox.getSelectedItem() === null);
				strictEqual(oComboBox.getSelectedItemId(), "");
				strictEqual(oComboBox.getSelectedKey(), "");
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getValue(), "input field value");
				strictEqual(oComboBox.getProperty("value"), "input field value");

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* insertItem                     */
			/* ------------------------------ */

			test("insertItem()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox();

				// arrange
				var fnInsertItem = this.spy(oComboBox, "insertItem");
				var oItem = new sap.ui.core.Item({
					key: "0",
					text: "item 0"
				});

				// act
				oComboBox.insertItem(oItem, 0);

				// assert
				ok(oComboBox.getFirstItem() === oItem);
				ok(oComboBox.getList().getFirstItem() === oItem);
				ok(fnInsertItem.returned(oComboBox), 'oComboBox.insertAggregation() method return the "this" reference');
				ok(oItem.hasListeners("_change"));
				ok(oComboBox.isItemVisible(oItem));

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* cursorPos                      */
			/* ------------------------------ */

			test("Check the position of the cursor after an item is pressed", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "GER",
							text: "Germany"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				oComboBox.open();
				this.clock.tick(1000);

				// act
				sap.ui.test.qunit.triggerEvent("tap", oComboBox.getFirstItem().getDomRef());

				// assert
				strictEqual(jQuery(oComboBox.getFocusDomRef()).cursorPos(), 7, "The text cursor is at the endmost position");

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* setSelectedItem()              */
			/* ------------------------------ */

			test("setSelectedItem()", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						oExpectedItem = new sap.ui.core.Item({
							id: "item-id",
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2",
							enabled: false
						})
					]
				});

				// arrange
				var fnSetPropertySpy = this.spy(oComboBox, "setProperty"),
					fnSetAssociationSpy = this.spy(oComboBox, "setAssociation"),
					fnFireChangeSpy = this.spy(oComboBox, "fireChange"),
					fnSetSelectedItemSpy = this.spy(oComboBox, "setSelectedItem");

				// act
				oComboBox.setSelectedItem(oComboBox.getItemAt(1));

				// assert
				ok(fnSetPropertySpy.calledWith("selectedKey", "1"));
				ok(fnSetPropertySpy.calledWith("selectedItemId", "item-id"));
				ok(oComboBox.getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getSelectedItemId(), "item-id");
				strictEqual(oComboBox.getSelectedKey(), "1");
				ok(oComboBox.getList().getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getValue(), "item 1");
				strictEqual(oComboBox.getProperty("value"), "item 1");
				strictEqual(jQuery(oComboBox.getFocusDomRef()).attr("aria-activedescendant"), undefined, 'The "aria-activedescendant" attribute is set when the active descendant is rendered and visible');
				ok(fnSetSelectedItemSpy.returned(oComboBox), 'sap.m.ComboBox.prototype.setSelectedItem() method return the "this" reference');
				strictEqual(fnFireChangeSpy.callCount, 0, "The change event was not fired");

				// cleanup
				oComboBox.destroy();
			});

			test("setSelectedItem()", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						oExpectedItem = new sap.ui.core.Item({
							id: "item-id",
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2",
							enabled: false
						})
					]
				});

				// arrange
				var fnSetPropertySpy = this.spy(oComboBox, "setProperty"),
					fnSetAssociationSpy = this.spy(oComboBox, "setAssociation"),
					fnFireChangeSpy = this.spy(oComboBox, "fireChange"),
					fnSetSelectedItemSpy = this.spy(oComboBox, "setSelectedItem");

				// act
				oComboBox.setSelectedItem("item-id");

				// assert
				ok(fnSetPropertySpy.calledWith("selectedKey", "1"));
				ok(fnSetPropertySpy.calledWith("selectedItemId", "item-id"));
				ok(fnSetAssociationSpy.calledWith("selectedItem", oExpectedItem));
				ok(oComboBox.getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getSelectedItemId(), "item-id");
				strictEqual(oComboBox.getSelectedKey(), "1");
				ok(oComboBox.getList().getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getValue(), "item 1");
				strictEqual(oComboBox.getProperty("value"), "item 1");
				strictEqual(jQuery(oComboBox.getFocusDomRef()).attr("aria-activedescendant"), undefined, 'The "aria-activedescendant" attribute is set when the active descendant is rendered and visible');
				ok(fnSetSelectedItemSpy.returned(oComboBox), 'sap.m.ComboBox.prototype.setSelectedItem() method return the "this" reference');
				strictEqual(fnFireChangeSpy.callCount, 0, "The change event was not fired");

				// cleanup
				oComboBox.destroy();
			});

			test("setSelectedItem()", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						oExpectedItem = new sap.ui.core.Item({
							id: "item-id",
							key: "2",
							text: "item 2"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// act
				oComboBox.setSelectedItem(oComboBox.getLastItem());

				// assert
				ok(oComboBox.getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getSelectedItemId(), "item-id");
				strictEqual(oComboBox.getSelectedKey(), "2");
				ok(oComboBox.getList().getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getValue(), "item 2");
				strictEqual(oComboBox.getProperty("value"), "item 2");
				strictEqual(jQuery(oComboBox.getFocusDomRef()).attr("aria-activedescendant"), undefined, 'The "aria-activedescendant" attribute is set when the active descendant is rendered and visible');

				// cleanup
				oComboBox.destroy();
			});

			test("setSelectedItem()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					],

					selectedKey: "2"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// act
				oComboBox.setSelectedItem(null);

				// assert
				ok(oComboBox.getSelectedItem() === null);
				strictEqual(oComboBox.getSelectedItemId(), "");
				strictEqual(oComboBox.getSelectedKey(), "");
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getValue(), "");
				strictEqual(oComboBox.getProperty("value"), "");
				strictEqual(jQuery(oComboBox.getFocusDomRef()).attr("aria-activedescendant"), undefined, 'The "aria-activedescendant" attribute is set when the active descendant is rendered and visible');

				// cleanup
				oComboBox.destroy();
			});

			test("setSelectedItem() set the selected item when the picker popup is open", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					],

					selectedKey: "2"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				oComboBox.open();
				this.clock.tick(1000);

				// act
				oComboBox.setSelectedItem(null);

				// assert
				ok(oComboBox.getSelectedItem() === null);
				strictEqual(oComboBox.getSelectedItemId(), "");
				strictEqual(oComboBox.getSelectedKey(), "");
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getValue(), "");
				strictEqual(oComboBox.getProperty("value"), "");
				strictEqual(jQuery(oComboBox.getFocusDomRef()).attr("aria-activedescendant"), undefined, 'The "aria-activedescendant" attribute is set when the active descendant is rendered and visible');

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* setSelectedItemId()            */
			/* ------------------------------ */

			test("setSelectedItemId()", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						oExpectedItem = new sap.ui.core.Item({
							id: "item-id",
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2",
							enabled: false
						})
					]
				});

				// arrange
				var fnFireChangeSpy = this.spy(oComboBox, "fireChange"),
					fnSetSelectedItemIdSpy = this.spy(oComboBox, "setSelectedItemId");

				// act
				oComboBox.setSelectedItemId("item-id");

				// assert
				strictEqual(fnFireChangeSpy.callCount, 0, "The change event was not fired");
				ok(fnSetSelectedItemIdSpy.returned(oComboBox), 'sap.m.ComboBox.prototype.setSelectedItemId() method return the "this" reference');
				ok(oComboBox.getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getSelectedItemId(), "item-id");
				strictEqual(oComboBox.getSelectedKey(), "1");
				ok(oComboBox.getList().getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getValue(), "item 1");
				strictEqual(oComboBox.getProperty("value"), "item 1");
				strictEqual(jQuery(oComboBox.getFocusDomRef()).attr("aria-activedescendant"), undefined, 'The "aria-activedescendant" attribute is set when the active descendant is rendered and visible');

				// cleanup
				oComboBox.destroy();
			});

			test("setSelectedItemId()", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						oExpectedItem = new sap.ui.core.Item({
							id: "item-id",
							key: "2",
							text: "item 2"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// act
				oComboBox.setSelectedItemId("item-id");

				// assert
				ok(oComboBox.getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getSelectedItemId(), "item-id");
				strictEqual(oComboBox.getSelectedKey(), "2");
				ok(oComboBox.getList().getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getValue(), "item 2");
				strictEqual(oComboBox.getProperty("value"), "item 2");
				strictEqual(jQuery(oComboBox.getFocusDomRef()).attr("aria-activedescendant"), undefined, 'The "aria-activedescendant" attribute is set when the active descendant is rendered and visible');

				// cleanup
				oComboBox.destroy();
			});

			test("setSelectedItemId()", function() {

				//system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					],

					selectedKey: "2"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// act
				oComboBox.setSelectedItemId("")

				// assert
				ok(oComboBox.getSelectedItem() === null);
				strictEqual(oComboBox.getSelectedItemId(), "");
				strictEqual(oComboBox.getSelectedKey(), "");
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getValue(), "");
				strictEqual(oComboBox.getProperty("value"), "");
				strictEqual(jQuery(oComboBox.getFocusDomRef()).attr("aria-activedescendant"), undefined, 'The "aria-activedescendant" attribute is set when the active descendant is rendered and visible');

				// cleanup
				oComboBox.destroy();
			});

			test("setSelectedItemId() set the selected item when the ComboBox's picker pop-up is open", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					],

					selectedKey: "2"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				oComboBox.open();
				this.clock.tick(500);

				// act
				oComboBox.setSelectedItemId("");

				// assert
				ok(oComboBox.getSelectedItem() === null);
				strictEqual(oComboBox.getSelectedItemId(), "");
				strictEqual(oComboBox.getSelectedKey(), "");
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getValue(), "");
				strictEqual(oComboBox.getProperty("value"), "");
				strictEqual(jQuery(oComboBox.getFocusDomRef()).attr("aria-activedescendant"), undefined, 'The "aria-activedescendant" attribute is set when the active descendant is rendered and visible');

				// cleanup
				oComboBox.destroy();
			});

			test("setSelectedItemId() should set the value even if the corresponding item doesn't exist", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					selectedItemId: "item-id"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// assertions
				ok(oComboBox.getSelectedItem() === null);
				strictEqual(oComboBox.getSelectedItemId(), "item-id");
				strictEqual(oComboBox.getSelectedKey(), "");

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* setSelectedKey()               */
			/* ------------------------------ */

			test("setSelectedKey() first rendering", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({

					selectedKey: "2",

					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						oExpectedItem = new sap.ui.core.Item({
							id: "item-id",
							key: "2",
							text: "item 2"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// assert
				ok(oComboBox.getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getSelectedItemId(), "item-id");
				strictEqual(oComboBox.getSelectedKey(), "2");
				ok(oComboBox.getList().getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getValue(), "item 2");
				strictEqual(oComboBox.getProperty("value"), "item 2");
				strictEqual(jQuery(oComboBox.getFocusDomRef()).attr("aria-activedescendant"), undefined, 'The "aria-activedescendant" attribute is set when the active descendant is rendered and visible');

				// cleanup
				oComboBox.destroy();
			});

			test("setSelectedKey() no rendering", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						oExpectedItem = new sap.ui.core.Item({
							id: "item-id",
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					],

					selectedKey: "1"
				});

				// assert
				ok(oComboBox.getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getSelectedItemId(), "item-id");
				strictEqual(oComboBox.getSelectedKey(), "1");
				ok(oComboBox.getList().getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getValue(), "item 1");
				strictEqual(oComboBox.getProperty("value"), "item 1");
				strictEqual(jQuery(oComboBox.getFocusDomRef()).attr("aria-activedescendant"), undefined, 'The "aria-activedescendant" attribute is set when the active descendant is rendered and visible');

				// cleanup
				oComboBox.destroy();
			});

			test("setSelectedKey() after the initial rendering", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						oExpectedItem = new sap.ui.core.Item({
							id: "item-id",
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				var fnSetPropertySpy = this.spy(oComboBox, "setProperty"),
					fnSetAssociationSpy = this.spy(oComboBox, "setAssociation"),
					fnFireChangeSpy = this.spy(oComboBox, "fireChange"),
					fnSetSelectedKeySpy = this.spy(oComboBox, "setSelectedKey");

				// act
				oComboBox.setSelectedKey("1");

				// assert
				strictEqual(fnFireChangeSpy.callCount, 0, "The change event was not fired");

				ok(fnSetPropertySpy.calledWith("selectedKey", "1"));
				ok(fnSetPropertySpy.calledWith("selectedItemId", "item-id"));
				ok(fnSetAssociationSpy.calledWith("selectedItem", oExpectedItem));
				ok(fnSetSelectedKeySpy.returned(oComboBox), 'sap.m.ComboBox.prototype.setSelectedKey() method return the "this" reference');
				ok(oComboBox.getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getSelectedItemId(), "item-id");
				strictEqual(oComboBox.getSelectedKey(), "1");
				ok(oComboBox.getList().getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getValue(), "item 1");
				strictEqual(oComboBox.getProperty("value"), "item 1");
				strictEqual(jQuery(oComboBox.getFocusDomRef()).attr("aria-activedescendant"), undefined, 'The "aria-activedescendant" attribute is set when the active descendant is rendered and visible');

				// cleanup
				oComboBox.destroy();
			});

			test("setSelectedKey()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					],

					selectedKey: "2"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// act
				oComboBox.setSelectedKey("");

				// assert
				ok(oComboBox.getSelectedItem() === null);
				strictEqual(oComboBox.getSelectedItemId(), "");
				strictEqual(oComboBox.getSelectedKey(), "");
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getValue(), "");
				strictEqual(oComboBox.getProperty("value"), "");
				strictEqual(jQuery(oComboBox.getFocusDomRef()).attr("aria-activedescendant"), undefined, 'The "aria-activedescendant" attribute is set when the active descendant is rendered and visible');

				// cleanup
				oComboBox.destroy();
			});

			test("setSelectedKey() set the selected item when the picker popup is open test case 1", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					],

					selectedKey: "2"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				oComboBox.open();
				this.clock.tick(500);

				// act
				oComboBox.setSelectedKey("");

				// assert
				ok(oComboBox.getSelectedItem() === null);
				strictEqual(oComboBox.getSelectedItemId(), "");
				strictEqual(oComboBox.getSelectedKey(), "");
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getValue(), "");
				strictEqual(oComboBox.getProperty("value"), "");
				strictEqual(jQuery(oComboBox.getFocusDomRef()).attr("aria-activedescendant"), undefined, 'The "aria-activedescendant" attribute is set when the active descendant is rendered and visible');

				// cleanup
				oComboBox.destroy();
			});

			test("setSelectedKey() set the selected item when the picker popup is open test case 2", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						oExpectedItem = new sap.ui.core.Item({
							key: "GER",
							text: "Germany"
						})
					],

					selectedKey: "GER"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				var sExpectedActiveDescendantId = oExpectedItem.getId();

				oComboBox.open();
				this.clock.tick(1000);	// wait 1s after the open animation is completed

				// assert
				strictEqual(jQuery(oComboBox.getFocusDomRef()).attr("aria-activedescendant"), sExpectedActiveDescendantId, 'The "aria-activedescendant" attribute is set when the active descendant is rendered and visible');

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* setMaxWidth()                  */
			/* ------------------------------ */

			test("setMaxWidth()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox();

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// assert
				strictEqual(oComboBox.getDomRef().style.maxWidth, "100%");

				// cleanup
				oComboBox.destroy();
			});

			test("setMaxWidth()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					maxWidth: "50%"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// assert
				strictEqual(oComboBox.getDomRef().style.maxWidth, "50%");

				// cleanup
				oComboBox.destroy();
			});

			test("setMaxWidth()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox();

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// act
				oComboBox.setMaxWidth("40%");
				sap.ui.getCore().applyChanges();

				// assert
				strictEqual(oComboBox.getDomRef().style.maxWidth, "40%");

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* removeItem()                   */
			/* ------------------------------ */

			test("removeItem() it should return null when called with an invalid input argument value", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox();

				// arrange
				var fnRemoveAggregationSpy = this.spy(oComboBox.getList(), "removeAggregation");
				var fnRemoveItemSpy = this.spy(oComboBox, "removeItem");
				var fnFireChangeSpy = this.spy(oComboBox, "fireChange");

				// act
				oComboBox.removeItem(undefined);

				// assert
				strictEqual(fnRemoveAggregationSpy.callCount, 1, "sap.m.SelectList.removeAggregation() method was called");
				ok(fnRemoveAggregationSpy.calledWith("items", undefined), "sap.m.SelectList.prototype.removeAggregation() method was called with the expected argument");
				strictEqual(fnFireChangeSpy.callCount, 0, "The change event is not fired");
				ok(fnRemoveItemSpy.returned(null), "sap.m.ComboBox.prototype.removeItem() method returns null");

				// cleanup
				oComboBox.destroy();
			});

			test("removeItem() it should remove the selected item and change the selection (test case 1)", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: {
						path: "/items",
						template: new sap.ui.core.Item({
							key: "{value}",
							text: "{text}"
						})
					},

					selectedKey: {
						path: "/selected",
						template: "{selected}"
					}
				});

				// arrange
				var oModel = new sap.ui.model.json.JSONModel();
				var fnRemoveAggregationSpy = this.spy(oComboBox.getList(), "removeAggregation");
				var mData = {
					"items": [
						{
							"value": "0",
							"text": "item 0"
						},

						{
							"value": "1",
							"text": "item 1"
						},

						{
							"value": "2",
							"text": "item 2"
						},

						{
							"value": "3",
							"text": "item 3"
						},

						{
							"value": "4",
							"text": "item 4"
						},

						{
							"value": "5",
							"text": "item 5"
						},

						{
							"value": "6",
							"text": "item 6"
						},

						{
							"value": "7",
							"text": "item 7"
						},

						{
							"value": "8",
							"text": "item 8"
						}
					],

					"selected": "8"
				};

				oModel.setData(mData);
				sap.ui.getCore().setModel(oModel);
				oComboBox.placeAt("content");
				var oSelectedItem = oComboBox.getItemByKey("8");
				sap.ui.getCore().applyChanges();

				// act
				oComboBox.removeItem(8);

				// assert
				strictEqual(fnRemoveAggregationSpy.callCount, 1, "sap.m.SelectList.prototype.removeAggregation() method was called");
				ok(fnRemoveAggregationSpy.calledWith("items", 8), "sap.m.SelectList.prototype.removeAggregation() method was called with the expected argument");
				ok(oComboBox.getSelectedItem() === null);
				strictEqual(oComboBox.getSelectedItemId(), "");
				strictEqual(oComboBox.getSelectedKey(), "");
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getValue(), "item 8");
				strictEqual(oComboBox.getProperty("value"), "item 8");
				strictEqual(oSelectedItem.hasListeners("_change"), false);

				// cleanup
				oComboBox.destroy();
				oModel.destroy();
			});

			test("removeItem() it should remove the selected item and change the selection (test case 2)", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({

					items: {
						path: "/items",
						template: new sap.ui.core.Item({
							key: "{value}",
							text: "{text}"
						})
					},

					selectedKey: {
						path : "/selected",
						template: "{selected}"
					},

					change: function(oControlEvent) {
						jQuery.sap.log.info('Event fired: "change" value property to ' + oControlEvent.getParameter("selectedItem"));
					}
				});

				// arrange
				var oModel = new sap.ui.model.json.JSONModel();

				var mData = {
					"items" : [
						{
							"value": "0",
							"text": "item 0"
						},

						{
							"value": "1",
							"text": "item 1"
						},

						{
							"value": "2",
							"text": "item 2"
						},

						{
							"value": "3",
							"text": "item 3"
						}
					],

					"selected": "0"
				};

				oModel.setData(mData);
				sap.ui.getCore().setModel(oModel);

				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// act
				oComboBox.removeItem(0);
				sap.ui.getCore().applyChanges();

				// assert
				ok(oComboBox.getSelectedItem() === null);
				strictEqual(oComboBox.getSelectedItemId(), "");
				strictEqual(oComboBox.getSelectedKey(), "");
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getValue(), "item 0");
				strictEqual(oComboBox.getProperty("value"), "item 0");

				// cleanup
				oComboBox.destroy();
				oModel.destroy();
			});

			test("removeItem() it should remove the selected item and change the selection (test case 3)", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						oExpectedItem = new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// act
				oComboBox.removeItem(0);
				sap.ui.getCore().applyChanges();

				// assert
				ok(oComboBox.getSelectedItem() === null);
				strictEqual(oComboBox.getSelectedItemId(), "");
				strictEqual(oComboBox.getSelectedKey(), "");
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getValue(), "");
				strictEqual(oComboBox.getProperty("value"), "");
				ok(oExpectedItem.getDomRef() === null);
				strictEqual(oExpectedItem.hasListeners("_change"), false);

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* removeAllItems()               */
			/* ------------------------------ */

			test("removeAllItems()", function() {

				// system under test
				var aItems = [
					new sap.ui.core.Item({
						key: "0",
						text: "item 0"
					}),

					new sap.ui.core.Item({
						key: "1",
						text: "item 1"
					}),

					new sap.ui.core.Item({
						key: "2",
						text: "item 2"
					})
				];

				var oComboBox = new sap.m.ComboBox({
					items: aItems
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				var fnRemoveAllItemsSpy = this.spy(oComboBox, "removeAllItems");
				var fnListRemoveAllItemsSpy = this.spy(oComboBox.getList(), "removeAllItems");

				// act
				var oRemovedItems = oComboBox.removeAllItems();
				sap.ui.getCore().applyChanges();

				var mDomRefs = fnGetDomRefs(oComboBox.getId());

				// assert
				strictEqual(fnListRemoveAllItemsSpy.callCount, 1, "sap.m.SelectList.prototype.removeAllItems() method was called");
				ok(fnRemoveAllItemsSpy.returned(aItems), "sap.m.ComboBox.prototype.removeAllItems() method returns an array of the removed items");
				ok(oComboBox.getSelectedItem() === null);
				strictEqual(oComboBox.getSelectedItemId(), "");
				strictEqual(oComboBox.getSelectedKey(), "");
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getValue(), "");
				strictEqual(oComboBox.getProperty("value"), "");

				for (var i = 0; i < oRemovedItems.length; i++) {
					strictEqual(oRemovedItems[i].hasListeners("_change"), false);
				}

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* destroyItems()                 */
			/* ------------------------------ */

			test("destroyItems()", function() {

				// system under test
				var aItems = [
					new sap.ui.core.Item({
						key: "0",
						text: "item 0"
					}),

					new sap.ui.core.Item({
						key: "1",
						text: "item 1"
					}),

					new sap.ui.core.Item({
						key: "2",
						text: "item 2"
					})
				];

				var oComboBox = new sap.m.ComboBox({
					items: aItems,
					selectedKey: "2"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				var fnDestroyItemsSpy = this.spy(oComboBox, "destroyItems");

				// act
				oComboBox.destroyItems();
				sap.ui.getCore().applyChanges();

				// assert
				ok(fnDestroyItemsSpy.returned(oComboBox), "sap.m.ComboBox.prototype.destroyItems() method returns the ComboBox instance");
				ok(oComboBox.getList().getSelectedItem() === null);

				for (var i = 0; i < aItems.length; i++) {
					strictEqual(aItems[i].hasListeners("_change"), false);
				}

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* open()                         */
			/* ------------------------------ */

			test("open()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				document.documentElement.style.overflow = "hidden"; // hide scrollbar during test

				// act
				oComboBox.open();
				this.clock.tick(1000);

				// assert
				ok(oComboBox.isOpen(), "ComboBox is open");

				if (!sap.ui.Device.system.phone) {
					strictEqual(document.activeElement, oComboBox.getFocusDomRef(), "The ComboBox should get the focus");
				}

				ok(oComboBox.hasStyleClass(sap.m.ComboBoxBaseRenderer.CSS_CLASS + "Pressed"));

				if (sap.ui.Device.system.desktop || sap.ui.Device.system.tablet) {
					strictEqual(oComboBox.$().outerWidth(), oComboBox.getPicker().$().outerWidth(), "The width of the picker pop-up is strictEqual to the width of the input");
					strictEqual(document.activeElement, oComboBox.getFocusDomRef(), "The ComboBox should get the focus");
				} else if (sap.ui.Device.system.phone) {
					strictEqual(oComboBox.getPicker().$().width(), jQuery(window).width(), "The width of the picker pop-up is strictEqual to the width of the browser view port");
				}

				// cleanup
				oComboBox.destroy();
				document.documentElement.style.overflow = ""; // restore scrollbar after test
			});

			test("open() check whether the active state persist after re-rendering", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						}),
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				oComboBox.open();
				this.clock.tick(500);

				// act
				oComboBox.rerender();
				sap.ui.getCore().applyChanges();

				// assert
				ok(oComboBox.hasStyleClass(sap.m.ComboBoxBaseRenderer.CSS_CLASS + "Pressed"));

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* findFirstEnabledItem()         */
			/* ------------------------------ */

			test("findFirstEnabledItem()", function() {

				// system under test
				var oExpectedItem;
				var aItems = [
					oExpectedItem = new sap.ui.core.Item({
						key: "0",
						text: "item 0"
					}),

					new sap.ui.core.Item({
						key: "1",
						text: "item 1"
					}),

					new sap.ui.core.Item({
						key: "2",
						text: "item 2",
						enabled: false
					})
				];

				var oComboBox = new sap.m.ComboBox({
					items: aItems
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// act
				var oFirstEnabledItem = oComboBox.findFirstEnabledItem(aItems);

				// assert
				ok(oFirstEnabledItem === oExpectedItem);

				// cleanup
				oComboBox.destroy();
			});

			test("findFirstEnabledItem()", function() {

				// system under test
				var aItems = [
					new sap.ui.core.Item({
						key: "0",
						text: "item 0",
						enabled: false
					}),

					new sap.ui.core.Item({
						key: "1",
						text: "item 1",
						enabled: false
					}),

					new sap.ui.core.Item({
						key: "2",
						text: "item 2",
						enabled: false
					})
				];

				var oComboBox = new sap.m.ComboBox({
					items: aItems
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// act
				var oFirstEnabledItem = oComboBox.findFirstEnabledItem(aItems);

				// assert
				ok(oFirstEnabledItem === null);

				// cleanup
				oComboBox.destroy();
			});

			test("findFirstEnabledItem()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox();

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// act
				var oFirstEnabledItem = oComboBox.findFirstEnabledItem([]);

				// assert
				ok(oFirstEnabledItem === null);

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* findLastEnabledItem()          */
			/* ------------------------------ */

			test("findLastEnabledItem()", function() {

				// system under test
				var oExpectedItem;
				var aItems = [
					new sap.ui.core.Item({
						key: "0",
						text: "item 0",
						enabled: false
					}),

					new sap.ui.core.Item({
						key: "1",
						text: "item 1",
						enabled: false
					}),

					oExpectedItem = new sap.ui.core.Item({
						key: "2",
						text: "item 2"
					})
				];

				var oComboBox = new sap.m.ComboBox({
					items: aItems
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// act
				var oLastEnabledItem = oComboBox.findLastEnabledItem(aItems);

				// assert
				ok(oLastEnabledItem === oExpectedItem);

				// cleanup
				oComboBox.destroy();
			});

			test("findLastEnabledItem()", function() {

				// system under test
				var aItems = [
					new sap.ui.core.Item({
						key: "0",
						text: "item 0",
						enabled: false
					}),

					new sap.ui.core.Item({
						key: "1",
						text: "item 1",
						enabled: false
					}),

					new sap.ui.core.Item({
						key: "2",
						text: "item 2",
						enabled: false
					})
				];

				var oComboBox = new sap.m.ComboBox({
					items: aItems
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// act
				var oLastEnabledItem = oComboBox.findLastEnabledItem(aItems);

				// assert
				ok(oLastEnabledItem === null, 'The last enabled item is "null"');

				// cleanup
				oComboBox.destroy();
			});

			test("findLastEnabledItem()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox();

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// act
				var oLastEnabledItem = oComboBox.findLastEnabledItem([]);

				// assert
				ok(oLastEnabledItem === null, 'The last enabled item is "null"');

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* setSelectedIndex()             */
			/* ------------------------------ */

			var setSelectedIndexTestCase = function(sTestName, mOptions) {
				test("setSelectedIndex()", function() {

					// system under test
					var oComboBox = mOptions.control;

					// act
					oComboBox.setSelectedIndex(mOptions.input);

					// assert
					ok(oComboBox.getSelectedItem() === mOptions.output, sTestName);

					// cleanup
					oComboBox.destroy();
				});
			};

			(function() {
				var oExpectedItem;
				var aItems = [
					new sap.ui.core.Item({
						key: "0",
						text: "item 0",
						enabled: false
					}),

					new sap.ui.core.Item({
						key: "1",
						text: "item 1"
					}),

					oExpectedItem = new sap.ui.core.Item({
						key: "3",
						text: "item 3"
					}),

					new sap.ui.core.Item({
						key: "2",
						text: "item 2"
					})
				];

				setSelectedIndexTestCase("", {
					control: new sap.m.Select({
						items: aItems
					}),
					input: 2,
					output: oExpectedItem
				});
			}());

			setSelectedIndexTestCase("", {
				control: new sap.m.Select(),
				input: 2,
				output: null
			});

			(function() {
				var oExpectedItem;
				var aItems = [
					new sap.ui.core.Item({
						key: "0",
						text: "item 0",
						enabled: false
					}),

					new sap.ui.core.Item({
						key: "1",
						text: "item 1"
					}),

					new sap.ui.core.Item({
						key: "3",
						text: "item 3"
					}),

					oExpectedItem = new sap.ui.core.Item({
						key: "2",
						text: "item 2"
					})
				];

				setSelectedIndexTestCase("The provided index is bigger than the last item's index", {
					control: new sap.m.Select({
						items: aItems
					}),
					input: 10,
					output: oExpectedItem
				});
			}());

			/* ------------------------------ */
			/* getItemAt()                    */
			/* ------------------------------ */

			test("getItemAt()", function() {

				// system under test
				var oExpectedItem;
				var aItems = [
					new sap.ui.core.Item({
						key: "0",
						text: "item 0",
						enabled: false
					}),

					new sap.ui.core.Item({
						key: "1",
						text: "item 1",
						enabled: false
					}),

					oExpectedItem = new sap.ui.core.Item({
						key: "2",
						text: "item 2"
					})
				];

				var oComboBox = new sap.m.ComboBox({
					items: aItems
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// act
				var oItem1 = oComboBox.getItemAt(2);
				var oItem2 = oComboBox.getItemAt(6);

				// assert
				ok(oItem1 === oExpectedItem);
				ok(oItem2 === null);

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* getFirstItem()                 */
			/* ------------------------------ */

			test("getFirstItem()", function() {

				// system under test
				var oExpectedItem;
				var aItems = [
					oExpectedItem = new sap.ui.core.Item({
						key: "0",
						text: "item 0"
					}),

					new sap.ui.core.Item({
						key: "1",
						text: "item 1"
					}),

					new sap.ui.core.Item({
						key: "2",
						text: "item 2"
					})
				];

				var oComboBox = new sap.m.ComboBox({
					items: aItems
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// act
				var oItem = oComboBox.getFirstItem();

				// assert
				ok(oItem === oExpectedItem);

				// cleanup
				oComboBox.destroy();
			});

			test("getFirstItem()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox();

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// act
				var oItem = oComboBox.getFirstItem();

				// assert
				ok(oItem === null);

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* getLastItem()                  */
			/* ------------------------------ */

			test("getLastItem()", function() {

				// system under test
				var oExpectedItem;
				var aItems = [
					new sap.ui.core.Item({
						key: "0",
						text: "item 0"
					}),

					new sap.ui.core.Item({
						key: "1",
						text: "item 1"
					}),

					oExpectedItem = new sap.ui.core.Item({
						key: "2",
						text: "item 2"
					})
				];

				var oComboBox = new sap.m.ComboBox({
					items: aItems
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// act
				var oItem = oComboBox.getLastItem();

				// assert
				ok(oItem === oExpectedItem);

				// cleanup
				oComboBox.destroy();
			});

			test("getLastItem()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox();

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// act
				var oItem = oComboBox.getLastItem();

				// assert
				ok(oItem === null);

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* getItemByKey()                 */
			/* ------------------------------ */

			test("getItemByKey()", function() {

				// system under test
				var oExpectedItem1;
				var oExpectedItem2;
				var oExpectedItem3;
				var aItems = [
					oExpectedItem1 = new sap.ui.core.Item({
						key: "0",
						text: "item 0"
					}),

					oExpectedItem2 = new sap.ui.core.Item({
						key: "1",
						text: "item 1"
					}),

					oExpectedItem3 = new sap.ui.core.Item({
						key: "2",
						text: "item 2"
					})
				];

				var oComboBox = new sap.m.ComboBox({
					items: aItems
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// act
				var oItem1 = oComboBox.getItemByKey("0"),
					oItem2 = oComboBox.getItemByKey("1"),
					oItem3 = oComboBox.getItemByKey("2"),
					oItem4 = oComboBox.getItemByKey("3");

				// assert
				ok(oItem1 === oExpectedItem1);
				ok(oItem2 === oExpectedItem2);
				ok(oItem3 === oExpectedItem3);
				ok(oItem4 === null);

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* getEnabledItems()              */
			/* ------------------------------ */

			test("getEnabledItems()", function() {

				// system under test
				var oExpectedItem;
				var aItems = [
					oExpectedItem = new sap.ui.core.Item({
						key: "0",
						text: "item 0"
					}),

					new sap.ui.core.Item({
						key: "1",
						text: "item 1",
						enabled: false
					})
				];

				var oComboBox = new sap.m.ComboBox({
					items: aItems
				});

				// assert + act
				ok(oComboBox.getEnabledItems()[0] === oExpectedItem);

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* setValue()                     */
			/* ------------------------------ */

			test("setValue()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox();

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				var fnSetValueSpy = this.spy(oComboBox, "setValue");

				// act
				oComboBox.setValue("new value");

				// assert
				strictEqual(oComboBox.getValue(), "new value");
				strictEqual(oComboBox.getProperty("value"), "new value");
				strictEqual(oComboBox.getFocusDomRef().value, "new value");
				ok(fnSetValueSpy.returned(oComboBox), "sap.m.ComboBox.prototype.setValue() method return this to allow method chaining");

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* setValueState()                */
			/* ------------------------------ */

			test("value state and value state message", function() {
				var oErrorComboBox = new sap.m.ComboBox("errorcombobox", {
					valueState: "Error",
					valueStateText: "Error Message",
					items: [
						new sap.ui.core.Item({
							key: "DZ",
							text: "Algeria"
						}),
						new sap.ui.core.Item({
							key: "GER",
							text: "Germany",
						}),
						new sap.ui.core.Item({
							key: "CU",
							text: "Cuba",
						})
					]
				});

				// arrange
				oErrorComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				oErrorComboBox.open();
				this.clock.tick(1000);
				ok(!jQuery.sap.domById("errorcombobox-message"), "error message popup is not open when list is open");

				oErrorComboBox.close();
				this.clock.tick(1000);

				// workaround to fix failing test in IE9-11
				if (sap.ui.Device.browser.msie) {
					oErrorComboBox.focus();
					this.clock.tick(1000);
				}

				ok(jQuery.sap.domById("errorcombobox-message"), "error message popup is open when list is closed and focus is back to input");

				oErrorComboBox.focus();
				this.clock.tick(500);
				ok(jQuery.sap.domById("errorcombobox-message"), "error message popup is open when focusin");
				equal(oErrorComboBox.getValueStateText(), "Error Message", "error message is correct");

				oErrorComboBox.getFocusDomRef().blur();
				this.clock.tick(500);
				ok(!jQuery.sap.domById("errorcombobox-message"), "no error message popup is closed when focus is out");

				// cleanup
				oErrorComboBox.destroy();
			});

			// BCP 1570763824
			test("it should add the corresponding CSS classes", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox();

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// act
				oComboBox.setValueState(sap.ui.core.ValueState.Error);

				// assert
				ok(oComboBox.$().hasClass(sap.m.ComboBoxBaseRenderer.CSS_CLASS));
				ok(oComboBox.$().hasClass(sap.m.ComboBoxBaseRenderer.CSS_CLASS + "Error"));

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* destroy()                      */
			/* ------------------------------ */

			test("destroy()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					]
				});

				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// act
				oComboBox.destroy();
				sap.ui.getCore().applyChanges();

				// assert
				strictEqual(oComboBox.getItems().length, 0);
				ok(oComboBox.getDomRef() === null);
				ok(oComboBox.getPicker() === null);
				ok(oComboBox.getList() === null);

				// cleanup
				oComboBox.destroy();
			});

			test("calling destroy() when the picker popup is open", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				oComboBox.open();
				this.clock.tick(1000);

				// act
				oComboBox.destroy();
				sap.ui.getCore().applyChanges();

				// assert
				strictEqual(oComboBox.getItems().length, 0);
				ok(oComboBox.getDomRef() === null);
				ok(oComboBox.getPicker() === null);
				ok(oComboBox.getList() === null);
				ok(oComboBox.getAggregation("picker") === null);
			});

			/* ------------------------------------ */
			/* addAggregation() + getAggregation()  */
			/* ------------------------------------ */

			test("addAggregation() + getAggregation()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox();
				var oItem = new sap.ui.core.Item({
					key: "GER",
					text: "Germany"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				var fnAddAggregationSpy = this.spy(oComboBox, "addAggregation");
				var fnInvalidateSpy = this.spy(oComboBox, "invalidate");

				// act
				oComboBox.addAggregation("items", oItem);

				// assert
				ok(fnAddAggregationSpy.returned(oComboBox), "sap.m.ComboBox.prototype.addAggregation() returns this to allow method chaining");
				ok(fnInvalidateSpy.calledWithExactly(oItem));
				ok(oComboBox.getAggregation("items")[0] === oItem);

				// cleanup
				oComboBox.destroy();
			});

			test("addAggregation()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox();
				var oItem = new sap.ui.core.Item({
					key: "GER",
					text: "Germany"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				var fnAddAggregationSpy = this.spy(oComboBox, "addAggregation");
				var fnInvalidateSpy = this.spy(oComboBox, "invalidate");

				// act
				oComboBox.addAggregation("items", oItem, true);

				// assert
				ok(fnAddAggregationSpy.returned(oComboBox), "sap.m.ComboBox.prototype.addAggregation() returns this to allow method chaining");
				ok(!fnInvalidateSpy.calledWithExactly(oItem));
				ok(oComboBox.getAggregation("items")[0] === oItem);

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------------ */
			/* setAssociation() + getAssociation()  */
			/* ------------------------------------ */

			test("setAssociation() + getAssociation()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "CU",
							text: "Cuba"
						}),
						new sap.ui.core.Item({
							id: "item-id",
							key: "GER",
							text: "Germany"
						})
					]
				});

				// arrange
				var fnSetAssociationSpy = this.spy(oComboBox, "setAssociation");

				// act
				oComboBox.setAssociation("selectedItem", "item-id");

				// assert
				ok(fnSetAssociationSpy.returned(oComboBox), "sap.m.ComboBox.prototype.setAssociation() returns this to allow method chaining");
				ok(oComboBox.getAssociation("selectedItem") === "item-id");
				ok(oComboBox.getList().getAssociation("selectedItem") === "item-id");

				// cleanup
				oComboBox.destroy();
			});

			test("setAssociation() + getAssociation()", function() {

				// system under test
				var oItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "CU",
							text: "Cuba"
						}),
						oItem = new sap.ui.core.Item({
							id: "item-id",
							key: "GER",
							text: "Germany"
						})
					]
				});

				// arrange
				var fnSetAssociationSpy = this.spy(oComboBox, "setAssociation");

				// act
				oComboBox.setAssociation("selectedItem", oItem);

				// assert
				ok(fnSetAssociationSpy.returned(oComboBox), "sap.m.ComboBox.prototype.setAssociation() returns this to allow method chaining");
				ok(oComboBox.getAssociation("selectedItem") === "item-id");
				ok(oComboBox.getList().getAssociation("selectedItem") === "item-id");

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------------ */
			/* updateAggregation()                  */
			/* ------------------------------------ */

			// Do not clear the selection when items are destroyed.
			// When using Two-Way Data Binding and the binding are refreshed,
			// the items will be destroyed and the aggregation items is filled again.
			test("updateAggregation() do not clear the selection when items are destroyed", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: {
						path: "/contries",
						template: new sap.ui.core.Item({
							key: "{code}",
							text: "{name}"
						})
					},
					selectedKey: {
						path: "/selected"
					}
				});

				// arrange
				var oModel = new sap.ui.model.json.JSONModel();
				var mData = {
					"contries": [
						{
							"code": "GER",
							"name": "Germany"
						},
						{
							"code": "CU",
							"name": "Cuba"
						}
					],

					// path : selectedKey
					"selected": "CU"
				};

				oModel.setData(mData);
				oComboBox.setModel(oModel);
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// act
				oComboBox.updateAggregation("items");

				// assert
				strictEqual(oComboBox.getSelectedKey(), "CU");

				// cleanup
				oComboBox.destroy();
				oModel.destroy();
				sap.ui.getCore().applyChanges();
			});

			test("it should correctly set the selection if the items aggregation is bounded to an OData model", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: {
						path: "/Products",
						template: new sap.ui.core.Item({
							key: "{ProductId}",
							text: "{Name}"
						})
					}
				});

				// arrange
				var sUri = "/service/";
				var iAutoRespondAfter = 10;
				var oMockServer = fnStartMockServer(sUri, iAutoRespondAfter);
				var oModel = new sap.ui.model.odata.ODataModel(sUri, true);
				oComboBox.setModel(oModel);

				// IDs and names of the products in the model:
				//
				// id_1  Gladiator MX
				// id_2  Psimax
				// id_3  Hurricane GX
				// id_4  Webcam
				// id_5  Monitor Locking Cable
				// id_6  Laptop Case
				// id_7  Removable CD/DVD
				// id_8  USB Stick 16 GByte
				// id_9  Deskjet Super Highspeed
				// id_10 Laser Allround Pro
				// id_11 Flat S
				// id_12 Flat Medium
				// id_13 Flat X-large II
				// id_14 High End Laptop 2b
				// id_15 Very Natural Keyboard
				// id_16 Hardcore Hacker

				oComboBox.setSelectedKey("id_5");
				oComboBox.placeAt("content");
				this.clock.tick(iAutoRespondAfter + 1);	// tick the clock ahead some ms millisecond (it should be at least more than the auto respond setting to make sure that the data from the OData model is available)

				// assert
				strictEqual(oComboBox.getSelectedKey(), "id_5");
				strictEqual(oComboBox.getSelectedItem().getText(), "Monitor Locking Cable");

				// cleanup
				oMockServer.stop();
				oMockServer.destroy();
				oComboBox.destroy();
				oModel.destroy();
			});

			// BCP 1570460580
			test("it should not override the selection when binding context is changed", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					selectedKey: "{selected}",
					items: {
						path: "entries",
						template: new sap.ui.core.Item({
							key: "{key}",
							text: "{country}"
						})
					}
				});

				// arrange
				var oModel = new sap.ui.model.json.JSONModel([
					{
						selected: "DZ",
						entries: [
							{
								"key": "DZ",
								"country": "Algeria"
							},
							{
								"key": "AR",
								"country": "Argentina"
							},
							{
								"key": "AU",
								"country": "Australia"
							}
						]
					},
					{
						selected: "BA",
						entries: [
							{
								"key": "AT",
								"country": "Austria"
							},

							{
								"key": "BH",
								"country": "Bahrain"
							},

							{
								"key": "BE",
								"country": "Belgium"
							},

							{
								"key": "BA",
								"country": "Bosnia and Herzegovina"
							}
						]
					}
				]);

				oModel.setDefaultBindingMode("OneWay");
				sap.ui.getCore().setModel(oModel);
				oComboBox.setBindingContext(oModel.getContext("/1"));
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// act
				oComboBox.setBindingContext(oModel.getContext("/0"));
				sap.ui.getCore().applyChanges();

				// assert
				strictEqual(oComboBox.getSelectedKey(), "DZ");
				strictEqual(oComboBox.getValue(), "Algeria");

				// cleanup
				oComboBox.destroy();
				oModel.destroy();
			});

			/* ------------------------------------ */
			/* destroyAggregation()                 */
			/* ------------------------------------ */

			test("destroyAggregation()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "GER",
							text: "Germany"
						})
					]
				});

				// arrange
				var fnDestroyAggregationSpy = this.spy(oComboBox, "destroyAggregation");
				var fnInvalidateSpy = this.spy(oComboBox, "invalidate");

				// act
				oComboBox.destroyAggregation("items");

				// assert
				ok(fnDestroyAggregationSpy.returned(oComboBox), "sap.m.ComboBox.prototype.destroyAggregation() returns this to allow method chaining");
				strictEqual(fnInvalidateSpy.callCount, 0, "destroying the items in the list should not invalidate the input field");
				strictEqual(oComboBox.getItems().length, 0);

				// cleanup
				oComboBox.destroy();
			});

			test("destroyAggregation()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "GER",
							text: "Germany"
						})
					]
				});

				// arrange
				var fnDestroyAggregationSpy = this.spy(oComboBox, "destroyAggregation");
				var fnInvalidateSpy = this.spy(oComboBox, "invalidate");

				// act
				oComboBox.destroyAggregation("items", true);

				// assert
				ok(fnDestroyAggregationSpy.returned(oComboBox), "sap.m.ComboBox.prototype.destroyAggregation() returns this to allow method chaining");
				ok(!fnInvalidateSpy.calledOnce);
				strictEqual(oComboBox.getItems().length, 0);

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------------ */
			/* findAggregatedObjects()              */
			/* ------------------------------------ */

			test("findAggregatedObjects()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "GER",
							text: "Germany"
						})
					]
				});

				// arrange
				var fnFindAggregatedObjectsSpy = this.spy(oComboBox, "findAggregatedObjects");

				// act
				oComboBox.findAggregatedObjects();

				// assert
				ok(fnFindAggregatedObjectsSpy.returned(oComboBox.getItems()));

				// cleanup
				oComboBox.destroy();
			});

			/* -------------------------------------------------- */
			/* getBinding() + getBindingInfo() + getBindingPath() */
			/* -------------------------------------------------- */

			test("getBinding() + getBindingInfo() + getBindingPath()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox();

				// arrange
				var oModel = new sap.ui.model.json.JSONModel();
				var mData = {
					"countries": [
						{
							"value": "GER",
							"text": "Germany"
						}
					],
					"selected": "GER"
				};
				var oItemTemplate = new sap.ui.core.Item({
					key: "{select-model>value}",
					text: "{select-model>text}"
				});

				oModel.setData(mData);
				oComboBox.setModel(oModel, "select-model");

				// act
				oComboBox.bindItems({
					path: "select-model>/countries",
					template: oItemTemplate
				});

				oComboBox.bindProperty("selectedKey", {
					path: "select-model>/selected"
				});

				// assert
				ok(oComboBox.getBinding("selectedKey"));
				ok(oComboBox.getBinding("items"));
				ok(oComboBox.getBindingInfo("selectedKey"));
				ok(oComboBox.getBindingInfo("items"));
				strictEqual(oComboBox.getBindingPath("selectedKey"), "/selected");
				strictEqual(oComboBox.getBindingPath("items"), "/countries");
				ok(oComboBox.isBound("selectedKey"));
				ok(oComboBox.isBound("items"));

				// cleanup
				oComboBox.destroy();
				oModel.destroy();
			});

			/* ------------------------------------ */
			/* setProperty() + getProperty()        */
			/* ------------------------------------ */

			test('setProperty() + getProperty() test for "selectedKey" property', function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "CU",
							text: "Cuba"
						}),
						new sap.ui.core.Item({
							key: "GER",
							text: "Germany"
						})
					]
				});

				// arrange
				var fnInvalidateSpy = this.spy(oComboBox, "invalidate");

				// act
				oComboBox.setProperty("selectedKey", "GER");

				// assert
				strictEqual(oComboBox.getSelectedKey(), "GER");
				strictEqual(oComboBox.getProperty("selectedKey"), "GER");
				strictEqual(oComboBox.getList().getSelectedKey(), "GER");
				strictEqual(oComboBox.getList().getProperty("selectedKey"), "GER");
				ok(fnInvalidateSpy.called);

				// cleanup
				oComboBox.destroy();
			});

			test('setProperty() + getProperty() test for "selectedItemId" property', function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							id: "item-cu",
							key: "CU",
							text: "Cuba"
						}),
						new sap.ui.core.Item({
							id: "item-ger",
							key: "GER",
							text: "Germany"
						})
					]
				});

				// arrange
				var fnInvalidateSpy = this.spy(oComboBox, "invalidate");

				// act
				oComboBox.setProperty("selectedItemId", "item-ger", true);

				// assert
				strictEqual(oComboBox.getSelectedItemId(), "item-ger");
				strictEqual(oComboBox.getProperty("selectedItemId"), "item-ger");
				strictEqual(oComboBox.getList().getSelectedItemId(), "item-ger");
				strictEqual(oComboBox.getList().getProperty("selectedItemId"), "item-ger");

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------------ */
			/* indexOfAggregation()                 */
			/* ------------------------------------ */

			test("indexOfAggregation()", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							text: "Cuba"
						}),
						oExpectedItem = new sap.ui.core.Item({
							text: "Germany"
						})
					]
				});

				// assert
				strictEqual(oComboBox.indexOfAggregation("items", oExpectedItem), 1);

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------------ */
			/* insertAggregation()                  */
			/* ------------------------------------ */

			test("insertAggregation()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox();
				var oItem = new sap.ui.core.Item({
					text: "Germany"
				});

				// act
				oComboBox.insertAggregation("items", oItem);

				// assert
				ok(oComboBox.getItems()[0] === oItem);

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------------ */
			/* removeAggregation()                  */
			/* ------------------------------------ */

			test("removeAggregation()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "GER",
							text: "Germany"
						})
					]
				});

				// act
				oComboBox.removeAggregation("items", 0);

				// assert
				strictEqual(oComboBox.getItems().length, 0);

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------------ */
			/* removeAllAggregation()               */
			/* ------------------------------------ */

			test("removeAllAggregation()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "GER",
							text: "Germany"
						}),
						new sap.ui.core.Item({
							key: "CU",
							text: "Cuba"
						})
					]
				});

				// act
				oComboBox.removeAllAggregation("items");

				// assert
				strictEqual(oComboBox.getItems().length, 0);

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------------ */
			/* removeAllAssociation()               */
			/* ------------------------------------ */

			test("removeAllAssociation()", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							id: "ger-id",
							key: "GER",
							text: "Germany"
						}),
						oExpectedItem = new sap.ui.core.Item({
							id: "cu-id",
							key: "CU",
							text: "Cuba"
						})
					],

					selectedItem: oExpectedItem
				});

				// arrange
				var fnRemoveAllAssociationSpy = this.spy(oComboBox, "removeAllAssociation");

				// act
				oComboBox.removeAllAssociation("selectedItem");

				// assert
				ok(oComboBox.getSelectedItem() === null);
				ok(oComboBox.getList().getSelectedItem() === null);
				ok(fnRemoveAllAssociationSpy.returned("cu-id"));

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------------ */
			/* unbindProperty()                     */
			/* ------------------------------------ */

			test("unbindProperty()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox();

				// arrange
				var oModel = new sap.ui.model.json.JSONModel();
				var mData = {
					"countries": [
						{
							"code": "GER",
							"name": "Germany"
						},
						{
							"code": "CU",
							"name": "Cuba"
						}
					],
					"selected": "CU"
				};

				var oItemTemplate = new sap.ui.core.Item({
					key: "{code}",
					text: "{name}"
				});

				oComboBox.bindItems({
					path: "/countries",
					template: oItemTemplate
				});

				oComboBox.bindProperty("selectedKey", {
					path: "/selected"
				});

				oModel.setData(mData);
				oComboBox.setModel(oModel);

				// act
				oComboBox.unbindProperty("selectedKey");

				// assert
				strictEqual(oComboBox.isBound("selectedKey"), false, "The property is not bound");
				strictEqual(oComboBox.getProperty("selectedKey"), "", 'Property "selectedKey" is reset to the default value');

				// cleanup
				oComboBox.destroy();
				oModel.destroy();
			});

			/* ------------------------------------ */
			/* unbindAggregation()                  */
			/* ------------------------------------ */

			test("unbindAggregation()", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox();

				// arrange
				var oModel = new sap.ui.model.json.JSONModel();
				var mData = {
					"countries": [
						{
							"code": "GER",
							"name": "Germany"
						},
						{
							"code": "CU",
							"name": "Cuba"
						}
					],
					"selected": "CU"
				};

				var oItemTemplate = new sap.ui.core.Item({
					key: "{code}",
					text: "{name}"
				});

				oComboBox.bindItems({
					path: "/countries",
					template: oItemTemplate
				});

				oModel.setData(mData);
				oComboBox.setModel(oModel);

				// act
				oComboBox.unbindAggregation("items");

				// assert
				strictEqual(oComboBox.isBound("items"), false, 'The aggregation "items" is not bound');
				strictEqual(oComboBox.getAggregation("items", []).length, 0, 'The aggregation "items" must be reset');

				// cleanup
				oComboBox.destroy();
				oModel.destroy();
			});

			/* ------------------------------------ */
			/* setEditable()                        */
			/* ------------------------------------ */

			// BSP: 1570011983
			test("it should set the display of the combobox arrow button to none", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					editable: false
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// assert
				strictEqual(jQuery(oComboBox.getDomRef("arrow")).css("display"), "none");
			});

			/* =========================================================== */
			/* HTML module                                                 */
			/* =========================================================== */

			module("HTML");

			/* ------------------------------ */
			/* rendering                      */
			/* ------------------------------ */

			test("rendering", function() {

				// system under test
				var oComboBox0 = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1",
							enabled: false
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					]
				});

				var oComboBox1 = new sap.m.ComboBox({
					width: "50%",
					items: [
						new sap.ui.core.Item({
							key: "3",
							text: "item 3 item is not visible"
						})
					],
					visible: false
				});

				var oComboBox2 =  new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "4",
							text: "item 4"
						}),

						new sap.ui.core.Item({
							key: "5",
							text: "item 5"
						}),

						new sap.ui.core.Item({
							key: "6",
							text: "item 6"
						}),

						new sap.ui.core.Item({
							key: "7",
							text: "item 7"
						}),

						new sap.ui.core.Item({
							key: "8",
							text: "item 8"
						})
					]
				});

				var oComboBox3 = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "9",
							text: "item 9"
						}),
					]
				});

				var oComboBox4 = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "10",
							text: "item 10"
						}),

						new sap.ui.core.Item({
							key: "11",
							text: "item 11"
						}),

						new sap.ui.core.Item({
							key: "12",
							text: "item 12"
						}),

						new sap.ui.core.Item({
							key: "13",
							text: "item 13"
						}),
					],

					selectedKey: "13"
				});

				var oComboBox5 = new sap.m.ComboBox({
					width: "13rem",
					items: [
						new sap.ui.core.Item({
							key: "14",
							text: "item 14"
						}),

						new sap.ui.core.Item({
							key: "15",
							text: "item 15"
						}),

						new sap.ui.core.Item({
							key: "16",
							text: "item 16"
						}),

						new sap.ui.core.Item({
							key: "17",
							text: "item 17"
						})
					]
				});

				var oComboBox6 = new sap.m.ComboBox({
					width: "200px",
					selectedItem: "item20",

					items: [
						new sap.ui.core.Item({
							key: "18",
							text: "item 18"
						}),

						new sap.ui.core.Item({
							key: "19",
							text: "item 19"
						}),

						new sap.ui.core.Item({
							key: "20",
							text: "item 20"
						}),

						new sap.ui.core.Item({
							key: "21",
							text: "item 21"
						})
					]
				});

				var oComboBox7 = new sap.m.ComboBox({
					selectedKey: "23",

					items: [
						new sap.ui.core.Item({
							key: "22",
							text: "item 22"
						}),

						new sap.ui.core.Item({
							key: "23",
							text: "item 23"
						}),

						new sap.ui.core.Item({
							key: "24",
							text: "item 24"
						})
					]
				});

				var oComboBox8 = new sap.m.ComboBox({
					width: "4em",
					items: []
				});

				var oComboBox9 = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "25",
							text: "item 25"
						}),

						new sap.ui.core.Item({
							key: "26",
							text: "item 26"
						}),

						new sap.ui.core.Item({
							key: "27",
							text: "item 27"
						})
					]
				});

				var oComboBox10 = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "28",
							text: "item 28"
						}),

						new sap.ui.core.Item({
							key: "29",
							text: "item 29"
						}),

						new sap.ui.core.Item({
							key: "30",
							text: "item 30"
						})
					]
				});

				var oComboBox11 = new sap.m.ComboBox({
					width: "2in",
					items: [
						new sap.ui.core.Item({
							key: "31",
							text: "item 31"
						}),

						new sap.ui.core.Item({
							key: "32",
							text: "item 32"
						}),

						new sap.ui.core.Item({
							key: "33",
							text: "item 33"
						})
					]
				});

				var oComboBox12 = new sap.m.ComboBox({
					width: "3cm",
					items: [
						new sap.ui.core.Item({
							key: "34",
							text: "item 34"
						}),

						new sap.ui.core.Item({
							key: "35",
							text: "item 35"
						}),

						new sap.ui.core.Item({
							key: "36",
							text: "item 36"
						})
					]
				});

				var oComboBox13 = new sap.m.ComboBox({
					width: "125pt",
					items: [
						new sap.ui.core.Item({
							key: "37",
							text: "item 37"
						}),

						new sap.ui.core.Item({
							key: "38",
							text: "item 38"
						}),

						new sap.ui.core.Item({
							key: "39",
							text: "item 39"
						})
					]
				});

				var oComboBox14 = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "40",
							text: "item 40"
						}),

						new sap.ui.core.Item({
							key: "41",
							text: "item 41"
						}),

						new sap.ui.core.Item({
							key: "42",
							text: "item 42"
						})
					]
				});

				var oComboBox15 = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "43",
							text: "item 43"
						}),

						new sap.ui.core.Item({
							key: "44",
							text: "item 44"
						}),

						new sap.ui.core.Item({
							key: "45",
							text: "item 45"
						})
					]
				});

				var oComboBox16 = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "46",
							text: "item 46"
						}),

						new sap.ui.core.Item({
							key: "47",
							text: "item 47"
						}),

						new sap.ui.core.Item({
							key: "48",
							text: "item 48"
						})
					]
				});

				var oComboBox17 = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "49",
							text: "item 49"
						}),

						new sap.ui.core.Item({
							key: "50",
							text: "item 50"
						}),

						new sap.ui.core.Item({
							key: "51",
							text: "item 51"
						})
					]
				});

				var oComboBox8 = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "52",
							text: "item 52"
						}),

						new sap.ui.core.Item({
							key: "53",
							text: "item 53"
						}),

						new sap.ui.core.Item({
							key: "54",
							text: "item 54"
						}),
					]
				});

				var aComboBox = [oComboBox1, oComboBox2, oComboBox3, oComboBox4, oComboBox5, oComboBox6, oComboBox7, oComboBox8];

				// arrange
				oComboBox1.placeAt("content");
				oComboBox2.placeAt("content");
				oComboBox3.placeAt("content");
				oComboBox4.placeAt("content");
				oComboBox5.placeAt("content");
				oComboBox6.placeAt("content");
				oComboBox7.placeAt("content");
				oComboBox8.placeAt("content");
				sap.ui.getCore().applyChanges();

				// assert
				aComboBox.forEach(function(oComboBox) {

					if (!oComboBox.getVisible()) {
						return;
					}

					ok(oComboBox.getDomRef(), "The combobox element exists");
					strictEqual(oComboBox.getFocusDomRef().getAttribute("autocomplete"), "off");
					strictEqual(oComboBox.getFocusDomRef().getAttribute("autocorrect"), "off");
					strictEqual(oComboBox.getFocusDomRef().getAttribute("autocapitalize"), "off");
					strictEqual(oComboBox.getFocusDomRef().getAttribute("role"), "combobox");
					strictEqual(oComboBox.getFocusDomRef().getAttribute("aria-expanded"), "false");
					strictEqual(oComboBox.getFocusDomRef().getAttribute("aria-autocomplete"), "both");
					strictEqual(jQuery(oComboBox.getFocusDomRef()).attr("aria-required"), undefined);
					ok(oComboBox.$().hasClass(sap.m.ComboBoxBaseRenderer.CSS_CLASS), 'The combo box element has the CSS class "' + sap.m.ComboBoxBaseRenderer.CSS_CLASS + '"');
					ok(oComboBox.$("arrow").length, "The HTML span element for the arrow exists");
					ok(oComboBox.$("arrow").hasClass(sap.m.ComboBoxBaseRenderer.CSS_CLASS + "Arrow"), 'The arrow button has the CSS class "' + sap.m.ComboBoxBaseRenderer.CSS_CLASS + 'Arrow"');
					ok(oComboBox.$("arrow").hasClass(sap.m.ComboBoxRenderer.CSS_CLASS + "Arrow"), 'The arrow button has the CSS class "' + sap.m.ComboBoxRenderer.CSS_CLASS + 'Arrow"');
					strictEqual(oComboBox.getDomRef("arrow").getAttribute("tabindex"), "-1", "The arrow button is focusable, but it is not reachable via sequential keyboard navigation");
					strictEqual(oComboBox.getDomRef("arrow").getAttribute("aria-labelledby"), oComboBox.getDomRef("buttonlabel").id);
					ok(oComboBox.getDomRef("buttonlabel"), "The button label exists");
					ok(oComboBox.$("buttonlabel").hasClass("sapUiInvisibleText"));
					ok(oComboBox.$("buttonlabel").hasClass(sap.m.ComboBoxBaseRenderer.CSS_CLASS + "ButtonLabel"));
					strictEqual(getComputedStyle(oComboBox.getDomRef("buttonlabel")).getPropertyValue("display"), "none");

					// cleanup
					oComboBox.destroy();
				});
			});

			asyncTest("Check Busy State", function() {
				expect(9);

				var oComboBox = new sap.m.ComboBox("busyCheck", {
					busyIndicatorDelay : 0,
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1",
							enabled: false
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					]
				}).placeAt("content");
				sap.ui.getCore().applyChanges();

				window._setTimeout(function() {
					var $Box = oComboBox.$();
					var $Input = oComboBox.$("inner");
					var $Arrow = oComboBox.$("arrow");

					// there should be no tabindex for the root DOM-ref and the input field
					// for the arrow there is a tabindex=-1 per default
					equal($Box.attr("tabindex"), undefined, "No tabindex at root DOM-ref");
					equal($Input.attr("tabindex"), undefined, "No tabindex for Input field");
					equal($Arrow.attr("tabindex"), -1, "Tabindex set for Arrow");

					oComboBox.setBusy(true);

					window._setTimeout(function() {
						// check whether all element do have a tabindex now
						equal($Box.attr("tabindex"), -1, "Tabindex set to -1 at root DOM-ref");
						equal($Input.attr("tabindex"), -1, "Tabindex set to -1 for Input field");
						equal($Arrow.attr("tabindex"), -1, "Still tabindex set for Arrow");

						oComboBox.setBusy(false);

						window._setTimeout(function() {
							// check whether all element have their default tabindex value
							equal($Box.attr("tabindex"), undefined, "Tabindex removed from root DOM-ref");
							equal($Input.attr("tabindex"), undefined, "Tabindex removed from Input field");
							equal($Arrow.attr("tabindex"), -1, "Still Tabindex set for Arrow");

							start();

							// cleanup
							oComboBox.destroy();
						}, 10)
					}, 10);

				}, 10);

				// cleanup
				//oComboBox.destroy();
			});

			/* =========================================================== */
			/* Events module                                               */
			/* =========================================================== */

			module("Events");

			/* ------------------------------ */
			/* touchstart                     */
			/* ------------------------------ */

			var touchstartTestCase = function(sTestName, mOptions) {

				test("event: touchstart()", function() {

					// system under test
					var oComboBox = mOptions.control;

					// arrange + act
					oComboBox.placeAt("content");
					sap.ui.getCore().applyChanges();
					sap.ui.test.qunit.triggerTouchEvent("touchstart", oComboBox.getDomRef(mOptions.input), {
						touches: {
							0: {
								pageX: 10,
								length: 1
							},

							length: 1
						},

						targetTouches: {
							0: {
								pageX: 10,
								length: 1
							},

							length: 1
						}
					});

					var bHasClass = oComboBox.getDomRef().className.split(" ").some(function(sClass) {
						return sClass === sap.m.ComboBoxBaseRenderer.CSS_CLASS + "Pressed";
					});

					// assert
					strictEqual(bHasClass, mOptions.output);

					// cleanup
					oComboBox.destroy();
				});
			};

			touchstartTestCase("", {
				input: "arrow",
				output: true,
				control: new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					]
				})
			});

			touchstartTestCase("", {
				input: "arrow",
				output: false,
				control: new sap.m.ComboBox({
					enabled: false,
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					]
				})
			});

			touchstartTestCase("", {
				input: "arrow",
				output: false,
				control: new sap.m.ComboBox({
					editable: false,
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						})
					]
				})
			});

			/* ------------------------------ */
			/* touchend                       */
			/* ------------------------------ */

			test("touchend", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						}),
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// act
				sap.ui.test.qunit.triggerTouchEvent("touchstart", oComboBox.getOpenArea(), {
					touches: {
						0: {
							pageX: 10,
							length: 1
						},

						length: 1
					},

					targetTouches: {
						0: {
							pageX: 10,
							length: 1
						},

						length: 1
					}
				});

				sap.ui.test.qunit.triggerTouchEvent("touchend", oComboBox.getOpenArea(), {
					targetTouches: {
						0: {
							pageX: 10,
							length: 1
						},

						length: 1
					}
				});

				// assert
				ok(!oComboBox.$().hasClass(sap.m.ComboBoxBaseRenderer.CSS_CLASS + "Pressed"), 'The ComboBox must not have the CSS class "' + sap.m.ComboBoxBaseRenderer.CSS_CLASS + 'Pressed"');

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* tap                            */
			/* ------------------------------ */

			test("tap", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "GER",
							text: "Germany"
						})
					],
					selectedKey: "GER"
				});

				// arrange
				var fnTapSpy = this.spy(oComboBox, "ontap"),
					fnPickerCloseSpy,
					fnPickerIsOpenSpy,
					fnOpenSpy;

				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				this.clock.tick(0);	// tick the clock ahead 0ms millisecond to make sure the async call to .selectText() on the focusin event handler does not override the type ahead

				sap.ui.test.qunit.triggerTouchEvent("touchstart", oComboBox.getOpenArea(), {
					touches: {
						0: {
							pageX: 10,
							length: 1
						},

						length: 1
					},

					targetTouches: {
						0: {
							pageX: 10,
							length: 1
						},

						length: 1
					}
				});

				fnOpenSpy = this.spy(oComboBox.getPicker(), "open");
				fnPickerCloseSpy = this.spy(oComboBox.getPicker(), "close");
				fnPickerIsOpenSpy = this.spy(oComboBox.getPicker(), "isOpen");

				sap.ui.test.qunit.triggerTouchEvent("touchend", oComboBox.getOpenArea(), {
					targetTouches: {
						0: {
							pageX: 10,
							length: 1
						},

						length: 1
					}
				});

				sap.ui.test.qunit.triggerTouchEvent("tap", oComboBox.getOpenArea(), {
					targetTouches: {
						0: {
							pageX: 10,
							length: 1
						},

						length: 1
					}
				});

				// assert
				ok(fnTapSpy.calledOnce, "ontap() event handler must be called exactly once");
				strictEqual(fnPickerCloseSpy.callCount, 0, "close() method of the popover must not be called");
				strictEqual(fnOpenSpy.callCount, 1, "open() method was called exactly once");
				ok(oComboBox.$().hasClass(sap.m.ComboBoxBaseRenderer.CSS_CLASS + "Pressed"), 'The ComboBox must have the css class "' + sap.m.ComboBoxBaseRenderer.CSS_CLASS + 'Pressed"');
				this.clock.tick(0);

				if (sap.ui.Device.system.desktop) {
					strictEqual(oComboBox.getFocusDomRef().selectionStart, 0, "The text should be selected");
					strictEqual(oComboBox.getFocusDomRef().selectionEnd, 7, "The text should be selected");
				}

				// cleanup
				oComboBox.destroy();
			});

			test("tap control is not editable", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					editable: false,
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						}),
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				sap.ui.test.qunit.triggerTouchEvent("touchstart", oComboBox.getOpenArea(), {
					touches: {
						0: {
							pageX: 10,
							length: 1
						},

						length: 1
					},

					targetTouches: {
						0: {
							pageX: 10,
							length: 1
						},

						length: 1
					}
				});

				sap.ui.test.qunit.triggerTouchEvent("touchend", oComboBox.getOpenArea(), {
					targetTouches: {
						0: {
							pageX: 10,
							length: 1
						},

						length: 1
					}
				});

				sap.ui.test.qunit.triggerTouchEvent("tap", oComboBox.getOpenArea(), {
					targetTouches: {
						0: {
							pageX: 10,
							length: 1
						},

						length: 1
					}
				});

				// assert
				strictEqual(oComboBox.isOpen(), false, "Control picker pop-up is closed");
				ok(!oComboBox.$().hasClass(sap.m.ComboBoxBaseRenderer.CSS_CLASS + "Pressed"), "The ComboBox's input field must not have the css class '" + sap.m.ComboBoxBaseRenderer.CSS_CLASS + "Pressed'");

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* onsapshow                      */
			/* ------------------------------ */

			test("onsapshow F4 - open the picker pop-up", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				var fnShowSpy = this.spy(oComboBox, "onsapshow");

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.F4);

				// assert
				strictEqual(fnShowSpy.callCount, 1, "onsapshow() method was called exactly once");

				if (jQuery.support.cssAnimations) {
					strictEqual(oComboBox.getPicker().oPopup.getOpenState(), sap.ui.core.OpenState.OPENING, "Control's picker pop-up is opening");
				}

				this.clock.tick(1000);
				strictEqual(oComboBox.getPicker().oPopup.getOpenState(), sap.ui.core.OpenState.OPEN, "Control's picker pop-up is open");
				ok(oComboBox.isOpen(), "Control picker pop-up is open");

				// cleanup
				oComboBox.destroy();
			});

			test("onsapshow F4 - when F4 or Alt + DOWN keys are pressed and the control's field is not editable, the picker pop-up should not open", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					editable: false,
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.F4);

				// assert
				this.clock.tick(1000);
				strictEqual(oComboBox.getPicker().oPopup.getOpenState(), sap.ui.core.OpenState.CLOSED, "Control's picker pop-up is closed");
				strictEqual(oComboBox.isOpen(), false, "Control picker pop-up is closed");

				// cleanup
				oComboBox.destroy();
			});

			test("onsapshow Alt + DOWN - open the picker pop-up", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				var fnShowSpy = this.spy(oComboBox, "onsapshow");

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_DOWN, false, true);

				// assert
				strictEqual(fnShowSpy.callCount, 1, "onsapshow() method was called exactly once");

				if (jQuery.support.cssAnimations) {
					strictEqual(oComboBox.getPicker().oPopup.getOpenState(), sap.ui.core.OpenState.OPENING, "Control's picker pop-up is opening");
				}

				this.clock.tick(1000);
				strictEqual(oComboBox.getPicker().oPopup.getOpenState(), sap.ui.core.OpenState.OPEN, "Control picker pop-up is open");
				ok(oComboBox.isOpen(), "ComboBox is open");

				// cleanup
				oComboBox.destroy();
			});

			test("onsapshow F4 - when F4 or Alt + DOWN keys are pressed and the control's field is not editable, the picker pop-up should not open", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					editable: false,
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_DOWN, false, true);

				// assert
				this.clock.tick(1000);
				strictEqual(oComboBox.getPicker().oPopup.getOpenState(), sap.ui.core.OpenState.CLOSED, "Control's picker pop-up is closed");
				strictEqual(oComboBox.isOpen(), false, "Control picker pop-up is closed");

				// cleanup
				oComboBox.destroy();
			});

			test("onsapshow F4 - close control's picker pop-up", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				var fnShowSpy = this.spy(oComboBox, "onsapshow");

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.F4);	// open the picker pop-up
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.F4);	// close the picker pop-up
				this.clock.tick(1000);

				// assert
				strictEqual(fnShowSpy.callCount, 2, "onsapshow() method was called twice");
				strictEqual(oComboBox.getPicker().oPopup.getOpenState(), sap.ui.core.OpenState.CLOSED, "Control's picker pop-up is close");

				// cleanup
				oComboBox.destroy();
			});

			test("onsapshow Alt + DOWN or F4 - clear the filter", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							text: "Algeria"
						}),

						new sap.ui.core.Item({
							text: "Argentina"
						}),

						new sap.ui.core.Item({
							text: "Australia"
						}),

						new sap.ui.core.Item({
							text: "Germany"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				oComboBox.open();
				this.clock.tick(1000);
				oComboBox.getFocusDomRef().value = "A";
				sap.ui.qunit.QUnitUtils.triggerEvent("input", oComboBox.getFocusDomRef());

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.F4);	// close the picker pop-up
				this.clock.tick(1000);	// wait 1s after the close animation is completed

				// assert
				strictEqual(oComboBox.getVisibleItems().length, 4, "The filter is cleared");

				// cleanup
				oComboBox.destroy();
			});

			test("onsapshow Alt + DOWN - close control's picker pop-up", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				var fnShowSpy = this.spy(oComboBox, "onsapshow");

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_DOWN, false, true);	// open the picker pop-up
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_DOWN, false, true);	// close the picker pop-up
				this.clock.tick(1000);

				// assert
				strictEqual(fnShowSpy.callCount, 2, "onsapshow() method was called twice");
				strictEqual(oComboBox.getPicker().oPopup.getOpenState(), sap.ui.core.OpenState.CLOSED, "Control's picker pop-up is close");

				// cleanup
				oComboBox.destroy();
			});

			test("onsapshow Alt + DOWN - open the control's picker pop-up and select the text", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "GER",
							text: "Germany"
						})
					],
					selectedKey: "GER"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				this.clock.tick(0);	// tick the clock ahead 0ms millisecond to make sure the async call to .selectText() on the focusin event handler does not override the type ahead
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_RIGHT);

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_DOWN, false, true /* ctrl key is down */);	// open the picker pop-up

				// assert
				strictEqual(oComboBox.getFocusDomRef().selectionStart, 0, "The text should be selected");
				strictEqual(oComboBox.getFocusDomRef().selectionEnd, 7, "The text should be selected");

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* onsaphide                      */
			/* ------------------------------ */

			test("onsaphide Alt + UP - open control's picker pop-up", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				var fnHideSpy = this.spy(oComboBox, "onsaphide");

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_UP, false, true, false);

				// assert
				strictEqual(fnHideSpy.callCount, 1, "onsaphide() method was called exactly once");

				if (jQuery.support.cssAnimations) {
					strictEqual(oComboBox.getPicker().oPopup.getOpenState(), sap.ui.core.OpenState.OPENING, "Control's picker pop-up is opening");
				}

				this.clock.tick(1000);
				strictEqual(oComboBox.getPicker().oPopup.getOpenState(), sap.ui.core.OpenState.OPEN, "Control's picker pop-up is open");
				ok(oComboBox.isOpen(), "Control's picker pop-up is open");

				// cleanup
				oComboBox.destroy();
			});

			test("onsaphide Alt + UP - keys are pressed and the control's field is not editable, the picker pop-up should not open", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					editable: false,
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_UP, false, true, false);

				// assert
				this.clock.tick(1000);
				strictEqual(oComboBox.getPicker().oPopup.getOpenState(), sap.ui.core.OpenState.CLOSED, "Control's picker pop-up is closed");
				strictEqual(oComboBox.isOpen(), false, "Control picker pop-up is closed");

				// cleanup
				oComboBox.destroy();
			});

			test("onsaphide Alt + UP - close control's picker pop-up", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				var fnHideSpy = this.spy(oComboBox, "onsaphide");

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_UP, false, true, false);
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_UP, false, true, false);
				this.clock.tick(1000);

				// assert
				strictEqual(fnHideSpy.callCount, 2, "onsaphide() method was called twice");
				strictEqual(oComboBox.getPicker().oPopup.getOpenState(), sap.ui.core.OpenState.CLOSED, "Control's picker pop-up is close");

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* onsapescape                    */
			/* ------------------------------ */

			test("onsapescape - close the picker popup", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				var fnEscapeSpy = this.spy(oComboBox, "onsapescape");
				var fnCloseSpy = this.spy(oComboBox, "close");

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ESCAPE);

				// assert
				strictEqual(fnEscapeSpy.callCount, 1, "onsapescape() method was called exactly once");
				strictEqual(fnCloseSpy.callCount, 0, "close() method is not called");

				// cleanup
				oComboBox.destroy();
			});

			test("onsapescape - close the picker popup", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							text: "Algeria"
						}),

						new sap.ui.core.Item({
							text: "Argentina"
						}),

						new sap.ui.core.Item({
							text: "Australia"
						}),

						new sap.ui.core.Item({
							text: "Germany"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				oComboBox.open();
				this.clock.tick(1000);
				oComboBox.getFocusDomRef().value = "A";
				sap.ui.qunit.QUnitUtils.triggerEvent("input", oComboBox.getFocusDomRef());
				var fnEscapeSpy = this.spy(oComboBox, "onsapescape");
				var fnCloseSpy = this.spy(oComboBox, "close");

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ESCAPE);
				this.clock.tick(1000);	// wait 1s after the close animation is completed

				// assert
				strictEqual(fnEscapeSpy.callCount, 1, "onsapescape() method was called exactly once");
				strictEqual(fnCloseSpy.callCount, 1, "close() method was called exactly once");
				strictEqual(oComboBox.getVisibleItems().length, 4, "The filter is cleared");

				// cleanup
				oComboBox.destroy();
			});

			test("onsapescape - when escape is pressed and the controls's field is not editable, the picker pop-up should not close", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					editable: false,
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				oComboBox.open();
				this.clock.tick(1000);

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ESCAPE);

				// assert
				strictEqual(oComboBox.getPicker().oPopup.getOpenState(), sap.ui.core.OpenState.OPEN, "Control's picker pop-up is open");
				strictEqual(oComboBox.isOpen(), true);

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* onsapenter                     */
			/* ------------------------------ */

			test("onsapenter - close control's picker pop-up", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				oComboBox.open();
				this.clock.tick(1000);

				var fnEnterSpy = this.spy(oComboBox, "onsapenter");
				var fnCloseSpy = this.spy(oComboBox, "close");

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ENTER);

				// assert
				strictEqual(fnEnterSpy.callCount, 1, "onsapenter() method was called exactly once");
				strictEqual(fnCloseSpy.callCount, 1, "close() method was called exactly once");

				// cleanup
				oComboBox.destroy();
			});

			test("onsapenter - close control's picker pop-up and clear the filter", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							text: "Algeria"
						}),

						new sap.ui.core.Item({
							text: "Argentina"
						}),

						new sap.ui.core.Item({
							text: "Australia"
						}),

						new sap.ui.core.Item({
							text: "Germany"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				oComboBox.getFocusDomRef().value = "A";
				sap.ui.qunit.QUnitUtils.triggerEvent("input", oComboBox.getFocusDomRef());
				this.clock.tick(1000);

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ENTER);
				this.clock.tick(1000);	// wait 1s after the close animation is completed

				// assert
				strictEqual(oComboBox.getVisibleItems().length, 4, "The filter is cleared");

				// cleanup
				oComboBox.destroy();
			});

			test("onsapenter - when enter key is pressed and the control's field is not editable, the control's picker pop-up should not close", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					editable: false,
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				oComboBox.open();
				this.clock.tick(1000);

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ENTER);

				// assert
				strictEqual(oComboBox.getPicker().oPopup.getOpenState(), sap.ui.core.OpenState.OPEN, "Control's picker pop-up is open");
				strictEqual(oComboBox.isOpen(), true);

				// cleanup
				oComboBox.destroy();
			});

			test("onsapenter", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						})
					],

					selectedKey: "0"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				oComboBox.open();
				this.clock.tick(1000);
				oComboBox.selectText(0, 6);

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ENTER);
				// note: after the onsapenter() method is called, the cursor position change

				// assert
				strictEqual(oComboBox.getFocusDomRef().selectionStart, 6, "The text should not be selected");
				strictEqual(oComboBox.getFocusDomRef().selectionEnd, 6, "The text should not be selected");
				strictEqual(jQuery(oComboBox.getFocusDomRef()).cursorPos(), 6, "The cursor position is at the end of the text");

				// cleanup
				oComboBox.destroy();
			});

			test("onsapenter", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				oComboBox.open();
				this.clock.tick(1000);

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_DOWN);
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ENTER);

				// assert
				strictEqual(jQuery(oComboBox.getFocusDomRef()).cursorPos(), 6, "The cursor position is at the end of the text");

				// cleanup
				oComboBox.destroy();
			});

			test("onsapenter", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "GER",
							text: "Germany"
						}),
						new sap.ui.core.Item({
							key: "CU",
							text: "Cuba"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				this.clock.tick(0);	// tick the clock ahead 0ms millisecond to make sure the async call to .selectText() on the focusin event handler does not override the type ahead

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_DOWN);
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ENTER);

				// assert
				strictEqual(oComboBox.getFocusDomRef().selectionStart, 7, "The text should not be selected");
				strictEqual(oComboBox.getFocusDomRef().selectionEnd, 7, "The text should not be selected");

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* onsapdown                      */
			/* ------------------------------ */

			test("onsapdown", function() {

				// system under test
				var oExpectedItem;
				var sExpectedValue = "item 1 is selected";
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0",
							enabled: false
						}),

						oExpectedItem = new sap.ui.core.Item({
							key: "1",
							text: "item 1 is selected"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				this.clock.tick(0);	// tick the clock ahead 0ms millisecond to make sure the async call to .selectText() on the focusin event handler does not override the type ahead
				var fnKeyDownSpy = this.spy(oComboBox, "onsapdown");
				var fnFireSelectionChangeSpy = this.spy(oComboBox, "fireSelectionChange");

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_DOWN);

				// assert
				strictEqual(fnKeyDownSpy.callCount, 1, "onsapdown() method was called exactly once");
				strictEqual(fnFireSelectionChangeSpy.callCount, 1, 'The "selectionChange" event is fired');
				strictEqual(jQuery(oComboBox.getFocusDomRef()).getSelectedText(), sExpectedValue);
				ok(oComboBox.getSelectedItem() === oExpectedItem);
				ok(oComboBox.getList().getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getFocusDomRef().value, sExpectedValue);
				strictEqual(jQuery(oComboBox.getFocusDomRef()).attr("aria-activedescendant"), undefined, 'The "aria-activedescendant" attribute is set when the active descendant is rendered and visible');

				// cleanup
				oComboBox.destroy();
			});

			test("onsapdown - when keyboard DOWN key is pressed and the control is not editable, the value should not change", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					editable: false,
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				var fnFireSelectionChangeSpy = this.spy(oComboBox, "fireSelectionChange");

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_DOWN);

				// assert
				strictEqual(fnFireSelectionChangeSpy.callCount, 0, 'The "selectionChange" event was not fired');
				ok(oComboBox.getSelectedItem() === null);
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getFocusDomRef().value, "");
				strictEqual(jQuery(oComboBox.getFocusDomRef()).attr("aria-activedescendant"), undefined, 'The "aria-activedescendant" attribute is set when the active descendant is rendered and visible');

				// cleanup
				oComboBox.destroy();
			});

			test("onsapdown", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0",
							enabled: false
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1",
							enabled: false
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2",
							enabled: false
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				var fnKeyDownSpy = this.stub(oComboBox, "onsapdown");
				var fnFireSelectionChangeSpy = this.spy(oComboBox, "fireSelectionChange");

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_DOWN);

				// assert
				strictEqual(fnKeyDownSpy.callCount, 1, "onsapdown() method was called exactly once");
				strictEqual(fnFireSelectionChangeSpy.callCount, 0, 'The "selectionChange" event is not fired');
				ok(oComboBox.getSelectedItem() === null);
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getValue(), "");
				strictEqual(oComboBox.getProperty("value"), "");
				strictEqual(jQuery(oComboBox.getFocusDomRef()).attr("aria-activedescendant"), undefined, 'The "aria-activedescendant" attribute is set when the active descendant is rendered and visible');

				// cleanup
				oComboBox.destroy();
			});

			test("onsapdown", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						oExpectedItem = new sap.ui.core.Item({
							key: "0",
							text: "item 0"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1",
							enabled: false
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2",
							enabled: false
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				this.clock.tick(0);	// tick the clock ahead 0ms millisecond to make sure the async call to .selectText() on the focusin event handler does not override the type ahead
				var fnKeyDownSpy = this.spy(oComboBox, "onsapdown");
				var fnFireSelectionChangeSpy = this.spy(oComboBox, "fireSelectionChange");

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_DOWN);

				// assert
				strictEqual(fnKeyDownSpy.callCount, 1, "onsapdown() method was called exactly once");
				strictEqual(fnFireSelectionChangeSpy.callCount, 1, 'The "selectionChange" event is fired');
				strictEqual(jQuery(oComboBox.getFocusDomRef()).getSelectedText(), "item 0");
				ok(oComboBox.getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getFocusDomRef().value, "item 0");
				ok(oComboBox.getList().getSelectedItem() === oExpectedItem);
				strictEqual(jQuery(oComboBox.getFocusDomRef()).attr("aria-activedescendant"), undefined, 'The "aria-activedescendant" attribute is set when the active descendant is rendered and visible');

				// cleanup
				oComboBox.destroy();
			});

			test("onsapdown changing the value in attachSelectionChange event handler", function() {

				// system under test
				var sExpectedValue = "GER Germany";
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "GER",
							text: "Germany"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				this.clock.tick(0);	// tick the clock ahead 0ms millisecond to make sure the async call to .selectText() on the focusin event handler does not override the type ahead
				oComboBox.attachSelectionChange(function(oControlEvent) {
					this.setValue(sExpectedValue);
				}, oComboBox);

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_DOWN);
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_DOWN);

				// assert
				strictEqual(oComboBox.getValue(), sExpectedValue);
				strictEqual(oComboBox.getProperty("value"), sExpectedValue);
				strictEqual(jQuery(oComboBox.getFocusDomRef()).getSelectedText(), sExpectedValue);

				// cleanup
				oComboBox.destroy();
			});

			test("onsapdown the typed value should not gets selected (test case 1)", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							text: "Algeria"
						}),

						new sap.ui.core.Item({
							text: "Argentina"
						}),

						new sap.ui.core.Item({
							text: "Australia"
						}),

						new sap.ui.core.Item({
							text: "Germany"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				this.clock.tick(0);	// tick the clock ahead 0ms millisecond to make sure the async call to .selectText() on the focusin event handler does not override the type ahead
				sap.ui.qunit.QUnitUtils.triggerEvent("keydown", oComboBox.getFocusDomRef(), {
					which: jQuery.sap.KeyCodes.A
				});
				oComboBox.getFocusDomRef().value = "A";
				sap.ui.qunit.QUnitUtils.triggerEvent("input", oComboBox.getFocusDomRef());
				this.clock.tick(1000);

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_DOWN);

				// assert
				strictEqual(oComboBox.getFocusDomRef().value, "Argentina");
				strictEqual(jQuery(oComboBox.getFocusDomRef()).getSelectedText(), "rgentina");

				// cleanup
				oComboBox.destroy();
			});

			test("onsapdown the typed value should not gets selected (test case 2)", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							text: "Algeria"
						}),

						new sap.ui.core.Item({
							text: "Argentina"
						}),

						new sap.ui.core.Item({
							text: "Australia"
						}),

						new sap.ui.core.Item({
							text: "Germany"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				this.clock.tick(0);	// tick the clock ahead 0ms millisecond to make sure the async call to .selectText() on the focusin event handler does not override the type ahead
				sap.ui.qunit.QUnitUtils.triggerEvent("keydown", oComboBox.getFocusDomRef(), {
					which: jQuery.sap.KeyCodes.A
				});
				oComboBox.getFocusDomRef().value = "A";
				sap.ui.qunit.QUnitUtils.triggerEvent("input", oComboBox.getFocusDomRef());
				jQuery(oComboBox.getFocusDomRef()).cursorPos(0);
				this.clock.tick(1000);

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_DOWN);

				// assert
				strictEqual(oComboBox.getFocusDomRef().value, "Argentina");
				strictEqual(jQuery(oComboBox.getFocusDomRef()).getSelectedText(), "Argentina");

				// cleanup
				oComboBox.destroy();
			});

			test('onsapdown the attribute "aria-activedescendant" is set', function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						oExpectedItem = new sap.ui.core.Item({
							text: "Algeria"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				oComboBox.open();
				this.clock.tick(1000);	// wait after the open animation is completed
				var sExpectedActiveDescendantId = oExpectedItem.getId();

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_DOWN);

				// assert
				strictEqual(oComboBox.getFocusDomRef().getAttribute("aria-activedescendant"), sExpectedActiveDescendantId);

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* onsapup                        */
			/* ------------------------------ */

			test("onsapup", function() {

				// system under test
				var oItem;
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						oExpectedItem = new sap.ui.core.Item({
							key: "0",
							text: "item 0 is selected"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1",
							enabled: false
						}),

						oItem = new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					],

					selectedItem: oItem
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				var fnKeyUpSpy = this.spy(oComboBox, "onsapup");
				var fnFireSelectionChangeSpy = this.spy(oComboBox, "fireSelectionChange");

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_UP);

				// assert
				strictEqual(fnKeyUpSpy.callCount, 1, "onsapup() method was called exactly once");
				strictEqual(fnFireSelectionChangeSpy.callCount, 1, 'The "selectionChange" event was fired');
				strictEqual(jQuery(oComboBox.getFocusDomRef()).getSelectedText(), "item 0 is selected");
				ok(oComboBox.getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getFocusDomRef().value, "item 0 is selected");
				ok(oComboBox.getList().getSelectedItem() === oExpectedItem);
				strictEqual(jQuery(oComboBox.getFocusDomRef()).attr("aria-activedescendant"), undefined, 'The "aria-activedescendant" attribute is set when the active descendant is rendered and visible');

				// cleanup
				oComboBox.destroy();
			});

			test("onsapup - when keyboard UP key is pressed and the control is not editable, the value should not change", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					editable: false,
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0 is selected"
						}),

						oExpectedItem = new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						})
					],

					selectedItem: oExpectedItem
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				var fnFireSelectionChangeSpy = this.spy(oComboBox, "fireSelectionChange");

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_UP);

				// assert
				strictEqual(fnFireSelectionChangeSpy.callCount, 0, 'The "selectionChange" event was not fired');
				ok(oComboBox.getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getFocusDomRef().value, "item 1");
				ok(oComboBox.getList().getSelectedItem() === oExpectedItem);
				strictEqual(jQuery(oComboBox.getFocusDomRef()).attr("aria-activedescendant"), undefined, 'The "aria-activedescendant" attribute is set when the active descendant is rendered and visible');

				// cleanup
				oComboBox.destroy();
			});

			test("onsapup", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0",
							enabled: false
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1",
							enabled: false
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2",
							enabled: false
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				var fnKeyUpSpy = this.spy(oComboBox, "onsapup");
				var fnFireSelectionChangeSpy = this.spy(oComboBox, "fireSelectionChange");

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_UP);

				// assert
				strictEqual(fnKeyUpSpy.callCount, 1, "onsapup() method was called exactly once");
				ok(oComboBox.getSelectedItem() === null);
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getValue(), "");
				strictEqual(oComboBox.getProperty("value"), "");
				strictEqual(jQuery(oComboBox.getFocusDomRef()).attr("aria-activedescendant"), undefined, 'The "aria-activedescendant" attribute is set when the active descendant is rendered and visible');

				// cleanup
				oComboBox.destroy();
			});

			test("onsapup", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0",
							enabled: false
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1",
							enabled: false
						}),

						oExpectedItem = new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					],

					selectedItem: oExpectedItem
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				var fnKeyUpSpy = this.stub(oComboBox, "onsapup");
				var fnFireSelectionChangeSpy = this.spy(oComboBox, "fireSelectionChange");

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_UP);

				// assert
				strictEqual(fnKeyUpSpy.callCount, 1, "onsapup() method was called exactly once");
				strictEqual(fnFireSelectionChangeSpy.callCount, 0, 'The "selectionChange" event is not fired');
				ok(oComboBox.getSelectedItem() === oExpectedItem);
				ok(oComboBox.getList().getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getValue(), "item 2");
				strictEqual(oComboBox.getProperty("value"), "item 2");
				strictEqual(jQuery(oComboBox.getFocusDomRef()).attr("aria-activedescendant"), undefined, 'The "aria-activedescendant" attribute is set when the active descendant is rendered and visible');

				// cleanup
				oComboBox.destroy();
			});

			test("onsapup changing the value in attachSelectionChange event handler", function() {

				// system under test
				var sExpectedValue = "GER Germany";
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "GER",
							text: "Germany"
						}),

						new sap.ui.core.Item({
							key: "CU",
							text: "Cuba"
						})
					],

					selectedKey: "CU"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				this.clock.tick(0);	// tick the clock ahead 0ms millisecond to make sure the async call to .selectText() on the focusin event handler does not override the type ahead
				oComboBox.attachSelectionChange(function(oControlEvent) {
					this.setValue(sExpectedValue);
				}, oComboBox);

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_UP);
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_UP);

				// assert
				strictEqual(oComboBox.getValue(), sExpectedValue);
				strictEqual(oComboBox.getProperty("value"), sExpectedValue);
				strictEqual(jQuery(oComboBox.getFocusDomRef()).getSelectedText(), sExpectedValue);

				// cleanup
				oComboBox.destroy();
			});

			test("onsapup the typed value should not gets selected (test case 1)", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							text: "Algeria"
						}),

						new sap.ui.core.Item({
							text: "Argentina"
						}),

						new sap.ui.core.Item({
							text: "Australia"
						}),

						new sap.ui.core.Item({
							key: "GER",
							text: "Germany"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				this.clock.tick(0);	// tick the clock ahead 0ms millisecond to make sure the async call to .selectText() on the focusin event handler does not override the type ahead
				sap.ui.qunit.QUnitUtils.triggerEvent("keydown", oComboBox.getFocusDomRef(), {
					which: jQuery.sap.KeyCodes.A
				});
				oComboBox.getFocusDomRef().value = "A";
				sap.ui.qunit.QUnitUtils.triggerEvent("input", oComboBox.getFocusDomRef());
				this.clock.tick(1000);

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_DOWN);
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_UP);

				// assert
				strictEqual(oComboBox.getFocusDomRef().value, "Algeria");
				strictEqual(jQuery(oComboBox.getFocusDomRef()).getSelectedText(), "lgeria");

				// cleanup
				oComboBox.destroy();
			});

			test("onsapup the typed value should not gets selected (test case 2)", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							text: "Algeria"
						}),

						new sap.ui.core.Item({
							text: "Argentina"
						}),

						new sap.ui.core.Item({
							text: "Australia"
						}),

						new sap.ui.core.Item({
							key: "GER",
							text: "Germany"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				this.clock.tick(0);	// tick the clock ahead 0ms millisecond to make sure the async call to .selectText() on the focusin event handler does not override the type ahead
				sap.ui.qunit.QUnitUtils.triggerEvent("keydown", oComboBox.getFocusDomRef(), {
					which: jQuery.sap.KeyCodes.A
				});
				oComboBox.getFocusDomRef().value = "A";
				sap.ui.qunit.QUnitUtils.triggerEvent("input", oComboBox.getFocusDomRef());
				jQuery(oComboBox.getFocusDomRef()).cursorPos(0);
				this.clock.tick(1000);

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_DOWN);
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_UP);

				// assert
				strictEqual(oComboBox.getFocusDomRef().value, "Algeria");
				strictEqual(jQuery(oComboBox.getFocusDomRef()).getSelectedText(), "Algeria");

				// cleanup
				oComboBox.destroy();
			});

			test('onsapup the attribute "aria-activedescendant" is set', function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						oExpectedItem = new sap.ui.core.Item({
							text: "Algeria"
						}),
						new sap.ui.core.Item({
							key: "AR",
							text: "Argentina"
						})
					],
					selectedKey: "AR"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				this.clock.tick(0);	// tick the clock ahead 0ms millisecond to make sure the async call to .selectText() on the focusin event handler does not override the type ahead
				oComboBox.open();
				this.clock.tick(1000);	// wait after the open animation is completed
				var sExpectedActiveDescendantId = oExpectedItem.getId();

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_UP);

				// assert
				strictEqual(oComboBox.getFocusDomRef().getAttribute("aria-activedescendant"), sExpectedActiveDescendantId);

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* onsaphome                      */
			/* ------------------------------ */

			test("onsaphome", function() {

				// system under test
				var oExpectedItem;
				var oItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						oExpectedItem = new sap.ui.core.Item({
							key: "0",
							text: "item 0 is selected"
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2",
							enabled: false
						}),

						oItem = new sap.ui.core.Item({
							key: "3",
							text: "item 3"
						}),

						new sap.ui.core.Item({
							key: "4",
							text: "item 4",
							enabled: false
						})
					],

					selectedItem: oItem
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				this.clock.tick(0);	// tick the clock ahead 0ms millisecond to make sure the async call to .selectText() on the focusin event handler does not override the type ahead
				var fnKeyHomeSpy = this.spy(oComboBox, "onsaphome");
				var fnFireSelectionChangeSpy = this.spy(oComboBox, "fireSelectionChange");

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.HOME);

				// assert
				strictEqual(fnKeyHomeSpy.callCount, 1, "onsaphome() method was called exactly once");
				strictEqual(fnFireSelectionChangeSpy.callCount, 1, 'The "selectionChange" event is fired');
				strictEqual(oComboBox.getFocusDomRef().selectionStart, 0);
				strictEqual(oComboBox.getFocusDomRef().selectionEnd, 18);
				ok(oComboBox.getSelectedItem() === oExpectedItem);
				ok(oComboBox.getList().getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getFocusDomRef().value, "item 0 is selected");
				strictEqual(jQuery(oComboBox.getFocusDomRef()).attr("aria-activedescendant"), undefined, 'The "aria-activedescendant" attribute is set when the active descendant is rendered and visible');

				// cleanup
				oComboBox.destroy();
			});

			test("onsaphome - when Home key is pressed and the control's field is not editable, the value should not change", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					editable: false,
					items: [
						new sap.ui.core.Item({
							text: "item 0"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				var fnFireSelectionChangeSpy = this.spy(oComboBox, "fireSelectionChange");

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.HOME);

				// assert
				strictEqual(fnFireSelectionChangeSpy.callCount, 0, 'The "selectionChange" event was not fired');
				ok(oComboBox.getSelectedItem() === null);
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getFocusDomRef().value, "");
				strictEqual(jQuery(oComboBox.getFocusDomRef()).attr("aria-activedescendant"), undefined, 'The "aria-activedescendant" attribute is set when the active descendant is rendered and visible');

				// cleanup
				oComboBox.destroy();
			});

			test("onsaphome", function() {

				// system under test
				var oExpectedItem;
				var oItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0",
							enabled: false
						}),

						oExpectedItem = new sap.ui.core.Item({
							key: "1",
							text: "item 1 is selected"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						}),

						new sap.ui.core.Item({
							key: "3",
							text: "item 3"
						}),

						oItem = new sap.ui.core.Item({
							key: "4",
							text: "item 4"
						})
					],

					selectedItem: oItem
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				this.clock.tick(0);	// tick the clock ahead 0ms millisecond to make sure the async call to .selectText() on the focusin event handler does not override the type ahead
				var fnKeyHomeSpy = this.spy(oComboBox, "onsaphome");
				var fnFireSelectionChangeSpy = this.spy(oComboBox, "fireSelectionChange");

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.HOME);

				// assert
				strictEqual(fnKeyHomeSpy.callCount, 1, "onsaphome() method was called exactly once");
				strictEqual(fnFireSelectionChangeSpy.callCount, 1, 'The "selectionChange" event is fired');
				strictEqual(oComboBox.getFocusDomRef().selectionStart, 0);
				strictEqual(oComboBox.getFocusDomRef().selectionEnd, 18);
				ok(oComboBox.getSelectedItem() === oExpectedItem);
				ok(oComboBox.getList().getSelectedItem() === oExpectedItem);
				strictEqual(oComboBox.getFocusDomRef().value, "item 1 is selected");
				strictEqual(jQuery(oComboBox.getFocusDomRef()).attr("aria-activedescendant"), undefined, 'The "aria-activedescendant" attribute is set when the active descendant is rendered and visible');

				// cleanup
				oComboBox.destroy();
			});

			test("onsaphome changing the value in attachSelectionChange event handler", function() {

				// system under test
				var sExpectedValue = "0 item 0 is selected";
				var oItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0 is selected",
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						}),

						new sap.ui.core.Item({
							key: "3",
							text: "item 3"
						}),

						oItem = new sap.ui.core.Item({
							key: "4",
							text: "item 4"
						})
					],

					selectedItem: oItem
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				this.clock.tick(0);	// tick the clock ahead 0ms millisecond to make sure the async call to .selectText() on the focusin event handler does not override the type ahead
				oComboBox.attachSelectionChange(function(oControlEvent) {
					this.setValue(sExpectedValue);
				}, oComboBox);

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.HOME);
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.HOME);

				// assert
				strictEqual(oComboBox.getValue(), sExpectedValue);
				strictEqual(oComboBox.getProperty("value"), sExpectedValue);
				strictEqual(oComboBox.getFocusDomRef().selectionStart, 0);
				strictEqual(oComboBox.getFocusDomRef().selectionEnd, sExpectedValue.length);

				// cleanup
				oComboBox.destroy();
			});

			test("onsaphome the attribute aria-activedescendant is set", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0",
							enabled: false
						}),

						oExpectedItem = new sap.ui.core.Item({
							key: "1",
							text: "item 1 is selected"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						}),

						new sap.ui.core.Item({
							key: "3",
							text: "item 3"
						})
					],

					selectedKey: "3"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				this.clock.tick(0);	// tick the clock ahead 0ms millisecond to make sure the async call to .selectText() on the focusin event handler does not override the type ahead
				oComboBox.open();
				this.clock.tick(1000);	// wait after the open animation is completed
				var sExpectedActiveDescendantId = oExpectedItem.getId();

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.HOME);

				// assert
				strictEqual(oComboBox.getFocusDomRef().getAttribute("aria-activedescendant"), sExpectedActiveDescendantId);

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* onsapend                       */
			/* ------------------------------ */

			test("onsapend", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0",
							enabled: false
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						}),

						new sap.ui.core.Item({
							key: "3",
							text: "item 3"
						}),

						oExpectedItem = new sap.ui.core.Item({
							key: "4",
							text: "item 4 is selected"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				this.clock.tick(0);	// tick the clock ahead 0ms millisecond to make sure the async call to .selectText() on the focusin event handler does not override the type ahead
				var fnKeyEndSpy = this.spy(oComboBox, "onsapend");
				var fnFireSelectionChangeSpy = this.spy(oComboBox, "fireSelectionChange");

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.END);

				// assert
				strictEqual(fnKeyEndSpy.callCount, 1, "onsapend() method was called exactly once");
				strictEqual(fnFireSelectionChangeSpy.callCount, 1, 'The "selectionChange" event is fired');
				strictEqual(oComboBox.getFocusDomRef().selectionStart, 0);
				strictEqual(oComboBox.getFocusDomRef().selectionEnd, 18);
				ok(oComboBox.getSelectedItem() === oExpectedItem);
				ok(oComboBox.getList().getSelectedItem() === oExpectedItem);
				strictEqual(jQuery(oComboBox.getFocusDomRef()).attr("aria-activedescendant"), undefined, 'The "aria-activedescendant" attribute is set when the active descendant is rendered and visible');
				strictEqual(oComboBox.getFocusDomRef().value, "item 4 is selected");

				// cleanup
				oComboBox.destroy();
			});

			test("onsapend changing the value in attachSelectionChange event handler", function() {

				// system under test
				var sExpectedValue = "4 item 4 is selected";
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0",
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						}),

						new sap.ui.core.Item({
							key: "3",
							text: "item 3"
						}),

						new sap.ui.core.Item({
							key: "4",
							text: "item 4 is selected"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				this.clock.tick(0);	// tick the clock ahead 0ms millisecond to make sure the async call to .selectText() on the focusin event handler does not override the type ahead
				oComboBox.attachSelectionChange(function(oControlEvent) {
					this.setValue(sExpectedValue);
				}, oComboBox);

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.END);
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.END);

				// assert
				strictEqual(oComboBox.getValue(), sExpectedValue);
				strictEqual(oComboBox.getProperty("value"), sExpectedValue);
				strictEqual(oComboBox.getFocusDomRef().selectionStart, 0);
				strictEqual(oComboBox.getFocusDomRef().selectionEnd, sExpectedValue.length);

				// cleanup
				oComboBox.destroy();
			});

			test("onsapend - when end key is pressed and the control's field is not editable, the value should not change", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					editable: false,
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0",
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				var fnFireSelectionChangeSpy = this.spy(oComboBox, "fireSelectionChange");
				oComboBox.focus();

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.END);

				// assert
				strictEqual(fnFireSelectionChangeSpy.callCount, 0, 'The "selectionChange" event was not fired');
				ok(oComboBox.getSelectedItem() === null);
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getFocusDomRef().value, "");
				strictEqual(jQuery(oComboBox.getFocusDomRef()).attr("aria-activedescendant"), undefined, 'The "aria-activedescendant" attribute is set when the active descendant is rendered and visible');

				// cleanup
				oComboBox.destroy();
			});

			test("onsapend the attribute aria-activedescendant is set", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "0",
							text: "item 0",
						}),

						new sap.ui.core.Item({
							key: "1",
							text: "item 1"
						}),

						oExpectedItem = new sap.ui.core.Item({
							key: "2",
							text: "item 2"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				oComboBox.open();
				this.clock.tick(1000);	// wait after the open animation is completed
				var sExpectedActiveDescendantId = oExpectedItem.getId();

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.END);

				// assert
				strictEqual(oComboBox.getFocusDomRef().getAttribute("aria-activedescendant"), sExpectedActiveDescendantId);

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* onsappagedown                  */
			/* ------------------------------ */

			var pageDownTestCase = function(sTestName, mOptions) {
				test("onsappagedown", function() {

					// system under test
					var oComboBox = mOptions.control;

					// arrange
					oComboBox.placeAt("content");
					sap.ui.getCore().applyChanges();
					oComboBox.focus();
					this.clock.tick(0);	// tick the clock ahead 0ms millisecond to make sure the async call to .selectText() on the focusin event handler does not override the type ahead
					var fnPageDownSpy = this.spy(oComboBox, "onsappagedown");
					var fnFireSelectionChangeSpy = this.spy(oComboBox, "fireSelectionChange");

					// act
					sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.PAGE_DOWN);

					// assert
					strictEqual(fnPageDownSpy.callCount, 1, "onsappagedown() method was called exactly once");
					strictEqual(fnFireSelectionChangeSpy.callCount, 1, 'The "selectionChange" event is fired');
					strictEqual(oComboBox.getFocusDomRef().selectionStart, 0);
					strictEqual(oComboBox.getFocusDomRef().selectionEnd, oComboBox.getFocusDomRef().value.length);
					ok(oComboBox.getSelectedItem() === mOptions.output);
					strictEqual(oComboBox.getSelectedItemId(), mOptions.output.getId());
					strictEqual(oComboBox.getSelectedKey(), mOptions.output.getKey());
					ok(oComboBox.getList().getSelectedItem() === mOptions.output);
					strictEqual(oComboBox.getFocusDomRef().value, mOptions.output.getText());

					// cleanup
					oComboBox.destroy();
				});
			};

			(function() {

				var oExpectedItem;

				// test cases
				pageDownTestCase("", {
					control: new sap.m.ComboBox({
						items: [
							new sap.ui.core.Item({
								key: "DZ",
								text: "Algeria"
							}),

							new sap.ui.core.Item({
								key: "AR",
								text: "Argentina"
							}),

							new sap.ui.core.Item({
								key: "AU",
								text: "Australia"
							}),

							new sap.ui.core.Item({
								key: "AT",
								text: "Austria"
							}),

							new sap.ui.core.Item({
								key: "BH",
								text: "Bahrain"
							}),

							new sap.ui.core.Item({
								key: "BE",
								text: "Belgium"
							}),

							new sap.ui.core.Item({
								key: "BA",
								text: "Bosnia and Herzegovina"
							}),

							new sap.ui.core.Item({
								key: "BR",
								text: "Brazil"
							}),

							new sap.ui.core.Item({
								key: "BG",
								text: "Bulgaria"
							}),

							oExpectedItem = new sap.ui.core.Item({
								key: "CA",
								text: "Canada"
							}),

							new sap.ui.core.Item({
								key: "CL",
								text: "Chile"
							}),

							new sap.ui.core.Item({
								key: "CO",
								text: "Colombia"
							}),

							new sap.ui.core.Item({
								key: "HR",
								text: "Croatia"
							}),

							new sap.ui.core.Item({
								key: "CU",
								text: "Cuba"
							}),

							new sap.ui.core.Item({
								key: "CZ",
								text: "Czech Republic"
							}),

							new sap.ui.core.Item({
								key: "DK",
								text: "Denmark"
							}),

							new sap.ui.core.Item({
								key: "EG",
								text: "Egypt"
							}),

							new sap.ui.core.Item({
								key: "EE",
								text: "Estonia"
							}),

							new sap.ui.core.Item({
								key: "FI",
								text: "Finland"
							}),

							new sap.ui.core.Item({
								key: "FR",
								text: "France",
								enabled: false
							}),

							new sap.ui.core.Item({
								key: "GH",
								text: "Ghana"
							}),

							new sap.ui.core.Item({
								key: "DZ",
								text: "Algeria"
							})
						]
					}),

					output: oExpectedItem
				});
			}());

			test("onsappagedown changing the value in attachSelectionChange event handler", function() {

				// system under test
				var sExpectedValue = "BH Bahrain is selected";
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "DZ",
							text: "Algeria"
						}),

						new sap.ui.core.Item({
							key: "AR",
							text: "Argentina"
						}),

						new sap.ui.core.Item({
							key: "AU",
							text: "Australia"
						}),

						new sap.ui.core.Item({
							key: "AT",
							text: "Austria"
						}),

						new sap.ui.core.Item({
							key: "BH",
							text: "Bahrain is selected"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				this.clock.tick(0);	// tick the clock ahead 0ms millisecond to make sure the async call to .selectText() on the focusin event handler does not override the type ahead
				oComboBox.attachSelectionChange(function(oControlEvent) {
					this.setValue(sExpectedValue);
				}, oComboBox);

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.PAGE_DOWN);
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.PAGE_DOWN);

				// assert
				strictEqual(oComboBox.getValue(), sExpectedValue);
				strictEqual(oComboBox.getProperty("value"), sExpectedValue);
				strictEqual(oComboBox.getFocusDomRef().selectionStart, 0);
				strictEqual(oComboBox.getFocusDomRef().selectionEnd, sExpectedValue.length);

				// cleanup
				oComboBox.destroy();
			});

			test("onsappagedown when page down key is pressed and the control's field is not editable, the value should not change", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					editable: false,
					items: [
						new sap.ui.core.Item({
							key: "DZ",
							text: "Algeria"
						}),

						new sap.ui.core.Item({
							key: "AR",
							text: "Argentina"
						}),

						new sap.ui.core.Item({
							key: "AU",
							text: "Australia"
						}),

						new sap.ui.core.Item({
							key: "AT",
							text: "Austria"
						}),

						new sap.ui.core.Item({
							key: "BH",
							text: "Bahrain is selected"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				var fnFireSelectionChangeSpy = this.spy(oComboBox, "fireSelectionChange");
				oComboBox.focus();

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.PAGE_DOWN);

				// assert
				strictEqual(fnFireSelectionChangeSpy.callCount, 0, 'The "selectionChange" event was not fired');
				ok(oComboBox.getSelectedItem() === null);
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getFocusDomRef().value, "");
				strictEqual(jQuery(oComboBox.getFocusDomRef()).attr("aria-activedescendant"), undefined, 'The "aria-activedescendant" attribute is set when the active descendant is rendered and visible');

				// cleanup
				oComboBox.destroy();
			});

			test("onsappagedown the attribute aria-activedescendant is set", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "DZ",
							text: "Algeria"
						}),

						new sap.ui.core.Item({
							key: "AR",
							text: "Argentina"
						}),

						new sap.ui.core.Item({
							key: "AU",
							text: "Australia"
						}),

						new sap.ui.core.Item({
							key: "AT",
							text: "Austria"
						}),

						oExpectedItem = new sap.ui.core.Item({
							key: "BH",
							text: "Bahrain is selected"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				oComboBox.open();
				this.clock.tick(1000);	// wait after the open animation is completed
				var sExpectedActiveDescendantId = oExpectedItem.getId();

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.PAGE_DOWN);

				// assert
				strictEqual(oComboBox.getFocusDomRef().getAttribute("aria-activedescendant"), sExpectedActiveDescendantId);

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* onsappageup                    */
			/* ------------------------------ */

			var pageUpTestCase = function(sTestName, mOptions) {
				test("onsappageup", function() {

					// system under test
					var oComboBox = mOptions.control;

					// arrange
					oComboBox.placeAt("content");
					sap.ui.getCore().applyChanges();
					oComboBox.focus();
					this.clock.tick(0);	// tick the clock ahead 0ms millisecond to make sure the async call to .selectText() on the focusin event handler does not override the type ahead
					var fnPageUpSpy = this.spy(oComboBox, "onsappageup");
					var fnFireSelectionChangeSpy = this.spy(oComboBox, "fireSelectionChange");

					// act
					sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.PAGE_UP);

					// assert
					strictEqual(fnPageUpSpy.callCount, 1, "onsappageup() method was called exactly once");
					strictEqual(fnFireSelectionChangeSpy.callCount, 1, 'The "selectionChange" event is fired');
					strictEqual(oComboBox.getFocusDomRef().selectionStart, 0);
					strictEqual(oComboBox.getFocusDomRef().selectionEnd, oComboBox.getFocusDomRef().value.length);
					ok(oComboBox.getSelectedItem() === mOptions.output);
					strictEqual(oComboBox.getSelectedItemId(), mOptions.output.getId());
					strictEqual(oComboBox.getSelectedKey(), mOptions.output.getKey());
					ok(oComboBox.getList().getSelectedItem() === mOptions.output);
					strictEqual(oComboBox.getFocusDomRef().value, mOptions.output.getText());

					// cleanup
					oComboBox.destroy();
				});
			};

			(function() {

				var oExpectedItem;

				// test cases
				pageUpTestCase("", {
					control: new sap.m.ComboBox({
						items: [
							new sap.ui.core.Item({
								key: "DZ",
								text: "Algeria",
								enabled: false
							}),

							new sap.ui.core.Item({
								key: "AR",
								text: "Argentina"
							}),

							new sap.ui.core.Item({
								key: "AU",
								text: "Australia"
							}),

							new sap.ui.core.Item({
								key: "AT",
								text: "Austria"
							}),

							new sap.ui.core.Item({
								key: "BH",
								text: "Bahrain"
							}),

							new sap.ui.core.Item({
								key: "BE",
								text: "Belgium"
							}),

							new sap.ui.core.Item({
								key: "BA",
								text: "Bosnia and Herzegovina"
							}),

							new sap.ui.core.Item({
								key: "BR",
								text: "Brazil"
							}),

							new sap.ui.core.Item({
								key: "BG",
								text: "Bulgaria"
							}),

							new sap.ui.core.Item({
								key: "CA",
								text: "Canada"
							}),

							oExpectedItem = new sap.ui.core.Item({
								key: "CL",
								text: "Chile"
							}),

							new sap.ui.core.Item({
								key: "CO",
								text: "Colombia"
							}),

							new sap.ui.core.Item({
								key: "HR",
								text: "Croatia"
							}),

							new sap.ui.core.Item({
								key: "CU",
								text: "Cuba"
							}),

							new sap.ui.core.Item({
								key: "CZ",
								text: "Czech Republic"
							}),

							new sap.ui.core.Item({
								key: "DK",
								text: "Denmark"
							}),

							new sap.ui.core.Item({
								key: "EG",
								text: "Egypt"
							}),

							new sap.ui.core.Item({
								key: "EE",
								text: "Estonia"
							}),

							new sap.ui.core.Item({
								key: "FI",
								text: "Finland"
							}),

							new sap.ui.core.Item({
								key: "FR",
								text: "France"
							}),

							new sap.ui.core.Item({
								key: "GH",
								text: "Ghana"
							}),

							new sap.ui.core.Item({
								key: "DZ",
								text: "Algeria"
							})
						],

						selectedKey: "GH"
					}),

					output: oExpectedItem
				});
			}());

			test("onsappageup changing the value in attachSelectionChange event handler", function() {

				// system under test
				var sExpectedValue = "DZ Algeria is selected";
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "DZ",
							text: "Algeria is selected"
						}),

						new sap.ui.core.Item({
							key: "AR",
							text: "Argentina"
						}),

						new sap.ui.core.Item({
							key: "AU",
							text: "Australia"
						}),

						new sap.ui.core.Item({
							key: "AT",
							text: "Austria"
						}),

						new sap.ui.core.Item({
							key: "BH",
							text: "Bahrain"
						})
					],

					selectedKey: "BH"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				this.clock.tick(0);	// tick the clock ahead 0ms millisecond to make sure the async call to .selectText() on the focusin event handler does not override the type ahead
				oComboBox.attachSelectionChange(function(oControlEvent) {
					this.setValue(sExpectedValue);
				}, oComboBox);

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.PAGE_UP);
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.PAGE_UP);

				// assert
				strictEqual(oComboBox.getFocusDomRef().value, sExpectedValue);
				strictEqual(oComboBox.getFocusDomRef().selectionStart, 0);
				strictEqual(oComboBox.getFocusDomRef().selectionEnd, sExpectedValue.length);

				// cleanup
				oComboBox.destroy();
			});

			test("onsappageup - when page up key is pressed and the control's field is not editable, the value should not change", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					editable: false,
					items: [
						new sap.ui.core.Item({
							key: "DZ",
							text: "Algeria"
						}),

						new sap.ui.core.Item({
							key: "AR",
							text: "Argentina"
						}),

						new sap.ui.core.Item({
							key: "AU",
							text: "Australia"
						}),

						new sap.ui.core.Item({
							key: "AT",
							text: "Austria"
						}),

						new sap.ui.core.Item({
							key: "BH",
							text: "Bahrain"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				var fnFireSelectionChangeSpy = this.spy(oComboBox, "fireSelectionChange");
				oComboBox.focus();

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.PAGE_UP);

				// assert
				strictEqual(fnFireSelectionChangeSpy.callCount, 0, 'The "selectionChange" event was not fired');
				ok(oComboBox.getSelectedItem() === null);
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getFocusDomRef().value, "");
				strictEqual(jQuery(oComboBox.getFocusDomRef()).attr("aria-activedescendant"), undefined, 'The "aria-activedescendant" attribute is set when the active descendant is rendered and visible');

				// cleanup
				oComboBox.destroy();
			});

			test("onsappageup the attribute aria-activedescendant is set", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						oExpectedItem = new sap.ui.core.Item({
							key: "DZ",
							text: "Algeria"
						}),

						new sap.ui.core.Item({
							key: "AR",
							text: "Argentina"
						}),

						new sap.ui.core.Item({
							key: "AU",
							text: "Australia"
						}),

						new sap.ui.core.Item({
							key: "AT",
							text: "Austria"
						}),

						new sap.ui.core.Item({
							key: "BH",
							text: "Bahrain is selected"
						})
					],
					selectedKey: "BH"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				oComboBox.open();
				this.clock.tick(1000);	// wait 1s after the open animation is completed
				var sExpectedActiveDescendantId = oExpectedItem.getId();

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.PAGE_UP);

				// assert
				strictEqual(oComboBox.getFocusDomRef().getAttribute("aria-activedescendant"), sExpectedActiveDescendantId);

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* oninput                        */
			/* ------------------------------ */

			test("oninput the ComboBox's picker pop-up should open", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							text: "Egypt"
						}),
						oExpectedItem = new sap.ui.core.Item({
							text: "Germany"
						}),
						new sap.ui.core.Item({
							text: "Ghana"
						}),
						new sap.ui.core.Item({
							text: "Greece"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				var fnOpenSpy = this.spy(oComboBox, "open");
				var fnFireSelectionChangeSpy = this.spy(oComboBox, "fireSelectionChange");
				var sExpectedActiveDescendantId = oExpectedItem.getId();

				// act
				oComboBox.getFocusDomRef().value = "G";
				sap.ui.qunit.QUnitUtils.triggerEvent("input", oComboBox.getFocusDomRef());
				this.clock.tick(1000);	// wait 1s after the open animation is completed

				// assert
				strictEqual(fnOpenSpy.callCount, 1, "open() method was called exactly once");
				strictEqual(fnFireSelectionChangeSpy.callCount, 1, 'The "selectionChange" event is fired');
				strictEqual(oComboBox.getVisibleItems().length, 3, "Three items are visible");
				strictEqual(oComboBox.getFocusDomRef().getAttribute("aria-activedescendant"), sExpectedActiveDescendantId);

				// cleanup
				oComboBox.destroy();
			});

			test("oninput close the picker popup if there are not suggestions", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "GER",
							text: "Germany",
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				oComboBox.open();
				this.clock.tick(1000);
				var fnFireSelectionChangeSpy = this.spy(oComboBox, "fireSelectionChange");
				var fnOpenSpy = this.spy(oComboBox, "open");
				var fnCloseSpy = this.spy(oComboBox, "close");
				var sOpenState = !jQuery.support.cssAnimations ? sap.ui.core.OpenState.CLOSED : sap.ui.core.OpenState.CLOSING;	// no animation on ie9

				// act
				oComboBox.getFocusDomRef().value = "v";
				sap.ui.qunit.QUnitUtils.triggerEvent("input", oComboBox.getFocusDomRef());

				// assert
				strictEqual(fnOpenSpy.callCount, 0, "open() method was not called");
				strictEqual(fnCloseSpy.callCount, 1, "close() method was called");
				strictEqual(oComboBox.getPicker().oPopup.getOpenState(), sOpenState);
				strictEqual(fnFireSelectionChangeSpy.callCount, 0, 'The "selectionChange" event is not fired');
				strictEqual(jQuery(oComboBox.getFocusDomRef()).attr("aria-activedescendant"), undefined, 'The "aria-activedescendant" attribute is set when the active descendant is rendered and visible');

				// cleanup
				oComboBox.destroy();
			});

			test("oninput reset the selection when the value of the ComboBox's input field is empty", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "GER",
							text: "Germany",
						})
					],

					selectedKey: "GER"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				var fnFireSelectionChangeSpy = this.spy(oComboBox, "fireSelectionChange");
				oComboBox.focus();
				var oEvent = new jQuery.Event("input", {
					target: oComboBox.getFocusDomRef()
				});

				// act
				oComboBox.setValue("");
				oComboBox.oninput(oEvent);

				// assert
				ok(oComboBox.getSelectedItem() === null);
				strictEqual(oComboBox.getSelectedItemId(), "");
				strictEqual(oComboBox.getSelectedKey(), "");
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.getValue(), "");
				strictEqual(oComboBox.getProperty("value"), "");

				// cleanup
				oComboBox.destroy();
			});

			test("oninput clear the selection and the filter if not match is found", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "GER",
							text: "Germany",
						})
					],
					selectedKey: "GER"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();

				// act
				oComboBox.getFocusDomRef().value = "v";
				sap.ui.qunit.QUnitUtils.triggerEvent("input", oComboBox.getFocusDomRef());

				// assert
				ok(oComboBox.getSelectedItem() === null);
				strictEqual(oComboBox.getSelectedItemId(), "");
				strictEqual(oComboBox.getSelectedKey(), "");
				ok(oComboBox.getList().getSelectedItem() === null);
				strictEqual(oComboBox.isFiltered(), false);

				// cleanup
				oComboBox.destroy();
			});

			// BCP 1580015527
			test("it should not open the picker pop-up", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox({
					editable: false,
					items: [
						new sap.ui.core.Item({
							text: "",
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				var fnOpenSpy = this.spy(sap.m.ComboBox.prototype, "open");
				oComboBox.focus();

				// act
				sap.ui.qunit.QUnitUtils.triggerEvent("input", oComboBox.getFocusDomRef());

				// assert
				strictEqual(fnOpenSpy.callCount, 0);

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* onfocusin                      */
			/* ------------------------------ */

			test("onfocusin", function() {

				this.stub(sap.ui.Device, "system", {
					desktop: true,
					phone: false,
					tablet: false
				});

				// system under test
				var oComboBox = new sap.m.ComboBox();

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// act
				sap.ui.qunit.QUnitUtils.triggerEvent("focusin", oComboBox.getOpenArea(), {
					target: oComboBox.getOpenArea()
				});

				// assert
				ok(document.activeElement === oComboBox.getFocusDomRef(), "If the ComboBox's arrow recive the focusin event, revert it to the input field");

				// cleanup
				oComboBox.destroy();
			});

			test("onfocusin select the text", function() {

				this.stub(sap.ui.Device, "system", {
					desktop: true,
					phone: false,
					tablet: false
				});

				// system under test
				var oComboBox = new sap.m.ComboBox({
					value: "Germany"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// act
				oComboBox.focus();
				this.clock.tick(0);	// tick the clock ahead 0ms millisecond to make sure the async call to .selectText() on the focusin event handler does not override the type ahead

				// assert
				strictEqual(oComboBox.getFocusDomRef().selectionStart, 0, "The text should be selected");
				strictEqual(oComboBox.getFocusDomRef().selectionEnd, 7, "The text should be selected");

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* onBeforeOpen                   */
			/* ------------------------------ */

			test("onBeforeOpen", function() {

				// system under test
				var fnOnBeforeOpenSpy = this.spy(sap.m.ComboBox.prototype, "onBeforeOpen");
				var oComboBox = new sap.m.ComboBox({
					value: "Germany"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();

				// act
				oComboBox.open();

				// assert
				strictEqual(fnOnBeforeOpenSpy.callCount, 1, "onBeforeOpen() called exactly once");
				ok(oComboBox.$().hasClass(sap.m.ComboBoxBaseRenderer.CSS_CLASS + "Pressed"), "The ComboBox's input field must have the CSS class '" + sap.m.ComboBoxBaseRenderer.CSS_CLASS + "Pressed'");
				strictEqual(oComboBox.getFocusDomRef().getAttribute("aria-owns"), oComboBox.getList().getId(), 'the attribute "aria-owns" is set after the list is rendered');

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* onAfterOpen                    */
			/* ------------------------------ */

			test("onAfterOpen test case 1", function() {

				// system under test
				var fnOnAfterOpenSpy = this.spy(sap.m.ComboBox.prototype, "onAfterOpen");
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "GER",
							text: "Germany"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();

				// act
				oComboBox.open();
				this.clock.tick(1000);

				// assert
				strictEqual(fnOnAfterOpenSpy.callCount, 1, "onAfterOpen() called exactly once");
				strictEqual(oComboBox.getFocusDomRef().getAttribute("aria-expanded"), "true");
				strictEqual(oComboBox.$("inner").attr("aria-activedescendant"), undefined, 'The "aria-activedescendant" attribute is set when the active descendant is rendered and visible');

				// cleanup
				oComboBox.destroy();
			});

			test("onAfterOpen test case 2", function() {

				// system under test
				var oExpectedItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						oExpectedItem = new sap.ui.core.Item({
							key: "GER",
							text: "Germany"
						})
					],
					selectedKey: "GER"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				var sExpectedActiveDescendantId = oExpectedItem.getId();

				// act
				oComboBox.open();
				this.clock.tick(1000);

				// assert
				strictEqual(oComboBox.$("inner").attr("aria-activedescendant"), sExpectedActiveDescendantId);

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* onAfterClose                   */
			/* ------------------------------ */

			test("onAfterClose", function() {

				// system under test
				var fnOnAfterCloseSpy = this.spy(sap.m.ComboBox.prototype, "onAfterClose");
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "GER",
							text: "Germany"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				oComboBox.open();

				// act
				oComboBox.close();

				if (jQuery.support.cssAnimations) {	// no animation on IE9
					this.clock.tick(1000);
				}

				// assert
				strictEqual(fnOnAfterCloseSpy.callCount, 1, "onAfterClose() called exactly once");
				strictEqual(oComboBox.getFocusDomRef().getAttribute("aria-expanded"), "false");
				strictEqual(oComboBox.$("inner").attr("aria-activedescendant"), undefined, 'The "aria-activedescendant" attribute is set when the active descendant is rendered and visible');

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* onBeforeClose                  */
			/* ------------------------------ */

			test("onBeforeClose", function() {

				// system under test
				var fnOnBeforeCloseSpy = this.spy(sap.m.ComboBox.prototype, "onBeforeClose");
				var oComboBox = new sap.m.ComboBox();

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				oComboBox.open();
				this.clock.tick(1000);

				// act
				oComboBox.close();

				// assert
				strictEqual(fnOnBeforeCloseSpy.callCount, 1, "onBeforeClose() called exactly once");
				strictEqual(oComboBox.$().attr("aria-owns"), undefined);

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* change                         */
			/* ------------------------------ */

			test("onChange is fired after the value changes by pressing arrow down key when the control loses the focus", function() {

				// system under test
				var sExpectedValue = "Algeria";
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "DZ",
							text: "Algeria"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				var fnFireChangeSpy = this.spy(oComboBox, "fireChange");

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_DOWN);
				oComboBox.getFocusDomRef().blur();
				this.clock.tick(0);	// when a blur event occurs the "sapfocusleave" is fired async

				// assert
				strictEqual(fnFireChangeSpy.callCount, 1, 'The "change" event is fired');
				strictEqual(oComboBox.getValue(), sExpectedValue);
				strictEqual(oComboBox.getProperty("value"), sExpectedValue);

				// cleanup
				oComboBox.destroy();
			});

			test("onChange is fired after the value changes by pressing arrow down key and enter", function() {

				// system under test
				var sExpectedValue = "Algeria";
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "DZ",
							text: "Algeria"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				var fnFireChangeSpy = this.spy(oComboBox, "fireChange");

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_DOWN);
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ENTER);

				// assert
				strictEqual(fnFireChangeSpy.callCount, 1, 'The "change" event is fired');
				strictEqual(oComboBox.getValue(), sExpectedValue);
				strictEqual(oComboBox.getProperty("value"), sExpectedValue);

				// cleanup
				oComboBox.destroy();
			});

			test("onChange is fired after the value changes by pressing arrow up key when the control loses the focus", function() {

				// system under test
				var sExpectedValue = "Algeria";
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "DZ",
							text: "Algeria"
						}),
						new sap.ui.core.Item({
							key: "GER",
							text: "Germany",
						})
					],
					selectedKey: "GER"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				var fnFireChangeSpy = this.spy(oComboBox, "fireChange");

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_UP);
				oComboBox.getFocusDomRef().blur();
				this.clock.tick(0);	// when a blur event occurs the "sapfocusleave" is fired async

				// assert
				strictEqual(fnFireChangeSpy.callCount, 1, 'The "change" event is fired');
				strictEqual(oComboBox.getValue(), sExpectedValue);
				strictEqual(oComboBox.getProperty("value"), sExpectedValue);

				// cleanup
				oComboBox.destroy();
			});

			test("onChange is fired after the value changes by pressing arrow up key and enter", function() {

				// system under test
				var sExpectedValue = "Algeria";
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "DZ",
							text: "Algeria"
						}),
						new sap.ui.core.Item({
							key: "GER",
							text: "Germany",
						})
					],
					selectedKey: "GER"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				var fnFireChangeSpy = this.spy(oComboBox, "fireChange");

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_UP);
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ENTER);

				// assert
				strictEqual(fnFireChangeSpy.callCount, 1, 'The "change" event is fired');
				strictEqual(oComboBox.getValue(), sExpectedValue);
				strictEqual(oComboBox.getProperty("value"), sExpectedValue);

				// cleanup
				oComboBox.destroy();
			});

			test("onChange is fired after the value changes by pressing Home key when the control loses the focus", function() {

				// system under test
				var sExpectedValue = "Algeria";
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "DZ",
							text: "Algeria"
						}),
						new sap.ui.core.Item({
							key: "GER",
							text: "Germany",
						})
					],
					selectedKey: "GER"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				var fnFireChangeSpy = this.spy(oComboBox, "fireChange");

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.HOME);
				oComboBox.getFocusDomRef().blur();
				this.clock.tick(0);	// when a blur event occurs the "sapfocusleave" is fired async

				// assert
				strictEqual(fnFireChangeSpy.callCount, 1, 'The "change" event is fired');
				strictEqual(oComboBox.getValue(), sExpectedValue);
				strictEqual(oComboBox.getProperty("value"), sExpectedValue);

				// cleanup
				oComboBox.destroy();
			});

			test("onChange is fired after the value changes by pressing Home key and enter", function() {

				// system under test
				var sExpectedValue = "Algeria";
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "DZ",
							text: "Algeria"
						}),
						new sap.ui.core.Item({
							key: "GER",
							text: "Germany",
						})
					],
					selectedKey: "GER"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				var fnFireChangeSpy = this.spy(oComboBox, "fireChange");

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.HOME);
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ENTER);

				// assert
				strictEqual(fnFireChangeSpy.callCount, 1, 'The "change" event is fired');
				strictEqual(oComboBox.getValue(), sExpectedValue);
				strictEqual(oComboBox.getProperty("value"), sExpectedValue);

				// cleanup
				oComboBox.destroy();
			});

			test("onChange is fired after the value changes by pressing End key when the control loses the focus", function() {

				// system under test
				var sExpectedValue = "Germany";
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "DZ",
							text: "Algeria"
						}),
						new sap.ui.core.Item({
							key: "GER",
							text: "Germany",
						})
					],
					selectedKey: "DZ"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				var fnFireChangeSpy = this.spy(oComboBox, "fireChange");

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.END);
				oComboBox.getFocusDomRef().blur();
				this.clock.tick(0);	// when a blur event occurs the "sapfocusleave" is fired async

				// assert
				strictEqual(fnFireChangeSpy.callCount, 1, 'The "change" event is fired');
				strictEqual(oComboBox.getValue(), sExpectedValue);
				strictEqual(oComboBox.getProperty("value"), sExpectedValue);

				// cleanup
				oComboBox.destroy();
			});

			test("onChange is fired after the value changes by pressing End key and enter", function() {

				// system under test
				var sExpectedValue = "Germany";
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "DZ",
							text: "Algeria"
						}),
						new sap.ui.core.Item({
							key: "GER",
							text: "Germany",
						})
					],
					selectedKey: "DZ"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				var fnFireChangeSpy = this.spy(oComboBox, "fireChange");

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.END);
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ENTER);

				// assert
				strictEqual(fnFireChangeSpy.callCount, 1, 'The "change" event is fired');
				strictEqual(oComboBox.getValue(), sExpectedValue);
				strictEqual(oComboBox.getProperty("value"), sExpectedValue);

				// cleanup
				oComboBox.destroy();
			});

			test("onChange is fired after the value changes by pressing pagedown key when the control loses the focus", function() {

				// system under test
				var sExpectedValue = "Cuba";
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "DZ",
							text: "Algeria"
						}),
						new sap.ui.core.Item({
							key: "GER",
							text: "Germany",
						}),
						new sap.ui.core.Item({
							key: "CU",
							text: "Cuba",
						})
					],
					selectedKey: "DZ"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				var fnFireChangeSpy = this.spy(oComboBox, "fireChange");

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.PAGE_DOWN);
				oComboBox.getFocusDomRef().blur();
				this.clock.tick(0);	// when a blur event occurs the "sapfocusleave" is fired async

				// assert
				strictEqual(fnFireChangeSpy.callCount, 1, 'The "change" event is fired');
				strictEqual(oComboBox.getValue(), sExpectedValue);
				strictEqual(oComboBox.getProperty("value"), sExpectedValue);

				// cleanup
				oComboBox.destroy();
			});

			test("onChange is fired after the value changes by pressing pagedown key and enter", function() {

				// system under test
				var sExpectedValue = "Cuba";
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "DZ",
							text: "Algeria"
						}),
						new sap.ui.core.Item({
							key: "GER",
							text: "Germany",
						}),
						new sap.ui.core.Item({
							key: "CU",
							text: "Cuba",
						})
					],
					selectedKey: "DZ"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				var fnFireChangeSpy = this.spy(oComboBox, "fireChange");

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.PAGE_DOWN);
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ENTER);

				// assert
				strictEqual(fnFireChangeSpy.callCount, 1, 'The "change" event is fired');
				strictEqual(oComboBox.getValue(), sExpectedValue);
				strictEqual(oComboBox.getProperty("value"), sExpectedValue);

				// cleanup
				oComboBox.destroy();
			});

			test("onChange is fired after the value changes by pressing pageup key when the control loses the focus", function() {

				// system under test
				var sExpectedValue = "Algeria";
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "DZ",
							text: "Algeria"
						}),
						new sap.ui.core.Item({
							key: "GER",
							text: "Germany",
						}),
						new sap.ui.core.Item({
							key: "CU",
							text: "Cuba",
						})
					],
					selectedKey: "CU"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				var fnFireChangeSpy = this.spy(oComboBox, "fireChange");

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.PAGE_UP);
				oComboBox.getFocusDomRef().blur();
				this.clock.tick(0);	// when a blur event occurs the "sapfocusleave" is fired async

				// assert
				strictEqual(fnFireChangeSpy.callCount, 1, 'The "change" event is fired');
				strictEqual(oComboBox.getValue(), sExpectedValue);
				strictEqual(oComboBox.getProperty("value"), sExpectedValue);

				// cleanup
				oComboBox.destroy();
			});

			test("onChange is fired after the value changes by pressing pageup key and enter", function() {

				// system under test
				var sExpectedValue = "Algeria";
				var oComboBox = new sap.m.ComboBox({
					items: [
						new sap.ui.core.Item({
							key: "DZ",
							text: "Algeria"
						}),
						new sap.ui.core.Item({
							key: "GER",
							text: "Germany",
						}),
						new sap.ui.core.Item({
							key: "CU",
							text: "Cuba",
						})
					],
					selectedKey: "CU"
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				var fnFireChangeSpy = this.spy(oComboBox, "fireChange");

				// act
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.PAGE_UP);
				sap.ui.test.qunit.triggerKeydown(oComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ENTER);

				// assert
				strictEqual(fnFireChangeSpy.callCount, 1, 'The "change" event is fired');
				strictEqual(oComboBox.getValue(), sExpectedValue);
				strictEqual(oComboBox.getProperty("value"), sExpectedValue);

				// cleanup
				oComboBox.destroy();
			});

			// unit test for CSN 0120061532 0001168439 2014
			test("onChange is not fired when no changes are made", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox();

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				var fnFireChangeSpy = this.spy(oComboBox, "fireChange");
				oComboBox.updateDomValue("Germany");
				oComboBox.getFocusDomRef().blur();	// on blur the DOM value has changed => the change event is fired

				// act
				oComboBox.focus();
				oComboBox.getFocusDomRef().blur();	// the DOM value has not changed => the change event should not be fired again
				this.clock.tick(0);	// when a blur event occurs the "sapfocusleave" is fired async

				// assert
				strictEqual(fnFireChangeSpy.callCount, 1, 'The "change" event is not fired');

				// cleanup
				oComboBox.destroy();
			});

			// BCP 1570522570
			test("it should not fire the change event when the arrow button is pressed", function() {

				// system under test
				var oComboBox = new sap.m.ComboBox();

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();
				oComboBox.focus();
				var fnFireChangeSpy = this.spy(oComboBox, "fireChange");
				var oButtonDomRef = oComboBox.getOpenArea();
				oComboBox.updateDomValue("lorem ipsum");

				// act
				sap.ui.test.qunit.triggerEvent("mousedown", oButtonDomRef, {
					target: oButtonDomRef
				});

				oButtonDomRef.focus();

				sap.ui.test.qunit.triggerEvent("mouseup", oButtonDomRef, {
					target: oButtonDomRef
				});

				sap.ui.test.qunit.triggerEvent("click", oButtonDomRef, {
					target: oButtonDomRef
				});

				// assert
				strictEqual(fnFireChangeSpy.callCount, 0);

				// cleanup
				oComboBox.destroy();
			});

			/* ------------------------------ */
			/* others                         */
			/* ------------------------------ */

			test("restore items visibility after rendering", function() {

				// system under test
				var oItem;
				var oComboBox = new sap.m.ComboBox({
					items: [
						oItem = new sap.ui.core.Item({
							key: "GER",
							text: "Germany"
						})
					]
				});

				// arrange
				oComboBox.placeAt("content");
				sap.ui.getCore().applyChanges();

				// act
				oItem.bVisible = false;
				oComboBox.rerender();
				sap.ui.getCore().applyChanges();

				// assert
				strictEqual(oComboBox.isItemVisible(oItem), false);

				// cleanup
				oComboBox.destroy();
			});
		</script>
	</head>
	<body id="body" class="sapUiBody">
		<div id="content" class="content"></div>
		<h1 id="qunit-header">QUnit tests: sap.m.ComboBox</h1>
		<h2 id="qunit-banner"></h2>
		<h2 id="qunit-userAgent"></h2>
		<div id="qunit-testrunner-toolbar"></div>
		<ol id="qunit-tests"></ol>
	</body>
</html>
