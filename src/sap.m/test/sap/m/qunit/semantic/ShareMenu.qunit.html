<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta charset="utf-8">
	<title>Test Page for sap.m.semantic.ShareMenu</title>
	<script src="../../shared-config.js"></script>
	<script id="sap-ui-bootstrap"
			data-sap-ui-noConflict="true"
			src="../../../../../resources/sap-ui-core.js"
			data-sap-ui-libs="sap.m">
	</script>
	<link rel="stylesheet" href="../../../../../resources/sap/ui/thirdparty/qunit.css" type="text/css" media="screen">
	<script src="../../../../../resources/sap/ui/thirdparty/qunit.js"></script>
	<script src="../../../../../resources/sap/ui/qunit/qunit-junit.js"></script>
	<script src="../../../../../resources/sap/ui/thirdparty/sinon.js"></script>
	<script src="../../../../../resources/sap/ui/thirdparty/sinon-qunit.js"></script>
	<script src="../../../../../resources/sap/ui/qunit/QUnitUtils.js"></script>

	<script>

		jQuery.sap.require("sap.m.semantic.SemanticPage");
		jQuery.sap.require("sap.m.semantic.SemanticButton");
		jQuery.sap.require("sap.m.semantic.ShareMenu");
		jQuery.sap.require("sap.m.semantic.ShareMenuPage");

		QUnit.module("ShareMenu Control", {
			beforeEach: function () {
				this.oActionSheet = new sap.m.ActionSheet();
				// Action sheet needs a parent to create the button correctly
				this.oSemanticPage = new sap.m.semantic.SemanticPage();
				this.oSemanticPage.addDependent(this.oActionSheet);
			},
			afterEach: function () {
				this.oSemanticPage.destroy();
				jQuery("#qunit-fixture-visible").html("");
			}
		});

		QUnit.test("has correct init state", function (assert) {
			// Arrange
			var oMenu = new sap.m.semantic.ShareMenu(this.oActionSheet);

			// Act

			// Assert
			assert.strictEqual(oMenu.getBaseButton() != null, true, "ShareMenu has a base button");
			assert.strictEqual(oMenu.getContent().length, 0, "ShareMenu is empty");

			// Cleanup
			oMenu.destroy();
		});

		QUnit.test("content aggregation", function (assert) {
			// Arrange
			var oMenu = new sap.m.semantic.ShareMenu(this.oActionSheet),
					oCustomButton1 = new sap.m.Button("customButtonId1",{
						text: "Custom1",
						icon: "sap-icon://synchronize"
					}),
					oCustomButton2 = new sap.m.Button("customButtonId2",{
						text: "Custom2",
						icon: "sap-icon://video"
					}),
					oCustomButton3 = new sap.m.Button("customButtonId3",{
						text: "Custom3",
						icon: "sap-icon://task"
					});

			// Act  (add item)
			var oResult = oMenu.addContent(oCustomButton1);

			// Assert
			assert.strictEqual(oResult, oMenu, "add function returns menu reference");
			assert.strictEqual(oMenu.getContent().length, 1, "ShareMenu has one item");
			assert.strictEqual(oMenu.getContent()[0], oCustomButton1, "ShareMenu has added item");
			assert.strictEqual(oMenu.indexOfContent(oCustomButton1), 0, "index of item1 is 0");
			assert.strictEqual(oMenu.getBaseButton() != null, true, "ShareMenu has a base button");
			assert.strictEqual(oMenu.getBaseButton(), oCustomButton1, "ShareMenu has the added button as a base button");

			// Act  (add item)
			oResult = oMenu.addContent(oCustomButton2);

			// Assert
			assert.strictEqual(oResult, oMenu, "add function returns menu reference");
			assert.strictEqual(oMenu.getContent().length, 2, "ShareMenu has two items");
			assert.strictEqual(oMenu.getContent()[0], oCustomButton1, "ShareMenu has added item1");
			assert.strictEqual(oMenu.getContent()[1], oCustomButton2, "ShareMenu has added item2");
			assert.strictEqual(oMenu.indexOfContent(oCustomButton1), 0, "index of item1 is 0");
			assert.strictEqual(oMenu.indexOfContent(oCustomButton2), 1, "index of item1 is 1");
			assert.strictEqual(oMenu.getBaseButton() != null, true, "ShareMen has a base button");
			assert.strictEqual(oMenu.getBaseButton().getVisible(), true, "ShareMenu base button is visible");
			assert.strictEqual(oMenu.getBaseButton() != oCustomButton2, true, "ShareMenu base button is not item1");
			assert.strictEqual(oMenu.getBaseButton() != oCustomButton1, true, "ShareMenu base button is not item2");

			// Act  (remove item)
			oResult = oMenu.removeContent(oCustomButton1);

			// Assert
			assert.strictEqual(oResult, oCustomButton1, "remove function returns reference to removed item");
			assert.strictEqual(oMenu.getContent().length, 1, "ShareMenu has one item");
			assert.strictEqual(oMenu.getContent()[0], oCustomButton2, "ShareMenu has item2");
			assert.strictEqual(oMenu.indexOfContent(oCustomButton2), 0, "index of item2 is 0");
			assert.strictEqual(oMenu.getBaseButton() != null, true, "ShareMenu has a base button");
			assert.strictEqual(oMenu.getBaseButton(), oCustomButton2, "ShareMenu has item2 as a base button");

			// Act  (insert item)
			oResult = oMenu.insertContent(oCustomButton3, 0);

			// Assert
			assert.strictEqual(oResult, oMenu, "insert function returns menu reference");
			assert.strictEqual(oMenu.getContent().length, 2, "ShareMenu has two items");
			assert.strictEqual(oMenu.getContent()[0], oCustomButton3, "ShareMenu has added item3");
			assert.strictEqual(oMenu.getContent()[1], oCustomButton2, "ShareMenu has added item2");
			assert.strictEqual(oMenu.indexOfContent(oCustomButton3), 0, "index of item3 is 0");
			assert.strictEqual(oMenu.indexOfContent(oCustomButton2), 1, "index of item2 is 1");
			assert.strictEqual(oMenu.getBaseButton() != null, true, "ShareMen has a base button");
			assert.strictEqual(oMenu.getBaseButton().getVisible(), true, "ShareMenu base button is visible");
			assert.strictEqual(oMenu.getBaseButton() != oCustomButton2, true, "ShareMenu base button is not item2");
			assert.strictEqual(oMenu.getBaseButton() != oCustomButton3, true, "ShareMenu base button is not item3");

			// Act  (insert item)
			oResult = oMenu.insertContent(oCustomButton1, 1);

			// Assert
			assert.strictEqual(oResult, oMenu, "insert function returns menu reference");
			assert.strictEqual(oMenu.getContent().length, 3, "ShareMenu has two items");
			assert.strictEqual(oMenu.getContent()[0], oCustomButton3, "ShareMenu has added item3");
			assert.strictEqual(oMenu.getContent()[1], oCustomButton1, "ShareMenu has added item1");
			assert.strictEqual(oMenu.getContent()[2], oCustomButton2, "ShareMenu has added item2");
			assert.strictEqual(oMenu.getBaseButton() != null, true, "ShareMen has a base button");
			assert.strictEqual(oMenu.getBaseButton().getVisible(), true, "ShareMenu base button is visible");
			assert.strictEqual(oMenu.getBaseButton() != oCustomButton1, true, "ShareMenu base button is not item1");
			assert.strictEqual(oMenu.getBaseButton() != oCustomButton2, true, "ShareMenu base button is not item2");
			assert.strictEqual(oMenu.getBaseButton() != oCustomButton3, true, "ShareMenu base button is not item3");

			// Act  (remove all)
			oResult = oMenu.removeAllContent();

			// Assert
			assert.strictEqual(oResult.length, 3, "removeAll function returns removed items");
			assert.strictEqual(oMenu.getContent().length, 0, "ShareMenu has no items");
			assert.strictEqual(oResult[0], oCustomButton3, "ShareMenu has removed item3");
			assert.strictEqual(oResult[1], oCustomButton1, "ShareMenu has removed item1");
			assert.strictEqual(oResult[2], oCustomButton2, "ShareMenu has removed item2");
			assert.strictEqual(oMenu.getBaseButton() != null, true, "ShareMen has a base button");
			assert.strictEqual(oMenu.getBaseButton().getVisible(), false, "ShareMenu base button is not visible");
			assert.strictEqual(oMenu.getBaseButton() != oCustomButton1, true, "ShareMenu base button is not item1");
			assert.strictEqual(oMenu.getBaseButton() != oCustomButton2, true, "ShareMenu base button is not item2");
			assert.strictEqual(oMenu.getBaseButton() != oCustomButton3, true, "ShareMenu base button is not item3");

			// Act  (insert item)
			oResult = oMenu.insertContent(oCustomButton1, 0);

			// Assert
			assert.strictEqual(oResult, oMenu, "insert function returns menu reference");
			assert.strictEqual(oMenu.getContent().length, 1, "ShareMenu has one item");
			assert.strictEqual(oMenu.getContent()[0], oCustomButton1, "ShareMenu has added item");
			assert.strictEqual(oMenu.indexOfContent(oCustomButton1), 0, "index of item1 is 0");
			assert.strictEqual(oMenu.getBaseButton() != null, true, "ShareMenu has a base button");
			assert.strictEqual(oMenu.getBaseButton(), oCustomButton1, "ShareMenu has the added button as a base button");

			// Cleanup
			oMenu.destroy();
		});

		QUnit.test("share menu button visibility", function (assert) {
			// Arrange
			var fnGetButton = function(oConfig) {
				return new sap.m.Button(oConfig || {});
			},
			oButton1 = fnGetButton({text: "Custom1", icon: "sap-icon://synchronize"}),
			oButton2 = fnGetButton({text: "Custom2", icon: "sap-icon://video"}),
			oButton3 = fnGetButton({text: "Custom3", icon: "sap-icon://task"}),
			oPage = new sap.m.semantic.ShareMenuPage({
				customShareMenuContent: [oButton1]
			}),
			oShareMenu = oPage._oSegmentedShareMenu.getContainer(),
			oShareMenuBtn = oShareMenu._getShareMenuButton();

			// Assert: The share menu button should not be visible, when there is one share menu content.
			assert.strictEqual(oShareMenuBtn.getVisible(), false, "ShareMenu button is not visible initially");

			// Act: Add a second visible item.
			oPage.addCustomShareMenuContent(oButton2);

			// Assert
			assert.strictEqual(oShareMenuBtn.getVisible(), true,
					"ShareMenu button is visible: there are two visible items");

			// Act: Hide both the buttons.
			oButton1.setVisible(false);
			oButton2.setVisible(false);

			// Assert
			assert.strictEqual(oShareMenuBtn.getVisible(), false,
					"ShareMenu button is not visible: there are no visible items");

			// Act: Add third item - it`s visible.
			// Although there is a single visible item 1 of 3, the share menu button will be visible.
			oPage.addCustomShareMenuContent(oButton3);
			// Assert
			assert.strictEqual(oShareMenuBtn.getVisible(), true,
					"ShareMenu button is visible: there are 3 items, at least one visible");

			// Act: Remove the visible item.
			oPage.removeCustomShareMenuContent(oButton3);
			// Assert
			assert.strictEqual(oShareMenuBtn.getVisible(), false,
					"ShareMenu button is not visible: there are no visible items");

			// Act: Show both the buttons and remove all content.
			oButton1.setVisible(true);
			oButton2.setVisible(true);
			oPage.removeAllCustomShareMenuContent();

			// Assert
			assert.strictEqual(oShareMenuBtn.getVisible(), false,
					"ShareMenu button is not visible: there are no items");
			assert.strictEqual(oButton1._fnOriginalSetVisible, undefined,
					"button`s setVisible method is recovered.");
			assert.strictEqual(oButton1._fnOriginalSetVisible, undefined,
					"button`s setVisible method is recovered.");
			assert.strictEqual(oButton1._fnOriginalSetVisible, undefined,
					"button`s setVisible method is recovered.");

			// Cleanup
			oButton1.destroy();
			oButton2.destroy();
			oButton3.destroy();
			oPage.destroy();
		});
	</script>
</head>
<body id="body" class="sapUiBody">
<h1 id="qunit-header">QUnit tests: sap.m.semantic.SemanticPage</h1>
<h2 id="qunit-banner"></h2>
<h2 id="qunit-userAgent"></h2>
<!--<div id="qunit-testrunner-toolbar"></div>-->
<ol id="qunit-tests"></ol>
<div id="qunit-fixture"></div>
<div id="qunit-fixture-visible"></div>
</body>
</html>
