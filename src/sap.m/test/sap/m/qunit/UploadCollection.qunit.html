<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>Test Page for sap.m.UploadCollection</title>

<script id="sap-ui-bootstrap" data-sap-ui-theme="sap_bluecrystal"
	type="text/javascript" data-sap-ui-noConflict="true"
	data-sap-ui-libs="sap.m" src="../../../../resources/sap-ui-core.js"
	data-sap-ui-language="en">
</script>

<link rel="stylesheet" href="../../../../resources/sap/ui/thirdparty/qunit.css" type="text/css" media="screen" />
<script type="text/javascript" src="../../../../resources/sap/ui/thirdparty/qunit.js"></script>
<script type="text/javascript" src="../../../../resources/sap/ui/thirdparty/sinon.js"></script>
<script type="text/javascript" src="../../../../resources/sap/ui/thirdparty/sinon-qunit.js"></script>
<script type="text/javascript" src="../../../../resources/sap/ui/qunit/qunit-junit.js"></script>
<script type="text/javascript" src="../../../../resources/sap/ui/qunit/QUnitUtils.js"></script>
<script type="text/javascript" src="UploadCollectionForPendingUpload.qunit.js"></script>

<script type="text/javascript">
	if(!(sap.ui.Device.browser.msie && sap.ui.Device.browser.version <= 8)) {
		jQuery.sap.require("sap.ui.qunit.qunit-coverage");
	}

	var oData = {
			"items" : [{
				"contributor" : "Susan Baker",
				"documentId" : "64469d2f-b3c4-a517-20d6-f91ebf85b9da",
				"fileName" : "Screenshot.ico",
				"fileSize" : 20,
				"thumbnailUrl" : "",
				"uploadedDate" : "2014-07-30",
				"url" : "",
				"ariaLabelForPicture" : "textForIconOfItemSusanBaker"
			},{
				"contributor" : "John Smith",
				"documentId" : "5082cc4d-da9f-2835-2c0a-8100ed47bcde",
				"fileName" : "Notes.txt",
				"fileSize" : 10,
				"mimeType" : "text/plain",
				"thumbnailUrl" : "",
				"uploadedDate" : "2014-08-01",
				"url" : "/pathToTheFile/Notes.txt"
			},{
				"contributor" : "J Edgar Hoover",
				"documentId" : "5082cc4d-da9f-2835-2c0a-8100ed47bcdf",
				"enableEdit" : false,
				"enableDelete" : false,
				"fileName" : "Document.txt",
				"fileSize" : 15,
				"mimeType" : "text/plain",
				"thumbnailUrl" : "",
				"uploadedDate" : "2014-09-01",
				"url" : "/pathToTheFile/Document.txt"
			},{
				"contributor" : "Kate Brown",
				"documentId" : "b68a7065-cc2a-2140-922d-e7528cd32172",
				"enableEdit" : false,
				"enableDelete" : false,
				"visibleEdit" : "{visibleEdit}",
				"visibleDelete" : "{visibleDelete}",
				"fileName" : "Picture of a woman.png",
				"fileSize" : 70,
				"mimeType" : "image/png",
				"thumbnailUrl" : "../images/Woman_04.png",
				"uploadedDate" : "2014-07-25",
				"url" : "/pathToTheFile/Woman_04.png",
				"ariaLabelForPicture" : "textForImageOfItemKateBrown",
			}]
		};

	var oItemTemplate = new sap.m.UploadCollectionItem({
		contributor : "{contributor}",
		documentId : "{documentId}",
		enableEdit : "{enableEdit}",
		enableDelete : "{enableDelete}",
		fileName : "{fileName}",
		fileSize : "{fileSize}",
		mimeType : "{mimeType}",
		thumbnailUrl : "{thumbnailUrl}",
		uploadedDate : "{uploadedDate}",
		url : "{url}",
		ariaLabelForPicture : "{ariaLabelForPicture}"
	});

	var oModel = new sap.ui.model.json.JSONModel(oData);
	sap.ui.getCore().setModel(oModel);

	/* --------------------------------------- */
	/* Test properties                         */
	/* --------------------------------------- */
	QUnit.module("Basic Rendering", {
		setup : function() {
			this.oUploadCollection = new sap.m.UploadCollection("uploadCollection", {
				items : {
					path : "/items",
					template : oItemTemplate
				}
			});
			this.oUploadCollection.placeAt("qunit-fixture");
			sap.ui.getCore().applyChanges();
		},
		teardown : function() {
			this.oUploadCollection.destroy();
		}
	});

	QUnit.test("Composite Controls are rendered", function(assert) {
		assert.ok(jQuery.sap.domById("uploadCollection-list"), "Item list is rendered");
		assert.ok(jQuery.sap.domById("uploadCollection-toolbar"), "Toolbar of the item list is rendered");
		assert.ok(jQuery.sap.domById("uploadCollection-numberOfAttachmentsTitle"), "Title attachments is rendered");
		assert.ok(jQuery.sap.domById(this.oUploadCollection.getId() + "-" + this.oUploadCollection._iFUCounter + "-uploader"), "FileUploader is rendered");
	});


	/* --------------------------------------- */
	/* Test methods                            */
	/* --------------------------------------- */
	QUnit.module("Internal Methods", {
		setup : function() {
			this.oUploadCollection = new sap.m.UploadCollection("uploadCollection", {
				items : {
					path : "/items",
					template : oItemTemplate
				}
			});
			this.oUploadCollection.placeAt("qunit-fixture");
			sap.ui.getCore().applyChanges();
		},
		teardown : function() {
			this.oUploadCollection.destroy();
		}
	});

	QUnit.test("Get number of attachments titel (defaul text)", function(assert) {
		var sText = this.oUploadCollection._oRb.getText("UPLOADCOLLECTION_ATTACHMENTS", [999]);
		assert.strictEqual(this.oUploadCollection._getNumberOfAttachmentsTitle(999).getText(), sText, "Correct Title text for number of attachments.");
	});

	QUnit.test("Get number of attachments title", function(assert) {
		var sText = this.oUploadCollection._oRb.getText("UPLOADCOLLECTION_ATTACHMENTS", [999]);
		assert.strictEqual(this.oUploadCollection._getNumberOfAttachmentsTitle(999).getText(), sText, "Correct Title text for number of attachments");
		var sText = "My own text for attachments";
		this.oUploadCollection.setNumberOfAttachmentsText("My own text for attachments");
		assert.strictEqual(this.oUploadCollection._getNumberOfAttachmentsTitle().getText(), sText, "Correct Title text for number of attachments.");
		sap.ui.getCore().applyChanges();
		assert.strictEqual(jQuery(jQuery.sap.domById("uploadCollection-numberOfAttachmentsTitle")).text(), sText);
	});

	QUnit.test("Determine icon from filename", function(assert) {
		assert.equal(this.oUploadCollection._getIconFromFilename("fileName"), 'sap-icon://document', "Document icon returned in case no file extension exists.");

		assert.equal(this.oUploadCollection._getIconFromFilename("fileName.pdf"), 'sap-icon://pdf-attachment', "Correct icon for file type .pdf determined");

		assert.equal(this.oUploadCollection._getIconFromFilename("fileName.jpg"), 'sap-icon://camera', "Correct icon for file type .jpg determined");
		assert.equal(this.oUploadCollection._getIconFromFilename("complexFileName.JPEG"), 'sap-icon://camera', "Correct icon for file type 'JPEG' determined");
		assert.equal(this.oUploadCollection._getIconFromFilename("fileName.png"), 'sap-icon://camera', "Correct icon for file type .png determined");
		assert.equal(this.oUploadCollection._getIconFromFilename("fileName.bmp"), 'sap-icon://camera', "Correct icon for file type .bmp determined");

		assert.equal(this.oUploadCollection._getIconFromFilename("fileName.txt"), 'sap-icon://document-text', "Correct icon for file type .txt determined");

		assert.equal(this.oUploadCollection._getIconFromFilename("fileName.doc"), 'sap-icon://doc-attachment', "Correct icon for file type .doc determined");
		assert.equal(this.oUploadCollection._getIconFromFilename("fileName.docx"), 'sap-icon://doc-attachment', "Correct icon for file type .docx determined");
		assert.equal(this.oUploadCollection._getIconFromFilename("fileName.odt"), 'sap-icon://doc-attachment', "Correct icon for file type .odt determined");

		assert.equal(this.oUploadCollection._getIconFromFilename("fileName.xls"), 'sap-icon://excel-attachment', "Correct icon for file type .xls determined");
		assert.equal(this.oUploadCollection._getIconFromFilename("fileName.csv"), 'sap-icon://excel-attachment', "Correct icon for file type .csv determined");

		assert.equal(this.oUploadCollection._getIconFromFilename("fileName.ppt"), 'sap-icon://ppt-attachment', "Correct icon for file type .ppt determined");
		assert.equal(this.oUploadCollection._getIconFromFilename("fileName.pptx"), 'sap-icon://ppt-attachment', "Correct icon for file type .pptx determined");

		assert.equal(this.oUploadCollection._getIconFromFilename("complexFileName.123.pdf.jpg.png.bmp.ppt"), 'sap-icon://ppt-attachment', "Correct icon for file type determined");
	});

	QUnit.test("Determine thumbnail of an item", function(assert) {
		var sThumbnailUrl = "anyFolder/myThumbnailFile.jpg";
		var sFilename = "complexFileName.123.pdf.jpg.png.bmp.ppt";
		this.oUploadCollection._getIconFromFilename = function() {
			return "_getIconFromFilename called";
		};

		// determine by thumbnail
		assert.equal(this.oUploadCollection._getThumbnail(sThumbnailUrl, sFilename), "anyFolder/myThumbnailFile.jpg", "Correct thumbnail determined by thumbnail url");

		// determine by file name
		sThumbnailUrl = "";
		assert.equal(this.oUploadCollection._getThumbnail(sThumbnailUrl, sFilename), "_getIconFromFilename called", "Correct thumbnail determined by file name, thumbnail Url not provided");
		sThumbnailUrl = null;
		assert.equal(this.oUploadCollection._getThumbnail(sThumbnailUrl, sFilename), "_getIconFromFilename called", "Correct thumbnail determined by file name, thumbnail Url is null");
		sFilename = "";
		assert.equal(this.oUploadCollection._getThumbnail(sThumbnailUrl, sFilename), "_getIconFromFilename called", "Correct thumbnail determined by file name, file name not provided");
		sFilename = null;
		assert.equal(this.oUploadCollection._getThumbnail(sThumbnailUrl, sFilename), "_getIconFromFilename called", "Correct thumbnail determined by file name, file name is null");
	});

	QUnit.test("Determine and set unique key for a file", function(assert) {
		var sFileName = "someFileName", sRequestId = "1", sFileNameRequestIdValue, aRequestHeaders = [{
				name: this.oUploadCollection._headerParamConst.requestIdName,
				value: sRequestId
			}];
		var oFileUploader = this.oUploadCollection._getFileUploader();
		oFileUploader.fireUploadStart({
			fileName : sFileName,
			requestHeaders: aRequestHeaders
		});
		var iParamCounter = aRequestHeaders.length;
		for (var i = 0; i < iParamCounter; i++ ) {
			if (aRequestHeaders[i].name === this.oUploadCollection._headerParamConst.fileNameRequestIdName) {
				sFileNameRequestIdValue = aRequestHeaders[i].value;
			}
		}
		assert.equal(sFileNameRequestIdValue, sFileName + sRequestId, "Unique key for a File is set correctly into requestHeaders");
	});

	QUnit.test("handleTerminate opens a dialog which could be cancelled.", function(assert) {
		var done = assert.async();
		var oItem = new sap.m.UploadCollectionItem({
			fileName : "otto4711.txt"
		});
		this.oUploadCollection._handleTerminate({}, oItem);
		sap.ui.getCore().applyChanges();
		var oDialog = sap.ui.getCore().byId(this.oUploadCollection.getId() + "deleteDialog");
		assert.ok(oDialog.getDomRef(), "Dialog was rendered.");
		oDialog.attachAfterClose(function () {
			assert.ok(true, "Dialog is closed.");
			done();
		});
		oDialog.getButtons()[1].firePress();
		sap.ui.getCore().applyChanges();
	});

	QUnit.test("handleTerminate - abort on FileUploader is called.", function(assert) {
		var done = assert.async();
		// Prepare FileUploader Spy
		this.oUploadCollection._getFileUploader()._aXhr = [];
		sinon.spy(this.oUploadCollection._getFileUploader(), "abort");
		// Prepare UploadCollectionItem
		var oItem = new sap.m.UploadCollectionItem({
			fileName : "otto4711.txt"
		});
		oItem._status = sap.m.UploadCollection._uploadingStatus;
		oItem._requestIdName = 0;
		this.oUploadCollection.insertItem(oItem);
		sap.ui.getCore().applyChanges();
		// Call termination
		this.oUploadCollection._handleTerminate({}, oItem);
		var oDialog = sap.ui.getCore().byId(this.oUploadCollection.getId() + "deleteDialog");
		oDialog.attachAfterClose(function () {
			assert.ok(true, "Dialog is closed.");
			done();
		});
		oDialog.getButtons()[0].firePress();
		sap.ui.getCore().applyChanges();
		assert.equal(this.oUploadCollection._getFileUploader().abort.callCount, 1, "Abort on FileUploader was called.");
	});

	QUnit.test("handleTerminate - deleteFile is fired if the upload is done before a confirmation of the termination.", function(assert) {
		var done = assert.async();
		// Prepare UploadCollectionItem and UploadCollection itself
		var oItem = new sap.m.UploadCollectionItem({
			fileName : "otto4711.txt",
			documentId : "4712"
		});
		oItem._status = sap.m.UploadCollection._displayStatus;
		this.oUploadCollection.insertItem(oItem);
		this.oUploadCollection.attachFileDeleted(function (oEvent) {
			assert.equal(oEvent.getParameter("documentId"), "4712", "Correct documentId passed.");
			assert.deepEqual(oEvent.getParameter("item"), oItem, "Correct item passed.");
		});
		sap.ui.getCore().applyChanges();
		// Call termination
		this.oUploadCollection._handleTerminate({}, oItem);
		var oDialog = sap.ui.getCore().byId(this.oUploadCollection.getId() + "deleteDialog");
		oDialog.attachAfterClose(function () {
			assert.ok(true, "Dialog is closed.");
			done();
		});
		oDialog.getButtons()[0].firePress();
		sap.ui.getCore().applyChanges();
	});

	/* --------------------------------------- */
	/* Test events                             */
	/* --------------------------------------- */
	QUnit.module("Event tests", {
		setup : function() {
			this.oUploadCollection = new sap.m.UploadCollection({
				maximumFilenameLength : 35,
				items : {
					path : "/items",
					template : oItemTemplate
				}
			});
			this.oDataCopy = jQuery.extend(true, {}, oData);
			this.oUploadCollection.placeAt("qunit-fixture");
			sap.ui.getCore().applyChanges();
		},
		teardown : function() {
			this.oUploadCollection.destroy();
			oData = this.oDataCopy;
		}
	});

	QUnit.test("Event typeMissmatch", function(assert) {
		assert.expect(18); // verifies the event handler was executed
		var oFile = {
			name: "someFileName",
			fileType : "someNotAllowedFileType",
			mimeType : "someNotAllowedMimeType"
		};
		function onTypeMissmatch(oEvent) {
			assert.ok(true, "Event typeMissmatch fired");
			assert.equal(oEvent.getId(), "typeMissmatch", "Event Id 'typeMissmatch' provided");
			// deprecated
			assert.equal(oEvent.mParameters.getParameter("fileName"), "someFileName", "Correct file name provided in typeMissmatch by oEvent.mParameters.getParameter('fileName')");
			assert.equal(oEvent.getParameters().getParameters()["fileName"], "someFileName", "Correct file name provided in typeMissmatch by oEvent.getParameters().getParameters()['fileName']");
			assert.equal(oEvent.getParameter("mParameters")["fileName"], "someFileName", "Correct file name provided in typeMissmatch by oEvent.getParameter('mParameters')['fileName']");
			assert.equal(oEvent.mParameters.getParameter("fileType"), "someNotAllowedFileType", "Correct file type provided in typeMissmatch by oEvent.mParameters.getParameter('fileType')");
			assert.equal(oEvent.getParameters().getParameters()["fileType"], "someNotAllowedFileType", "Correct file type provided in typeMissmatch by oEvent.getParameters().getParameters()['fileType']");
			assert.equal(oEvent.getParameter("mParameters")["fileType"], "someNotAllowedFileType", "Correct file type provided in typeMissmatch by oEvent.getParameter('mParameters')['fileType']");
			assert.equal(oEvent.mParameters.getParameter("mimeType"), "someNotAllowedMimeType", "Correct mime type provided in typeMissmatch by oEvent.mParameters.getParameter('mimeType')");
			assert.equal(oEvent.getParameters().getParameters()["mimeType"], "someNotAllowedMimeType", "Correct mime type provided in typeMissmatch by oEvent.getParameters().getParameters()['mimeType']");
			assert.equal(oEvent.getParameter("mParameters")["mimeType"], "someNotAllowedMimeType", "Correct mime type provided in typeMissmatch by oEvent.getParameter('mParameters')['mimeType']");
			//new
			assert.equal(oEvent.getParameter("files")[0].name, "someFileName", "Correct file name provided in typeMissmatch event by oEvent.getParameter('files')[0].name");
			assert.equal(oEvent.getParameters()["files"][0]["name"], "someFileName", "Correct file name provided in typeMissmatch event by oEvent.getParameters()['files'][0]['name']");
			assert.equal(oEvent.getParameter("files")[0].fileType, "someNotAllowedFileType", "Correct file type provided in typeMissmatch by oEvent.getParameter('files')[0].fileType");
			assert.equal(oEvent.getParameter("files")[0]["fileType"], "someNotAllowedFileType", "Correct file type provided in typeMissmatch by oEvent.getParameter('files')[0]['fileType']");
			assert.equal(oEvent.getParameter("files")[0].mimeType, "someNotAllowedMimeType", "Correct mime type provided in typeMissmatch by oEvent.getParameter('files')[0].mimeType");
			assert.equal(oEvent.getParameter("files")[0]["mimeType"], "someNotAllowedMimeType", "Correct mime type provided in typeMissmatch by oEvent.getParameter('files')[0]['mimeType']");
			assert.deepEqual(oEvent.getParameter("files")[0], oFile, "Correct file provided in typeMissmatch event by oEvent.getParameter('files')[0].");
		}
		this.oUploadCollection.attachTypeMissmatch(onTypeMissmatch);
		this.oUploadCollection._getFileUploader().fireTypeMissmatch({
			fileName : "someFileName",
			fileType : "someNotAllowedFileType",
			mimeType : "someNotAllowedMimeType"
		});
	});

	QUnit.test("Event fileSizeExceed", function(assert) {
		var sFileSize = "sizeOfTooBigFile";
		var sFileName = "nameOfTooBigFile";
		var oFileUploaderEventMock = {
			newValue : sFileName,
			fileSize : sFileSize,
			fileName : sFileName
		};
		function fileSizeExceed(oEvent) {
			var sFileName = "nameOfTooBigFile";
			var sDocumentId; // undefined
			var sFileSize = "sizeOfTooBigFile";
			var oBigFile = {
					name: sFileName,
					fileSize : sFileSize
				};
			assert.equal(oEvent.getId(), "fileSizeExceed", "Event Id 'fileSizeExceed' provided");
			if (sap.ui.Device.browser.msie && sap.ui.Device.browser.version <= 9) {
				// deprecated
				assert.equal(oEvent.getParameters().getParameter("newValue"), sFileName, "Correct file name in change event provided by oEvent.getParameters().getParameter('newValue')");
				assert.equal(oEvent.getParameters().getParameters()["newValue"], sFileName, "Correct file name in change event provided by oEvent.getParameters().getParameters()['newValue']");
				assert.equal(oEvent.getParameter("mParameters")["newValue"], sFileName, "Correct file name in change event provided by oEvent.getParameter('mParameters')['newValue']");
				// new
				assert.equal(oEvent.getParameter("files")[0].name, sFileName, "Correct file name in fileSizeExceed event provided by oEvent.getParameter('files')[0].name");
				assert.equal(oEvent.getParameters()["files"][0]["name"], sFileName, "Correct file name in fileSizeExceed event provided by oEvent.getParameters()['files'][0]['name']");
			} else {
				// deprecated
				assert.equal(oEvent.getParameters().getParameter("documentId"), sDocumentId, "Correct documentId in fileSizeExceed event provided by oEvent.getParameters().getParameter('documentId')");
				assert.equal(oEvent.getParameters().getParameters()["documentId"], sDocumentId, "Correct documentId in fileSizeExceed event provided by oEvent.getParameters().getParameters()['documentId']");
				assert.equal(oEvent.getParameter("mParameters")["documentId"], sDocumentId, "Correct documentId in fileSizeExceed event provided by oEvent.getParameter('mParameters')['documentId']");
				assert.equal(oEvent.getParameters().getParameter("fileSize"), sFileSize, "Correct fileSize in fileSizeExceed event provided by oEvent.getParameters().getParameter('fileSize')");
				assert.equal(oEvent.getParameters().getParameters()["fileSize"], sFileSize, "Correct fileSize in fileSizeExceed event provided by oEvent.getParameters().getParameters()['fileSize']");
				assert.equal(oEvent.getParameter("mParameters")["fileSize"], sFileSize, "Correct fileSize in fileSizeExceed event provided by oEvent.getParameter('mParameters')['fileSize']");
				// new
				assert.equal(oEvent.getParameter("files")[0].name, sFileName, "Correct file name in fileSizeExceed event provided by oEvent.getParameter('files')[0].name");
				assert.equal(oEvent.getParameters()["files"][0]["name"], sFileName, "Correct file name in fileSizeExceed event provided by oEvent.getParameters()['files'][0]['name']");
				assert.deepEqual(oEvent.getParameter("files")[0], oBigFile, "Correct file in fileSizeExceed event provided by oEvent.getParameter('files')[0]");
				assert.equal(oEvent.getParameter("files")[0].fileSize, sFileSize, "Correct file size in fileSizeExceed event provided by oEvent.getParameter('files')[0].fileSize");
				assert.equal(oEvent.getParameters()["files"][0]["fileSize"], sFileSize, "Correct file size in fileSizeExceed event provided by oEvent.getParameters()['files'][0]['fileSize']");
				assert.deepEqual(oEvent.getParameter("files")[0], oBigFile, "Correct file in fileSizeExceed event provided by oEvent.getParameter('files')[0]");
			}
		};
		this.oUploadCollection.attachFileSizeExceed(fileSizeExceed);
		this.oUploadCollection._onFileSizeExceed(new sap.ui.base.Event("fileSizeExceed", this.oUploadCollection._getFileUploader(), oFileUploaderEventMock));
	});

	QUnit.test("Event change", function(assert) {
		var oFile1 = {
			name: "file1",
			size: 1,
			type: "type1"
		};
		var oFile2 = {
			name: "file2",
			size: 2,
			type: "type2"
		};
		var aFiles = [oFile1, oFile2];
		function onChange (oEvent) {
			if (sap.ui.Device.browser.msie && sap.ui.Device.browser.version <= 9) {
				// deprecated
				assert.equal(oEvent.getParameters().getParameter("files")[0].name, "file1", "Correct file name in change event provided by oEvent.getParameters().getParameter('files').name");
				assert.equal(oEvent.getParameters().getParameters()["files"][0]["name"], "file1", "Correct file name in change event provided by oEvent.getParameters().getParameters()['files']['name']");
				assert.equal(oEvent.getParameter("mParameters")["files"][0]["name"], "file1", "Correct file 1 in change event provided by oEvent.getParameter('mParameters')['files'][0]['name']");

				// check for properly provided parameters
				assert.equal(oEvent.getParameter("files")[0].name, "file1", "Correct file name 1 in change event provided byoEvent.getParameter('files')[0].name");
				assert.equal(oEvent.getParameters()["files"][0]["name"], "file1", "Correct file name in change event provided by oEvent.getParameters()['files'][0]['name']");
			}
			else {
				// deprecated
				assert.deepEqual(oEvent.getParameters().getParameter("files")[0], oFile1, "Correct file 1 in change event provided by oEvent.getParameters().getParameter('files')");
				assert.deepEqual(oEvent.getParameters().getParameter("files")[1], oFile2, "Correct file 2 in change event provided by oEvent.getParameters().getParameter('files').");

				assert.deepEqual(oEvent.getParameters().getParameters()["files"][0], oFile1, "Correct file 1 in change event provided by oEvent.getParameters().getParameters()['files']");
				assert.deepEqual(oEvent.getParameters().getParameters()["files"][1], oFile2, "Correct file 2 in change event provided by oEvent.getParameters().getParameters()['files']");

				assert.deepEqual(oEvent.getParameter("mParameters").files[0], oFile1, "Correct file 1 in change event provided by oEvent.getParameter('mParameters').files[0]");
				assert.deepEqual(oEvent.getParameter("mParameters").files[1], oFile2, "Correct file 2 in change event provided by oEvent.getParameter('mParameters').files[1]");

				// checks for properly provided parameters
				assert.deepEqual(oEvent.getParameter("files")[0], oFile1, "Correct file 1 in change event provided by oEvent.getParameter('files')");
				assert.deepEqual(oEvent.getParameter("files")[1], oFile2, "Correct file 2 in change event provided by oEvent.getParameter('files')");
				assert.deepEqual(oEvent.getParameters()["files"][0], oFile1, "Correct file 1 in change event provided by oEvent.getParameters()['files']");
				assert.deepEqual(oEvent.getParameters()["files"][1], oFile2, "Correct file 2 in change event provided by oEvent.getParameters()['files']");
			}
		}
		this.oUploadCollection.attachChange(onChange);
		if (sap.ui.Device.browser.msie && sap.ui.Device.browser.version <= 9) {
			// at present FileUploader does not set the parameter files for IE9
			assert.expect(5);
			this.oUploadCollection._getFileUploader().fireChange({
				newValue : "file1"
			});
		}
		else {
			assert.expect(10); // verifies the event handler was executed
			this.oUploadCollection._getFileUploader().fireChange({
				files : aFiles
			});
		}
	});

	QUnit.test("Event fileDeleted", function (assert) {
		function onDelete (oEvent) {
			// deprecated
			assert.equal(oEvent.getParameter("documentId"), "5082cc4d-da9f-2835-2c0a-8100ed47bcde", "Correct documentId in event delete");
			// new
			assert.equal(oEvent.getParameter("item"), this._oItemForDelete, "Correct item in event delete");
		}
		assert.expect(2);
		this.oUploadCollection.attachFileDeleted(onDelete);
		this.oUploadCollection._oItemForDelete = this.oUploadCollection.getItems()[1]; // contributor : John Smith, documentId : "5082cc4d-da9f-2835-2c0a-8100ed47bcde"
		this.oUploadCollection._onCloseMessageBoxDeleteItem(sap.m.MessageBox.Action.OK);
	});

	QUnit.test("Event filenameLengthExceed", function(assert) {
		assert.expect(8);
		function onFilenameLengthExceed (oEvent) {
			var oFile = { name: "tooLongFileName" };
			assert.ok(true, "Event filenameLengthExceed fired");
			assert.equal(oEvent.getId(), "filenameLengthExceed", "Event Id 'filenameLengthExceed' provided");
			// deprecated
			assert.equal(oEvent.getParameters().getParameter("fileName"), "tooLongFileName", "Correct file name in filenameLengthExceed event provided by oEvent.getParameters().getParameter('fileName')");
			assert.equal(oEvent.getParameters().getParameters()["fileName"], "tooLongFileName",  "Correct file name in filenameLengthExceed event provided by oEvent.getParameters().getParameters()['fileName']");
			assert.equal(oEvent.getParameter("mParameters")["fileName"], "tooLongFileName", "Correct file name in filenameLengthExceed event provided by oEvent.getParameter('mParameters')['fileName']");
			// new
			assert.equal(oEvent.getParameter("files")[0].name, "tooLongFileName", "Correct file name in filenameLengthExceed event provided by oEvent.getParameter('files')[0].name");
			assert.equal(oEvent.getParameters()["files"][0]["name"], "tooLongFileName", "Correct file name in filenameLengthExceed event provided by oEvent.getParameters()['files'][0]['name']");
			assert.deepEqual(oEvent.getParameter("files")[0], oFile, "Correct file in filenameLengthExceed event provided by oEvent.getParameter('files')[0]");
		}

		this.oUploadCollection.attachFilenameLengthExceed(onFilenameLengthExceed);
		this.oUploadCollection._getFileUploader().fireFilenameLengthExceed({
			fileName : "tooLongFileName"
		});
	});

	QUnit.test("Event fileRenamed", function(assert) {
		assert.expect(7);
		function onFileRenamed (oEvent) {
			assert.equal(oEvent.getId(), "fileRenamed", "Event Id 'fileRenamed' provided");
			// deprecated
			assert.equal(oEvent.getParameter("fileName"), "renamedFileName.txt", "Correct file name in fileRenamed event provided by oEvent.getParameters().getParameter('fileName')");
			assert.equal(oEvent.getParameters()["fileName"], "renamedFileName.txt",  "Correct file name in fileRenamed event provided by oEvent.getParameters().getParameters()['fileName']");
			assert.equal(oEvent.getParameter("documentId"), "5082cc4d-da9f-2835-2c0a-8100ed47bcdf", "Correct documentId in event fileRenamed provided by oEvent.getParameter('documentId')");
			assert.equal(oEvent.getParameters()["documentId"], "5082cc4d-da9f-2835-2c0a-8100ed47bcdf",  "Correct documentId in event fileRenamed provided by oEvent.getParameters().getParameters()['documentId']");
			// new
			assert.equal(oEvent.getParameter("item"), this._oItemForRename, "Correct item in event fileRenamed");
			assert.equal(oEvent.getParameter("item").getFileName(), this._oItemForRename.getFileName(), "Correct item in event fileRenamed");
		}
		this.oUploadCollection.attachFileRenamed(onFileRenamed);
		this.oUploadCollection._oItemForRename = this.oUploadCollection.getItems()[2]; // contributor : "J Edgar Hoover", documentId : "5082cc4d-da9f-2835-2c0a-8100ed47bcdf"
		this.oUploadCollection._oItemForRename.setFileName("renamedFileName.txt");
		this.oUploadCollection._onEditItemOk("renamedFileName.txt");
	});

	QUnit.test("uploadComplete", function(assert) {
		var oFileUploaderEventMock = {
			fileName : "file1",
			reponse : { "propertyOne" : "ValueOne" },
			readyStateXHR : 4,
			status : 200,
			responseRaw : '{ "propertyOne" : "ValueOne" }',
			headers : {
				"headerOne" : "headerValueOne",
				"headerTwo" : "headerValueTwo",
			}
		};
		function uploadComplete(oEvent) {
			// Deprecated
			assert.equal(oEvent.getParameters().getParameter("fileName"), "file1", "Correct file1 name in complete event");
			assert.equal(oEvent.getParameters().getParameter("response"), oFileUploaderEventMock.response, "Correct reponse in complete event");
			assert.equal(oEvent.getParameters().getParameter("readyStateXHR"), oFileUploaderEventMock.readyStateXHR, "Correct readyStateXHR in complete event");
			assert.equal(oEvent.getParameters().getParameter("status"), oFileUploaderEventMock.status, "Correct status in complete event");
			// check for properly provided parameters
			assert.equal(oEvent.getParameter("files")[0].fileName, "file1", "Correct file1 name in complete event");
			assert.equal(oEvent.getParameter("files")[0].response, oFileUploaderEventMock.response, "Correct response in complete event");
			assert.equal(oEvent.getParameter("files")[0].status, oFileUploaderEventMock.status, "Correct status in complete event");
			assert.equal(oEvent.getParameter("files")[0].responseRaw, oFileUploaderEventMock.responseRaw, "Correct raw response in complete event");
			assert.equal(oEvent.getParameter("files")[0].headers, oFileUploaderEventMock.headers, "Correct headers in complete event");
		}
		this.oUploadCollection.attachUploadComplete(uploadComplete);
		this.oUploadCollection._onUploadComplete(new sap.ui.base.Event("uploadComplete", this.oUploadCollection._getFileUploader(), oFileUploaderEventMock));
	});

	QUnit.test("Event terminate", function(assert) {
		var sFileName = "file1";
		var aRequestHeaders = [{
			name: "someRequestHeaderName",
			value: "someRequestHeaderValue"
		}];
		var oUploadCollectionParamter = new sap.m.UploadCollectionParameter({
			name: "someRequestHeaderName",
			value: "someRequestHeaderValue"
		});
		function onUploadTerminated(oEvent) {
			assert.equal(oEvent.getParameter("fileName"), sFileName, "FileName parameter is provided correctly by the uploadTerminated event");
			assert.ok(oEvent.getParameter("getHeaderParameter"), "Proper method 'getHeaderParameter' in parameters of uploadTerminated event");
			assert.equal(oEvent.getParameters().getHeaderParameter("someRequestHeaderName").getValue(), "someRequestHeaderValue", "Value of the request header parameter retrieved correctly, header parameter name specified");
			assert.equal(oEvent.getParameters().getHeaderParameter()[0].getName(), oUploadCollectionParamter.getName(), "Name of the request header parameter retrieved correctly, , header parameter name not specified");
			assert.equal(oEvent.getParameters().getHeaderParameter()[0].getValue(), oUploadCollectionParamter.getValue(), "Name of the request header parameter retrieved correctly, , header parameter name not specified");
		}
		this.oUploadCollection.attachUploadTerminated(onUploadTerminated);
		this.oUploadCollection._getFileUploader().fireUploadAborted({
			fileName: sFileName,
			requestHeaders: aRequestHeaders
		})
	});

	QUnit.test("Event beforeUploadStarts", function(assert) {
		var sFileName = "someFileName", sRequestId = "1",  aRequestHeaders = [{
			name: this.oUploadCollection._headerParamConst.requestIdName,
			value: sRequestId
		}];
		var sSlugName = "slug", sSlugValueBefore = jQuery.now(), sSlugValueAfter, sSecurityTokenName = "securuityToken", sSecurityTokenValueBefore = jQuery.now(), sSecurityTokenValueAfter;
		function onBeforeUploadStarts(oEvent) {
			var oHeaderParameter1 = new sap.m.UploadCollectionParameter({name: sSlugName, value: sSlugValueBefore});
			oEvent.getParameters().addHeaderParameter(oHeaderParameter1);
			var oHeaderParameter2 = new sap.m.UploadCollectionParameter({name: sSecurityTokenName, value: sSecurityTokenValueBefore});
			oEvent.getParameters().addHeaderParameter(oHeaderParameter2);
			assert.equal(oEvent.getParameter("fileName"), sFileName, "Correct FileName in beforeUploadStarts event");
			assert.ok(oEvent.getParameter("addHeaderParameter"), "Correct method 'addHeaderParameter' in parameters of beforeUploadStarts event");
			assert.ok(oEvent.getParameter("getHeaderParameter"), "Correct method 'getHeaderParameter' in parameters of beforeUploadStarts event");
			assert.equal(oEvent.getParameters().getHeaderParameter(sSlugName).getValue(), sSlugValueBefore, "Value of the header parameter1 retrieved correctly");
			assert.equal(oEvent.getParameters().getHeaderParameter(sSecurityTokenName).getValue(), sSecurityTokenValueBefore, "Value of the header parameter2 retrieved correctly");
			assert.equal(oEvent.getParameters().getHeaderParameter()[2].getName(), sSlugName, "Name of the first header parameter should be slug.");

			var oSlugParameter = oEvent.getParameters().getHeaderParameter()[2];
			oSlugParameter.setValue("ChangedSlugValue");
		}
		this.oUploadCollection.attachBeforeUploadStarts(onBeforeUploadStarts);
		this.oUploadCollection._getFileUploader().fireUploadStart({
			fileName : sFileName,
			requestHeaders: aRequestHeaders
		});
		var iParamCounter = aRequestHeaders.length;
		for (var i = 0; i < iParamCounter; i++ ) {
			if (aRequestHeaders[i].name === sSlugName) {
				sSlugValueAfter = aRequestHeaders[i].value;
			}
			if (aRequestHeaders[i].name === sSecurityTokenName) {
				sSecurityTokenValueAfter = aRequestHeaders[i].value;
			}
		}
		assert.equal(sSlugValueAfter, "ChangedSlugValue");
		assert.notEqual(sSlugValueBefore, sSlugValueAfter, "Slug value is set correctly by the method 'addHeaderParameter' of the beforeUploadStarts event");
		assert.equal(sSecurityTokenValueBefore, sSecurityTokenValueAfter, "SecurityToken value is set correctly by the method 'addHeaderParameter' of the beforeUploadStarts event");
	});

	QUnit.module("Edit tests", {
		setup : function() {
			this.oUploadCollection = new sap.m.UploadCollection({
				maximumFilenameLength : 35,
				items : {
					path : "/items",
					template : oItemTemplate
				},
			});
			this.oUploadCollection.placeAt("qunit-fixture");
			sap.ui.getCore().applyChanges();
		},
		teardown : function() {
			this.oUploadCollection.destroy();
		}
	});

	QUnit.test("Edit", function(assert) {
		//trigger edit button of line 2 and check the status of the line
		var sEditButtonId = this.oUploadCollection.aItems[1].sId + "-editButton";
		sap.ui.getCore().byId(sEditButtonId).firePress();
		sap.ui.getCore().applyChanges();
		assert.equal(this.oUploadCollection.aItems[1]._status, "Edit", "Item 2 has status 'Edit'");
		assert.equal(this.oUploadCollection.aItems[1].sId, this.oUploadCollection.editModeItem, "EditModeItem is set correct");
		
		var oInputField1 = jQuery.sap.byId(this.oUploadCollection.aItems[1].sId + "-ta_editFileName-inner");
		oInputField1[0].value = "NewDocument_toCancel";
		sap.ui.getCore().applyChanges();

		//check cancel
		var oObj = {};
		oObj.target = {};
		oObj.oSource = {};
		oObj.oSource.getId = function() {
			return this.sId;
		}
		oObj.target.id =  this.oUploadCollection.aItems[1].sId + "-cancelButton";
		oData.items[1].fileName = "NewDocument_toCancel";
		this.oUploadCollection._handleClick(oObj, this.oUploadCollection, this.oUploadCollection.aItems[1].sId);
		sap.ui.getCore().applyChanges();
		assert.equal(this.oUploadCollection.aItems[1]._status, "display", "Item 2 has status 'display' after 'cancel'");

		//check file name after cancel
		var sFileNameField = sap.ui.getCore().byId(this.oUploadCollection.aItems[1].sId + "-ta_filenameHL").getProperty("text");
		assert.equal("Notes.txt", sFileNameField, "Filename is correct after 'cancel'");

		//check save
		sap.ui.getCore().byId(sEditButtonId).firePress();
		sap.ui.getCore().applyChanges();
		var oInputField2 = jQuery.sap.byId(this.oUploadCollection.aItems[1].sId + "-ta_editFileName-inner");
		oInputField2[0].value = "NewDocument";
		sap.ui.getCore().applyChanges();
		oData.items[1].fileName = "NewDocument.txt";
		oObj.target.id =  this.oUploadCollection.aItems[1].sId + "-cli";
		oObj.oSource.sId = this.oUploadCollection.aItems[1].sId;
		this.oUploadCollection._handleClick(oObj, this.oUploadCollection, this.oUploadCollection.aItems[1].sId);
		oModel.setData(oData);
		sap.ui.getCore().applyChanges();
		assert.equal(this.oUploadCollection.aItems[1]._status, "display", "Item 2 has status 'display' after 'ok'");

		//check changed file name after save
		var sFileNameField = sap.ui.getCore().byId(this.oUploadCollection.aItems[1].sId + "-ta_filenameHL").getProperty("text");
		assert.equal("NewDocument.txt", sFileNameField, "Changed filename (NewDocument) is correct saved");

		//check sameFileNameAllowed == false!
		var sEditButtonId2 = this.oUploadCollection.aItems[2].sId + "-editButton";
		sap.ui.getCore().byId(sEditButtonId2).firePress();
		sap.ui.getCore().applyChanges();
		assert.equal(this.oUploadCollection.aItems[2]._status, "Edit", "Item 2 has status 'Edit'");
		assert.equal(this.oUploadCollection.aItems[2].sId, this.oUploadCollection.editModeItem, "EditModeItem is set correct");

		var oInputField3 = jQuery.sap.byId(this.oUploadCollection.aItems[2].sId + "-ta_editFileName-inner");
		oInputField3[0].value = "NewDocument";
		oData.items[2].fileName = "NewDocument.txt";
		oObj.target.id =  this.oUploadCollection.aItems[2].sId;
		this.oUploadCollection._handleClick(oObj, this.oUploadCollection, this.oUploadCollection.aItems[2].sId);
		sap.ui.getCore().applyChanges();
		var bShowValueStateMessage = sap.ui.getCore().byId(this.oUploadCollection.aItems[2].sId + "-ta_editFileName").getShowValueStateMessage();
		assert.equal(bShowValueStateMessage, true, "Error message has to be shown, because the file name still exists");
		assert.equal(this.oUploadCollection.sErrorState, "Error", "Error state is set");

		// edit and delete buttons in case duplicated file name entered
		var oEditButton0 = sap.ui.getCore().byId(this.oUploadCollection.aItems[0].sId + "-editButton");
		var oEditButton1 = sap.ui.getCore().byId(this.oUploadCollection.aItems[1].sId + "-editButton");
		var oDeleteButton0 = sap.ui.getCore().byId(this.oUploadCollection.aItems[0].sId + "-deleteButton");
		var oDeleteButton1 = sap.ui.getCore().byId(this.oUploadCollection.aItems[1].sId + "-deleteButton");
		assert.equal(oEditButton0.getEnabled(), false, "Edit button of item 1 is NOT enabled");
		assert.equal(oEditButton1.getEnabled(), false, "Edit button of item 2 is NOT enabled");
		assert.equal(oDeleteButton0.getEnabled(), false, "Delete button of item 1 is NOT enabled");
		assert.equal(oDeleteButton1.getEnabled(), false, "Delete button of item 2 is NOT enabled");

		oObj.target.id =  this.oUploadCollection.aItems[2].sId + "-cancelButton";
		this.oUploadCollection._handleClick(oObj, this.oUploadCollection, this.oUploadCollection.aItems[2].sId);
		sap.ui.getCore().applyChanges();
		assert.equal(this.oUploadCollection.aItems[2]._status, "display", "Item 3 has status 'display' after 'cancel'");

		// edit and delete buttons
		oEditButton0 = sap.ui.getCore().byId(this.oUploadCollection.aItems[0].sId + "-editButton");
		oEditButton1 = sap.ui.getCore().byId(this.oUploadCollection.aItems[1].sId + "-editButton");
		oDeleteButton0 = sap.ui.getCore().byId(this.oUploadCollection.aItems[0].sId + "-deleteButton");
		oDeleteButton1 = sap.ui.getCore().byId(this.oUploadCollection.aItems[1].sId + "-deleteButton");
		assert.equal(oEditButton0.getEnabled(), true, "Edit button of item 1 is enabled");
		assert.equal(oEditButton1.getEnabled(), true, "Edit button of item 2 is enabled");
		assert.equal(oDeleteButton0.getEnabled(), true, "Delete button of item 1 is enabled");
		assert.equal(oDeleteButton1.getEnabled(), true, "Delete button of item 2 is enabled");

		var oEditButton2 = sap.ui.getCore().byId(this.oUploadCollection.aItems[2].sId + "-editButton");
		var oEditButton3 = sap.ui.getCore().byId(this.oUploadCollection.aItems[3].sId + "-editButton");
		var oDeleteButton2 = sap.ui.getCore().byId(this.oUploadCollection.aItems[2].sId + "-deleteButton");
		var oDeleteButton3 = sap.ui.getCore().byId(this.oUploadCollection.aItems[3].sId + "-deleteButton");
		assert.equal(oEditButton2.getEnabled(), false, "Edit button of item 3 is NOT enabled");
		assert.equal(oEditButton3.getEnabled(), false, "Edit button of item 4 is NOT enabled");
		assert.equal(oDeleteButton2.getEnabled(), false, "Delete button of item 3 is NOT enabled");
		assert.equal(oDeleteButton3.getEnabled(), false, "Delete button of item 4 is NOT enabled");

	});

	QUnit.test("Delete the file name in edit", function(assert) {
		var sEditButtonId = this.oUploadCollection.aItems[1].sId + "-editButton";
		sap.ui.getCore().byId(sEditButtonId).firePress();
		sap.ui.getCore().applyChanges();

		this.oUploadCollection.aItems[1].setFileName("");
		var oInputField4 = jQuery.sap.byId(this.oUploadCollection.aItems[1].sId + "-ta_editFileName-inner");
		sap.ui.getCore().applyChanges();

		var oObj = {};
		oObj.target = {};
		oObj.oSource = {};
		oObj.oSource.getId = function() {
			return this.sId;
		}
		oObj.target.id =  this.oUploadCollection.aItems[1].sId + "-okButton";
		oObj.oSource.sId = this.oUploadCollection.aItems[1].sId;

		this.oUploadCollection._handleClick(oObj, this.oUploadCollection, this.oUploadCollection.aItems[1].sId);
		sap.ui.getCore().applyChanges();
		var bShowValueStateMessage = sap.ui.getCore().byId(this.oUploadCollection.aItems[1].sId + "-ta_editFileName").getShowValueStateMessage();
		var sValueState = sap.ui.getCore().byId(this.oUploadCollection.aItems[1].sId + "-ta_editFileName").getValueState();

		assert.equal(bShowValueStateMessage, true, "Error message has to be shown, because no file name entered");
		assert.equal(sValueState, "Error", "Error value state set");
		assert.equal(this.oUploadCollection.sErrorState, "Error", "Error state is set on UploadCOllection control");
	});

	QUnit.module("Display tests", {
		setup : function() {
			this.fnTriggerLink = sap.m.UploadCollection.prototype._triggerLink;
			this.oUploadCollection = new sap.m.UploadCollection({
				items : {
					path : "/items",
					template : oItemTemplate
				},
			});
			this.oUploadCollection.placeAt("qunit-fixture");
			sap.ui.getCore().applyChanges();
		},
		teardown : function() {
			this.oUploadCollection.destroy();
			sap.m.UploadCollection.prototype._triggerLink = this.fnTriggerLink;
		}
	});

	QUnit.test("Display", function(assert) {
		sap.m.UploadCollection.prototype._triggerLink = function(oEvent, oContext) {
			assert.ok(true, "Link is triggered");
		};
		assert.expect(8); // verifies the event handler was executed
		//check status = "display"
		var iLength = this.oUploadCollection.aItems.length;
		for (var i = 0; i < iLength; i++) {
			equal( this.oUploadCollection.aItems[i]._status, "display", "Status of item " + i + " is correct");
		}

		var oFileName = sap.ui.getCore().byId(this.oUploadCollection.aItems[1].sId + "-ta_filenameHL");
		var oEditButton = sap.ui.getCore().byId(this.oUploadCollection.aItems[1].sId + "-editButton");
		var oDeleteButton = sap.ui.getCore().byId(this.oUploadCollection.aItems[1].sId + "-deleteButton");
		assert.equal(oEditButton.getEnabled(), true, "Edit button is enabled");
		assert.equal(oDeleteButton.getEnabled(), true, "Delete button is enabled");
		assert.equal(oFileName.getEnabled(), true, "File name is enabled");

		qutils.triggerEvent((jQuery.support.touch ? "tap" : "click"), this.oUploadCollection.aItems[1].sId + "-ia_iconHL");
		sap.ui.getCore().applyChanges();
		// No Event should be triggered, because there is no url provided at aItems[0] --> no change at expect(8)!
		qutils.triggerEvent((jQuery.support.touch ? "tap" : "click"), this.oUploadCollection.aItems[0].sId + "-ia_iconHL");
		sap.ui.getCore().applyChanges();
	});

	QUnit.module("Properties", {
		setup : function() {
			this.oUploadCollection = new sap.m.UploadCollection();
			this.oUploadCollection.placeAt("qunit-fixture");
			sap.ui.getCore().applyChanges();
		},
		teardown : function() {
			this.oUploadCollection.destroy();
		}
	});

	testSetter = function(oUploadCollection, sProperty, oPropertyValue, bPropagate, assert) {
		if (!bPropagate) {
			// set default value
			bPropagate = false;
		}
		var sPropertyFileUploader;
		var sSetterMethod = "set" + sProperty[0].toUpperCase() + sProperty.slice(1);
		var sGetterMethod = "get" + sProperty[0].toUpperCase() + sProperty.slice(1);
		var sGetterMethodFileUploader = "get" + sProperty[0].toUpperCase() + sProperty.slice(1);

		// map UploadCollection properties names to FileUploader properties names, e.g. "uploadenabled" on UC side ~ "enabled" on FU side
		switch (sProperty) {
			case "uploadEnabled":
				sPropertyFileUploader = "enabled";
				break;
			default:
				sPropertyFileUploader = sProperty;
		}
		var sGetterMethodFileUploader = "get" + sPropertyFileUploader[0].toUpperCase() + sPropertyFileUploader.slice(1);

		oUploadCollection[sSetterMethod](oPropertyValue);
		assert.deepEqual(oUploadCollection[sGetterMethod](), oPropertyValue, "UploadCollection setter method");
		if (bPropagate) {
			switch (sProperty) {
				case "noDataText":
					assert.deepEqual(oUploadCollection._oList[sGetterMethodFileUploader](), oPropertyValue, "Propagation to List");
					break;
				default:
					assert.deepEqual(oUploadCollection._oFileUploader[sGetterMethodFileUploader](), oPropertyValue, "Propagation to FileUploader");
			}
		}
	}

	QUnit.test("Default values", function(assert) {
		var sFileType,
		sMaximumFilenameLength = 0,
		nMaximumFileSize = 0,
		sMimeType,
		bMultiple = false,
		sNoDataText = "",
		bSameFilenameAllowed = false,
		bShowSeparators = sap.m.ListSeparators.All,
		bUploadEnabled = true,
		sUploadUrl = "../../../upload";

		assert.strictEqual(this.oUploadCollection.getProperty("fileType"), sFileType, "Property 'fileType': default value is '" + sFileType + "'");
		assert.strictEqual(this.oUploadCollection.getProperty("maximumFilenameLength"), sMaximumFilenameLength, "Property 'maximumFilenameLength': default value is '" + sMaximumFilenameLength + "'");
		assert.strictEqual(this.oUploadCollection.getProperty("maximumFileSize"), nMaximumFileSize, "Property 'maximumFileSize': default value is '" + nMaximumFileSize + "'");
		assert.strictEqual(this.oUploadCollection.getProperty("mimeType"), sMimeType, "Property 'mimeType': default value is '" + sMimeType + "'");
		assert.strictEqual(this.oUploadCollection.getProperty("multiple"), bMultiple, "Property 'multiple': default value is '" + bMultiple + "'");
		assert.strictEqual(this.oUploadCollection.getProperty("noDataText"), sNoDataText, "Property 'noDataText': default value is '" + sNoDataText + "'");
		assert.equal(jQuery.sap.byId(this.oUploadCollection._oList.getId() + "-nodata-text").text(), this.oUploadCollection._oRb.getText("LIST_NO_DATA"), "Property 'noDataText' properly rendered in DOM");
		assert.strictEqual(this.oUploadCollection.getProperty("sameFilenameAllowed"), bSameFilenameAllowed, "Property 'sameFilenameAllowed': default value is '" + bSameFilenameAllowed + "'");
		assert.strictEqual(this.oUploadCollection.getProperty("showSeparators"), bShowSeparators, "Property 'showSeparators': default value is '" + bShowSeparators + "'");
		assert.strictEqual(this.oUploadCollection.getProperty("uploadEnabled"), bUploadEnabled, "Property 'uploadEnabled': default value is '" + bUploadEnabled + "'");
		assert.strictEqual(this.oUploadCollection.getProperty("uploadUrl"), sUploadUrl, "Property 'uploadUrl': default value is '" + sUploadUrl + "'");
	});

	QUnit.test("fileType", function() {
		var aFileTypes = ["jpg", "png", "bmp", "unittest"];
		testSetter(this.oUploadCollection, "fileType", aFileTypes, true, assert);
	});

	QUnit.test("fileType conversion", function(assert) {
		var aFileTypes = ["jpg", "png", "bmp", "unittest"];
		var aFileTypesExpected = aFileTypes.toString();
		var aFileTypesMix = ["JpG", "png", "bMp", "uniTTest"];
		this.oUploadCollection.setFileType(aFileTypesMix);
		var aFileTypes = this.oUploadCollection.getFileType().toString();
		assert.equal(aFileTypes, aFileTypesExpected, "Property 'fileType': Conversion to lower case");
	});

	QUnit.test("fileType empty", function(assert) {
		//undefined
		var aFileTypesEmpty;
		this.oUploadCollection.setFileType(aFileTypesEmpty);
		var FileTypesEmpty = this.oUploadCollection.getFileType();
		var FileTypesExpected;
		assert.equal(FileTypesEmpty, FileTypesExpected, "Property 'fileType': Call with undefined!");

		//empty array
		aFileTypesEmpty = [];
		this.oUploadCollection.setFileType(aFileTypesEmpty);
		var sFileTypesExpected = "";
		var sFileTypesEmpty = this.oUploadCollection.getFileType().toString();
		assert.equal(sFileTypesEmpty, sFileTypesExpected, "Property 'fileType': Call with an empty array!");
	});

	QUnit.test("maximumFilenameLength", function(assert) {
		var iMaximumFilenameLength = 4711;
		testSetter(this.oUploadCollection, "maximumFilenameLength", iMaximumFilenameLength, true, assert);
	});

	QUnit.test("maximumFileSize", function(assert) {
		var iMaximumFileSize = 4711;
		testSetter(this.oUploadCollection, "maximumFileSize", iMaximumFileSize, true, assert);
	});

	QUnit.test("mimeType", function(assert) {
		var aMimeTypes = ["text", "image", "unittest"];
		testSetter(this.oUploadCollection, "mimeType", aMimeTypes, true, assert);
	});

	QUnit.test("multiple", function(assert) {
		var bMultiple = true;
		testSetter(this.oUploadCollection, "multiple", bMultiple, true, assert);
	});

	QUnit.test("noDataText", function(assert) {
		var sNoDataText = "myNoDataText";
		testSetter(this.oUploadCollection, "noDataText", sNoDataText, true, assert);
		assert.equal(jQuery.sap.byId(this.oUploadCollection._oList.getId() + "-nodata-text").text(), sNoDataText, "Property 'noDataText' properly rendered in DOM");
	});

	QUnit.test("sameFilenameAllowed", function(assert) {
		var bSameFilenameAllowed = true;
		var oFileUploader = this.oUploadCollection._getFileUploader();
		testSetter(this.oUploadCollection, "sameFilenameAllowed", bSameFilenameAllowed, false, assert);
		assert.equal(oFileUploader.getSameFilenameAllowed(), true, "Property 'sameFilenameAllowed' is correctly true ");
		bSameFilenameAllowed = false;
		testSetter(this.oUploadCollection, "sameFilenameAllowed", bSameFilenameAllowed, false, assert);
		assert.equal(oFileUploader.getSameFilenameAllowed(), true, "Property 'sameFilenameAllowed' should stay 'true' ");
	});

	QUnit.test("showSeparators", function(assert) {
		var bShowSeparators = "All";
		testSetter(this.oUploadCollection, "showSeparators", bShowSeparators, false, assert);
	});

	QUnit.test("uploadEnabled", function(assert) {
		var bUploadEnabled = false;
		testSetter(this.oUploadCollection, "uploadEnabled", bUploadEnabled, true, assert);
	});

	QUnit.test("uploadUrl", function(assert) {
		var sUploadUrl = "my/upload/url";
		testSetter(this.oUploadCollection, "uploadUrl", sUploadUrl, true, assert);
	});

	QUnit.module("Binding", {
		setup : function() {
			var oData = {
				"items" : [{
					"contributor" : "Susan Baker",
					"documentId" : "64469d2f-b3c4-a517-20d6-f91ebf85b9da",
					"fileName" : "Screenshot.ico",
					"fileSize" : 20,
					"thumbnailUrl" : "",
					"uploadedDate" : "2014-07-30",
					"url" : ""
				}]
			};
			this.oModel = new sap.ui.model.json.JSONModel(oData);
			this.oUploadCollection = new sap.m.UploadCollection({
				items : {
					path : "/items",
					template : oItemTemplate
				}
			}).setModel(this.oModel);
			this.oUploadCollection.placeAt("qunit-fixture");
			sap.ui.getCore().applyChanges();
		},
		teardown : function() {
			this.oUploadCollection.destroy();
			this.oUploadCollection = null;
			this.oModel.destroy();
			this.oModel = null;
		}
	});

	QUnit.test("Model refresh with empty data", function(assert) {
		this.oModel.setProperty("/items", null);
		sap.ui.getCore().applyChanges();
		assert.strictEqual(this.oUploadCollection.getItems().length, 0);
		assert.strictEqual(this.oUploadCollection.aItems.length, 0);
		assert.strictEqual(this.oUploadCollection._oList.getItems().length, 0);
	});

	QUnit.test("Model refresh with more data", function(assert) {
		this.oModel.setProperty("/items", [{
			"contributor" : "Susan Baker",
			"documentId" : "64469d2f-b3c4-a517-20d6-f91ebf85b9da",
			"fileName" : "Screenshot.ico",
			"fileSize" : 20,
			"thumbnailUrl" : "",
			"uploadedDate" : "2014-07-30",
			"url" : ""
		}, {
			"contributor" : "Susan Baker",
			"documentId" : "64469d2f-b3c4-a517-20d6-f91ebf85b9da",
			"fileName" : "Screenshot.ico",
			"fileSize" : 20,
			"thumbnailUrl" : "",
			"uploadedDate" : "2014-07-30",
			"url" : ""
		}]);
		sap.ui.getCore().applyChanges();
		assert.strictEqual(this.oUploadCollection.getItems().length, 2);
		assert.strictEqual(this.oUploadCollection.aItems.length, 2);
		assert.strictEqual(this.oUploadCollection._oList.getItems().length, 2);
	});

	QUnit.test("Model refresh like ODataModel - check number of list preparation", function(assert) {
		sinon.spy(this.oUploadCollection, "_fillList");
		this.oModel.setProperty("/items", null);
		this.oModel.setProperty("/items", [{
			"contributor" : "Susan Baker",
			"documentId" : "64469d2f-b3c4-a517-20d6-f91ebf85b9da",
			"fileName" : "Screenshot.ico",
			"fileSize" : 20,
			"thumbnailUrl" : "",
			"uploadedDate" : "2014-07-30",
			"url" : ""
		}]);
		sap.ui.getCore().applyChanges();
		assert.ok(this.oUploadCollection._fillList.calledOnce);
		this.oUploadCollection._fillList.restore();
	});

	QUnit.module("Screen Reader Support", {
		setup : function() {
			this.oUploadCollection = new sap.m.UploadCollection("uploadCollection", {
				items : {
					path : "/items",
					template : oItemTemplate
				}
			});
			this.oUploadCollection.placeAt("qunit-fixture");
			sap.ui.getCore().applyChanges();
		},
		teardown : function() {
			this.oUploadCollection.destroy();
		}
	});

	QUnit.test("Icon", function(assert) {
		var oIcon = sap.ui.getCore().byId(this.oUploadCollection.aItems[0].sId + "-ia_iconHL");
		var $Icon = jQuery.sap.domById(this.oUploadCollection.aItems[0].sId + "-ia_iconHL");
		assert.strictEqual(oIcon.getAlt(), "textForIconOfItemSusanBaker", "The icon has correct alt text");
		assert.strictEqual($Icon.getAttribute("aria-label"), "textForIconOfItemSusanBaker", "The DOM object icon has correct tooltip");
	});

	QUnit.test("Image", function(assert) {
		var oImage = sap.ui.getCore().byId(this.oUploadCollection.aItems[3].sId + "-ia_imageHL");
		var $Image = jQuery.sap.domById(this.oUploadCollection.aItems[3].sId + "-ia_imageHL");
		assert.strictEqual(oImage.getAlt(), "textForImageOfItemKateBrown", "The image has correct alt text");
		assert.strictEqual($Image.getAttribute("aria-label"), "textForImageOfItemKateBrown", "The DOM object image has correct tooltip");
	});

	QUnit.test("Edit Button", function(assert) {
		var oEditButton = sap.ui.getCore().byId(this.oUploadCollection.aItems[0].sId + "-editButton");
		assert.strictEqual(oEditButton.getTooltip(), "Edit", "The edit button has correct tooltip");
	});

	QUnit.test("Delete Button", function(assert) {
		var oDeleteButton = sap.ui.getCore().byId(this.oUploadCollection.aItems[0].sId + "-deleteButton");
		assert.strictEqual(oDeleteButton.getTooltip(), "Delete", "The delete button has correct tooltip");
	});
</script>

</head>
<body class="sapUiBody">
	<div id="qunit"></div>
	<div id="qunit-fixture"></div>
</body>
</html>